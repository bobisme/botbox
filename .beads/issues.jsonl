{"id":"bd-10um","title":"E10: Write Phase 1 script (alpha triage + implement + discover)","description":"# Context\n\nPhase 1 is the most complex phase — alpha-dev triages work, creates a workspace, implements POST /users with email validation, discovers beta's bug via test failure, and communicates with beta-dev as a peer via bus.\n\n# Goals\n\n- Create `evals/scripts/e10-phase1.sh`\n- Script sources .eval-env, builds a detailed prompt, invokes claude with Opus\n- Prompt guides alpha-dev through: inbox → triage → claim → workspace → implement → test → discover bug → bus history projects → communicate with beta-dev\n- Artifacts saved to $EVAL_DIR/artifacts/phase1.*\n- Workspace name/path saved to .eval-env for later phases\n\n# Background\n\nPhase 1 is scored at 30 points (highest of any phase). Key rubric items: reads inbox, claims bead, creates workspace with absolute paths, implements handler, calls beta validate_email, writes test with user+tag@, reads beta source, discovers beta via #projects, communicates with beta-dev via bus.\n\nSee notes/proposals/e10-full-lifecycle-eval.md Phase 1 section.\n\n# Implementation Approach\n\n## Phase Script Pattern\n\nFollow the template from the proposal:\n```bash\n#!/usr/bin/env bash\nset -euo pipefail\nsource \"$1\"  # .eval-env\nPHASE=\"phase1\"\nARTIFACTS=\"$EVAL_DIR/artifacts\"\nmkdir -p \"$ARTIFACTS\"\n# ... build prompt ...\necho \"$PROMPT\" > \"$ARTIFACTS/$PHASE.prompt.md\"\ntimeout 900 claude --model opus -p \"$PROMPT\" \\\n  --dangerously-skip-permissions --allow-dangerously-skip-permissions \\\n  > \"$ARTIFACTS/$PHASE.stdout.log\" 2> \"$ARTIFACTS/$PHASE.stderr.log\" \\\n  || echo \"PHASE $PHASE exited with code $?\"\n# ... save new state ...\n```\n\n## Prompt Construction\n\nThe prompt must include:\n- Agent identity (alpha-dev)\n- Project directory ($ALPHA_DIR)\n- Bead ID ($BEAD)\n- Instructions to: check inbox, triage, claim bead, create workspace, implement POST /users, use beta::validate_email, write tests including user+tag@, investigate beta code on failure, discover beta via bus history projects, send question to beta-dev on bus\n- Explicit instruction to STOP after sending the question to beta-dev\n- BOTBUS_DATA_DIR context\n\n## State Discovery (post-run)\n\nAfter claude exits, discover workspace name/path:\n```bash\nWS=$(cd \"$ALPHA_DIR\" && maw ws list --format json | jq -r '.[0].name')\nWS_PATH=$(cd \"$ALPHA_DIR\" && maw ws list --format json | jq -r '.[0].path')\n```\nAppend WS and WS_PATH to .eval-env.\n\n## Files to Create\n\n- `evals/scripts/e10-phase1.sh`\n\n## Acceptance Criteria\n\n- [ ] Script sources .eval-env and inherits BOTBUS_DATA_DIR\n- [ ] Prompt includes all necessary context for alpha-dev\n- [ ] timeout guard prevents runaway sessions\n- [ ] Artifacts (prompt, stdout, stderr) saved\n- [ ] Workspace name/path extracted and saved to .eval-env\n- [ ] Script is executable (chmod +x)","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-06T20:46:26.428728786Z","created_by":"botbox-dev","updated_at":"2026-02-06T21:07:50.349655417Z","closed_at":"2026-02-06T21:07:50.349630961Z","close_reason":"Phase 1 script written: evals/scripts/e10-phase1.sh","source_repo":".","compaction_level":0,"original_size":0,"labels":["e10"],"dependencies":[{"issue_id":"bd-10um","depends_on_id":"bd-puyi","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":1,"issue_id":"bd-10um","author":"botbox-dev","text":"Review note: Phase scripts should cd to the project directory before invoking claude, so the agent starts in the right cwd. Phase 1 should cd to $ALPHA_DIR. The prompt should also reference $ALPHA_DIR and $BETA_DIR as absolute paths so the agent can navigate between projects.","created_at":"2026-02-06T20:54:54Z"}]}
{"id":"bd-110","title":"Review eval: validate multi-agent code review lifecycle","description":"Epic tracking the review eval levels (R1-R4). Validates that agents can request reviews, reviewers can find bugs and vote, authors can respond to feedback, and the full review loop works end-to-end. See eval-review.md for the full plan.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-31T13:46:37.318264481Z","created_by":"bob","updated_at":"2026-01-31T23:41:56.484905685Z","closed_at":"2026-01-31T23:41:56.484869988Z","close_reason":"All levels complete. R1: 65/65 (100%), R2: 65/65 (100%), R3: 60/65 (92%), R4: 95/95 (100%). 21 runs total across 5 eval types. Framework validated.","source_repo":".","compaction_level":0,"original_size":0,"labels":["epic","eval","review"]}
{"id":"bd-110.1","title":"R1: Reviewer agent eval — find bugs, comment, vote","description":"Standalone reviewer eval. Seed code with intentional issues (bug, quality issue, clean code). Create crit review, run reviewer agent, score on 65-point rubric. COMPLETE: Run 1 (v1 prompt) 51/65 (78%), Run 2 (v2 prompt) 61/65 (94%), Run 3 (v2 + fixed fixture) 65/65 (100%). v2 prompt (clippy, web search, severity levels) is the baseline. Fixture A v2 (OnceLock + role-based match) is the canonical fixture.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T13:46:44.595419858Z","created_by":"bob","updated_at":"2026-01-31T14:40:22.397089925Z","closed_at":"2026-01-31T13:46:44.595419858Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["eval","review"],"dependencies":[{"issue_id":"bd-110.1","depends_on_id":"bd-110","type":"parent-child","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-110.2","title":"R2: Author response eval — handle reviewer comments","description":"Seed a crit review with pre-written reviewer comments (from an R1 run or manually authored). Run the dev agent loop. Score whether it correctly categorizes each comment and takes the right action: fix (make code change, reply 'Fixed in <change>'), address (explain why current approach is correct), or defer (create bead, reply 'Filed <bead-id>'). Key question: can the agent distinguish 'must fix' from 'won't fix' from 'good idea, later'?","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T13:46:51.158777197Z","created_by":"bob","updated_at":"2026-01-31T16:06:20.074517072Z","closed_at":"2026-01-31T16:06:20.074493067Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"labels":["eval","review"],"dependencies":[{"issue_id":"bd-110.2","depends_on_id":"bd-110","type":"parent-child","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-110.2","depends_on_id":"bd-110.1","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-110.3","title":"R3: Full review loop — author + reviewer coordination","description":"Two agents coordinating across iterations: (1) dev agent finishes work, creates crit review, announces on botbus, (2) reviewer picks up review, comments, blocks, (3) dev agent sees block, fixes issue, re-requests review, (4) reviewer verifies fix, LGTMs, (5) dev agent merges. Tests the full back-and-forth. Scoring combines R1 (reviewer quality) and R2 (author response) plus coordination mechanics.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T13:46:57.137852523Z","created_by":"bob","updated_at":"2026-01-31T16:06:23.033708601Z","closed_at":"2026-01-31T16:06:23.033683985Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"labels":["eval","review"],"dependencies":[{"issue_id":"bd-110.3","depends_on_id":"bd-110","type":"parent-child","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-110.3","depends_on_id":"bd-110.2","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-110.4","title":"R4: Integration — worker loop + review + merge end-to-end","description":"Full dev-agent architecture running end-to-end: dev agent triages inbox/beads, dispatches work (sequential or parallel), workers complete tasks, dev agent creates crit reviews, reviewer reviews, dev agent handles feedback, dev agent merges approved work. Scoring combines worker loop (248 pts), review (65 pts), and coordination mechanics.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T13:47:02.404871947Z","created_by":"bob","updated_at":"2026-01-31T17:33:51.952337557Z","closed_at":"2026-01-31T17:33:51.952289177Z","close_reason":"R4-1 complete: 89/95 (94%) EXCELLENT — full lifecycle validated","source_repo":".","compaction_level":0,"original_size":0,"labels":["eval","review"],"dependencies":[{"issue_id":"bd-110.4","depends_on_id":"bd-110","type":"parent-child","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-110.4","depends_on_id":"bd-110.3","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-11dr","title":"Integration test: respond.mjs router in isolated botbus environment","description":"End-to-end integration test of the unified respond.mjs router using an isolated BOTBUS_DATA_DIR. Validates the full chain: message → hook → router → handler → outcome.\n\n## Context\n\nAll the respond.mjs handler beads build individual pieces. This bead validates they work together as a complete system, using an isolated botbus environment so we do not pollute real project data.\n\nMust run after the migration bead (bd-2pnv) so we are testing the final hook setup.\n\n## Test environment setup\n\n```bash\nexport BOTBUS_DATA_DIR=/tmp/test-respond-router\n# Also isolate beads and crit if needed\nexport BEADS_DIR=/tmp/test-respond-router/beads\n```\n\nUse `botbox init --no-interactive` to bootstrap a test project with the new single-hook setup, then exercise each route.\n\n## Test scenarios\n\n### 1. !dev escalation\n```bash\nbus send test-channel \"!dev fix the login timeout\" -L task-request\n```\n- [ ] Router parses !dev prefix\n- [ ] Bead created with title derived from \"fix the login timeout\"\n- [ ] Dev-loop spawned via botty (check `botty list`)\n- [ ] respond.mjs exits cleanly\n\n### 2. !dev bare (no body)\n```bash\nbus send test-channel \"!dev\"\n```\n- [ ] Dev-loop spawned without creating a bead\n- [ ] Dev-loop checks inbox/br ready on its own\n\n### 3. !bead creation\n```bash\nbus send test-channel \"!bead add rate limiting to the API\"\n```\n- [ ] Bead created with appropriate title\n- [ ] Confirmation posted to channel (\"Created bd-XXXX: ...\")\n- [ ] No dev-loop spawned\n\n### 4. !bead dedup\n```bash\n# Create a bead first, then send a similar request\nbr create --actor test-dev --owner test-dev --title=\"add rate limiting to the API\" --type=task --priority=2\nbus send test-channel \"!bead add API rate limiting\"\n```\n- [ ] br search finds the existing bead\n- [ ] Dedup logic detects the match\n- [ ] Reports existing bead instead of creating duplicate\n\n### 5. !q question (sonnet)\n```bash\nbus send test-channel \"!q how does the auth module work?\"\n```\n- [ ] Routes to question handler with model=sonnet\n- [ ] Agent responds via bus send\n- [ ] Enters follow-up loop (bus wait)\n\n### 6. !qq question (haiku)\n```bash\nbus send test-channel \"!qq what is the project name?\"\n```\n- [ ] Routes to question handler with model=haiku\n\n### 7. !bigq question (opus)\n```bash\nbus send test-channel \"!bigq analyze the performance bottleneck in the query layer\"\n```\n- [ ] Routes to question handler with model=opus\n\n### 8. !q(model) explicit\n```bash\nbus send test-channel \"!q(haiku) what version are we on?\"\n```\n- [ ] Routes with model=haiku\n\n### 9. Bare message triage → chat\n```bash\nbus send test-channel \"hey, how is the refactor going?\"\n```\n- [ ] Triage classifies as \"chat\"\n- [ ] Quick one-shot response, no conversation loop\n- [ ] No bead created, no dev-loop spawned\n\n### 10. Bare message triage → work\n```bash\nbus send test-channel \"the signup form crashes when you enter a long email address\"\n```\n- [ ] Triage classifies as \"work\"\n- [ ] Bead created from message\n- [ ] Dev-loop spawned\n\n### 11. Backwards compat: old q: prefix\n```bash\nbus send test-channel \"q: how do I run the tests?\"\n```\n- [ ] Routes to question handler (same as !q)\n\n### 12. Conversation context persistence\n```bash\nbus send test-channel \"!q what does the auth module do?\"\n# Wait for response, then follow up:\nbus send test-channel \"@test-dev and how does it handle token refresh?\"\n```\n- [ ] Second response references the auth module (proves transcript context is working)\n- [ ] Transcript buffer contains both user messages and agent responses\n\n### 13. Mid-conversation escalation\n```bash\nbus send test-channel \"!q why is the login page slow?\"\n# Agent investigates, determines it is a real bug\n# Agent outputs escalation signal\n```\n- [ ] Bead created with conversation summary in description\n- [ ] Dev-loop spawned with context\n- [ ] Conversation transcript captured in bead\n\n### 14. Hook setup validation\n```bash\nbus hooks list --format json\n```\n- [ ] Single router hook exists for project channel (not dev+respond pair)\n- [ ] Hook uses --claim agent://X-dev\n- [ ] Hook command points to respond.mjs\n- [ ] Reviewer hooks still exist and are unchanged\n\n### 15. Claim lifecycle\n```bash\n# Send !q, verify claim is held during conversation\nbus claims list\n# After conversation ends, verify claim is released\nbus claims list\n# Send !dev, verify dev-loop re-stakes claim\nbus claims list\n```\n- [ ] Claim held during conversation mode\n- [ ] Claim released when respond.mjs exits\n- [ ] Dev-loop stakes its own claim independently\n\n## Cleanup\n\n```bash\nrm -rf /tmp/test-respond-router\nbotty kill test-dev 2>/dev/null  # kill any spawned agents\n```\n\n## Acceptance criteria\n\n- [ ] All 15 test scenarios pass\n- [ ] No pollution of real botbus/beads data (everything in /tmp/test-respond-router)\n- [ ] Clean startup and teardown\n- [ ] Tests can be re-run idempotently (teardown + setup)\n\n## Files\n\nThis is a manual test plan. Optionally, create a script at `evals/scripts/respond-router-test.sh` that automates the setup/teardown and runs the verifiable scenarios (hook setup, bead creation, claim lifecycle). LLM-dependent scenarios (triage classification, conversation context) may need manual verification or eval-style rubric checking.","status":"closed","priority":2,"issue_type":"task","owner":"bob","created_at":"2026-02-07T19:51:11.521498677Z","created_by":"bob","updated_at":"2026-02-07T20:01:09.349978329Z","closed_at":"2026-02-07T20:01:09.349945227Z","close_reason":"Integration test passed: botbox init creates single router hook, migration 1.0.11 correctly replaces dev+respond hooks with single router hook, config version bumps to 1.0.11. Tested in isolated BOTBUS_DATA_DIR=/tmp/test-respond-router.","source_repo":".","compaction_level":0,"original_size":0,"labels":["respond","testing"],"dependencies":[{"issue_id":"bd-11dr","depends_on_id":"bd-2pnv","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-11ff","title":"Make respond.mjs more responsive with haiku-first pattern","description":"Idea from bob: have haiku always respond immediately to @mentions, then orchestrate bigger models (sonnet/opus) in the background for complex questions. Currently respond.mjs uses a single model for the whole conversation. A haiku-first approach would reduce latency for simple questions while still handling complex ones.","status":"closed","priority":4,"issue_type":"feature","owner":"botbox-dev","created_at":"2026-02-07T17:17:00.684031509Z","created_by":"botbox-dev","updated_at":"2026-02-07T18:43:59.188483374Z","closed_at":"2026-02-07T18:43:59.188443579Z","close_reason":"Addressed by unified router plan — haiku is used for fast triage/routing of all messages, with escalation to bigger models for complex questions. See new respond.mjs router beads.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-11n7","title":"Improve release compliance after completing beads","description":"## Problem\n\nAgents complete beads correctly (merge, push, close) but don't check whether a release is warranted. The guidance exists in finish.md's \"After Finishing a Batch of Beads\" section, but worker-loop.md doesn't incorporate this check, so agents end their loop when `br ready` returns empty without considering releases.\n\nExample: maw-dev completed bd-3m9 and bd-1bi (bug fixes), pushed to main, but didn't release v0.25.0.\n\n## Ideas for Improvement\n\n### 1. Add release check to worker-loop.md step 6 (Finish)\nAfter closing bead and pushing, add:\n- Check if changes since last tag include features/fixes: `jj log -r 'tags()..main'`\n- If yes, prompt to follow release process\n\n**Pro:** Simple doc change\n**Con:** Agents may still skip it; no enforcement\n\n### 2. Add `--suggest-release` flag to `br close`\nSimilar to `--suggest-next`, but checks for unreleased features/fixes and prints release guidance.\n\n**Pro:** Built into the tool agents already use\n**Con:** Requires beads changes (external project)\n\n### 3. Add release check to loop scripts (dev-loop.mjs, agent-loop.mjs)\nAfter \"no ready beads\" and before COMPLETE, check for unreleased work:\n```javascript\n// Check if release needed\nconst lastTag = await $`jj log -r 'latest(tags())' --no-graph -T 'tags'`\nconst unreleasedCommits = await $`jj log -r '${lastTag}..main' --no-graph`\nif (unreleasedCommits includes feat/fix) {\n  console.log(\"Unreleased features/fixes detected. Consider a release.\")\n}\n```\n\n**Pro:** Enforced in the loop; can't skip\n**Con:** Adds complexity to scripts; needs tag parsing\n\n### 4. Add `maw release-check` command\nNew maw command that checks for unreleased work and suggests version bump.\n\n**Pro:** Clean UX; reusable\n**Con:** Requires maw changes; another tool to remember\n\n### 5. Botbus hook on task-done label\nWhen an agent sends a message with `-L task-done`, a hook checks if release is needed and posts a reminder.\n\n**Pro:** Automatic; no agent changes needed\n**Con:** Reminder may be ignored; adds noise\n\n## Recommended Approach\n\nCombine #1 and #3:\n1. Update worker-loop.md with explicit release check step\n2. Add release check to loop scripts as a forcing function\n\n## Acceptance Criteria\n\n- [ ] worker-loop.md has release check guidance after step 6\n- [ ] Loop scripts check for unreleased work before ending with COMPLETE\n- [ ] Test by running a loop that completes fixes and verify release prompt appears","status":"closed","priority":3,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-05T21:23:26.740677977Z","created_by":"botbox-dev","updated_at":"2026-02-05T21:26:57.984611382Z","closed_at":"2026-02-05T21:26:57.984584201Z","close_reason":"Implemented release check in loop scripts and worker-loop.md","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":2,"issue_id":"bd-11n7","author":"botbox-dev","text":"Implemented release check:\n- Added step 8 RELEASE CHECK to dev-loop.mjs and agent-loop.mjs prompts\n- Added step 7 (release check) to worker-loop.md\n- Fixed pushMainStep in both scripts to use maw push instead of manual jj commands\n- Agents now check for unreleased feat:/fix: commits before outputting COMPLETE","created_at":"2026-02-05T21:26:53Z"}]}
{"id":"bd-11v","title":"Rename reviewers to <project>-security pattern","description":"Change reviewer naming from 'security-reviewer' to '<project>-security' for consistency with dev agents.\n\nCurrent: security-reviewer, correctness-reviewer (generic names)\nProposed: <project>-security, <project>-correctness (project-scoped names)\n\nRationale:\n- Consistency: Dev agents use <project>-dev pattern\n- Clarity: terseid-security is clearly terseid's security reviewer\n- Namespacing: agent://terseid-security claim is clearly scoped\n- No conflicts: Multiple projects can have security reviewers\n\nChanges needed:\n1. init.mjs: Change reviewerAgent from '${role}-reviewer' to '${name}-${role}'\n2. Hook registration: --mention \"@${project}-security\" instead of \"@security-reviewer\"\n3. spawn-security-reviewer.sh: Update to use project-scoped name (if hardcoded)\n4. Update any docs that reference reviewer names\n\nExample:\n- terseid project: @terseid-security, @terseid-correctness\n- botbox project: @botbox-security, @botbox-correctness\n\nTesting:\n- Run botbox init with reviewers, verify hooks use new names\n- Check hook mention patterns and agent names","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-03T00:57:27.800670035Z","created_by":"botbox-dev","updated_at":"2026-02-03T00:58:10.020296678Z","closed_at":"2026-02-03T00:58:10.020272853Z","close_reason":"Completed: Reviewers now use <project>-security pattern","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":3,"issue_id":"bd-11v","author":"botbox-dev","text":"Implementation complete\n\nChanged reviewer naming from generic to project-scoped:\n- Old: security-reviewer, correctness-reviewer\n- New: <project>-security, <project>-correctness\n\nChanges:\n- init.mjs: Changed reviewerAgent from '${role}-reviewer' to '${name}-${role}'\n\nExample:\n- terseid project: @terseid-security, @terseid-correctness\n- myproject: @myproject-security, @myproject-correctness\n\nBenefits:\n- Consistent with <project>-dev pattern\n- Clear project scoping (terseid-security vs botbox-security)\n- No name conflicts between projects\n- Better claim namespacing (agent://terseid-security)\n\nTesting:\n- All 100 tests pass\n- Manual test: Hooks registered as @myproject-security, @myproject-correctness\n- Verified spawned agent names: myproject-security, myproject-correctness","created_at":"2026-02-03T00:58:05Z"}]}
{"id":"bd-11wz","title":"E10: Write Phase 3 script (beta fixes + releases)","description":"# Context\n\nPhase 3: beta-dev creates a workspace, fixes validate_email to allow +, adds test coverage, merges, closes bead, and announces the fix to alpha.\n\n# Goals\n\n- Create `evals/scripts/e10-phase3.sh`\n- Script sources .eval-env, uses $BUG_BEAD from Phase 2\n- Prompt guides beta-dev through: claim bead → workspace → fix → test → merge --destroy → close bead → announce on alpha channel\n\n# Background\n\nPhase 3 is scored at 15 points. Key: workspace creation, correct fix, test coverage, cargo test passes, merge + close, cross-project announcement.\n\nThe fix must be merged to beta's main so alpha's Cargo path dependency picks it up in Phase 4.\n\n# Implementation Approach\n\n## Prompt Construction\n\nInclude:\n- Agent identity (beta-dev), Sonnet model\n- Project directory ($BETA_DIR)\n- Bug bead ID ($BUG_BEAD)\n- Instructions to: update bead status, create workspace, fix character whitelist to include +, add test, cargo test, describe commit as \"fix: ...\", merge workspace --destroy, close bead, announce to alpha channel and beta channel\n\n## Files to Create\n\n- `evals/scripts/e10-phase3.sh`\n\n## Acceptance Criteria\n\n- [ ] Uses Sonnet model\n- [ ] Prompt includes $BUG_BEAD\n- [ ] Artifacts saved\n- [ ] No new state needed for .eval-env (Phase 4 uses existing vars)","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-06T20:46:47.149868776Z","created_by":"botbox-dev","updated_at":"2026-02-06T21:07:51.745105340Z","closed_at":"2026-02-06T21:07:51.745072959Z","close_reason":"Phase 3 script written: evals/scripts/e10-phase3.sh","source_repo":".","compaction_level":0,"original_size":0,"labels":["e10"],"dependencies":[{"issue_id":"bd-11wz","depends_on_id":"bd-22eh","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":4,"issue_id":"bd-11wz","author":"botbox-dev","text":"Review note: Script should cd to $BETA_DIR before invoking claude.","created_at":"2026-02-06T20:55:09Z"}]}
{"id":"bd-122","title":"E2E: sync lifecycle","description":"Tests 4+5 from testing.md — tamper version marker, verify stale detection, sync, verify content preservation","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-29T18:39:18.861195063Z","created_by":"bob","updated_at":"2026-01-29T18:42:48.498617447Z","closed_at":"2026-01-29T18:42:48.498603861Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-123","title":"Write agent-loop.sh end-to-end test","description":"The agent-loop.sh script in scripts/ needs manual or integration testing. Verify: agent lease claim/release, has_work() function, clean exit on no work, cleanup trap. May need mock botbus/br for CI.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-29T17:22:47.055798611Z","created_by":"bob","updated_at":"2026-02-02T16:57:58.424357394Z","closed_at":"2026-02-02T16:57:58.424330203Z","close_reason":"Superseded by eval framework — 27 eval runs (R1-R9) cover agent-loop.sh e2e behavior including claim/release, has_work(), cleanup, crash recovery (R9 99%), and parallel dispatch (R6 99%).","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-125","title":"Update dev-loop.mjs to continue on claim failure","description":"## Context\nbotbus is being updated so that staking an already-held claim will fail (instead of extending TTL). This prevents double-firing hooks.\n\n## Changes needed\nIn dev-loop.mjs, when staking/refreshing claims:\n- If stake fails because claim is already held, **continue** (don't exit/fail)\n- Another agent is orchestrating, that's fine\n- Same for refreshing claims - if refresh fails, continue\n\nCheck all `bus claims stake` calls and update error handling to continue instead of failing.","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-04T21:53:12.915576689Z","created_by":"botbox-dev","updated_at":"2026-02-04T21:59:51.045295533Z","closed_at":"2026-02-04T21:59:51.045263463Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-12a","title":"Dev loop should respond to mid-iteration messages from humans","description":"## Problem\n\nWhen a human triggers a dev loop then sends a follow-up message (question, clarification, additional instruction) during the first iteration, the agent doesn't respond. The agent is heads-down working and ignores the new message.\n\nThere's a Claude Code hook that shows unread count in system reminders, but either:\n- It's not working\n- Agents aren't noticing it\n- Agents aren't acting on it\n\n## Expected behavior\n\nAgent should periodically check for and respond to human messages, especially:\n- Questions requiring answers\n- Clarifications or changed requirements\n- Stop/redirect instructions\n\n## Possible solutions\n\n1. **Prompt guidance**: Add explicit \"check inbox for human messages periodically\" to dev-loop prompt, especially noting system reminders about unreads\n\n2. **Loop script injection**: Have dev-loop.mjs check inbox between iterations and inject a reminder into the prompt if there are unreads from humans\n\n3. **Priority interrupts**: @mentions from project owner or humans get special treatment - check more frequently\n\n4. **Stronger hook messaging**: Make the Claude Code hook reminder more actionable: \"STOP: You have unread messages from bob. Check inbox before continuing.\"\n\n## Questions\n\n- How often should agents check? Every N tool calls? Every iteration?\n- Should all messages interrupt, or only from certain agents (humans)?\n- How to distinguish human messages from agent chatter?","status":"closed","priority":2,"issue_type":"feature","owner":"botbox-dev","created_at":"2026-02-04T14:24:48.516260976Z","created_by":"botbox-dev","updated_at":"2026-02-04T15:35:43.159921427Z","closed_at":"2026-02-04T15:35:43.159892703Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-12a","depends_on_id":"bd-1b2","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":5,"issue_id":"bd-12a","author":"botbox-dev","text":"Hook is working (check-bus-inbox.sh fires on PostToolUse). Problem is agents ignore it. The wording says 'IMPORTANT' but agents stay heads-down on current task. May need: (1) stronger hook wording like 'STOP AND CHECK', (2) explicit dev-loop prompt guidance to honor these reminders, (3) or both.","created_at":"2026-02-04T14:25:08Z"},{"id":6,"issue_id":"bd-12a","author":"botbox-dev","text":"Idea: Hook should show truncated message content, not just count.\n\nInstead of:\n  \"You have 1 unread message\"\n\nShow:\n  \"Unread messages in #botbox:\n   - bob: Can you explain why the reviewer didn't...\n   - bob: Also check the maw workspace for...\"\n\nThis makes it:\n1. Immediately clear what the message is about\n2. Harder to ignore - seeing actual content is more compelling\n3. No extra command needed to assess urgency\n\nHook change: `bus inbox --mentions --channels $BASEDIR --limit 5` and format output with sender + truncated body (~80 chars).","created_at":"2026-02-04T14:28:55Z"}]}
{"id":"bd-12k2","title":"E10-1: First run of Full Lifecycle eval","description":"Run the E10 Full Lifecycle eval for the first time using the orchestrator script. Score the results against the rubric, write the report, and record learnings.\n\n## What E10 Tests\n\n2 Rust projects (Alpha API + Beta library), 3 agents (alpha-dev/Opus, alpha-security/Opus, beta-dev/Sonnet), 8 phases. Tests triage, cross-project communication, workspace management, code review with security block/fix/LGTM cycle, finish protocol, and release. 160-point rubric.\n\n## Key Files\n\n- Orchestrator: `evals/scripts/e10-run.sh` (runs everything)\n- Manual phases: `evals/scripts/e10-phase{1..8}.sh` + `e10-phase4_5.sh` + `e10-setup.sh` + `e10-verify.sh`\n- Rubric: `evals/rubrics.md` → E10 section (160 pts, 10 categories, 5 critical fail conditions)\n- Running guide: `notes/eval-framework.md` → \"Running E10\" section (includes report template)\n- Proposal (design rationale): `notes/proposals/e10-full-lifecycle-eval.md`\n\n## Steps\n\n1. Run: `bash evals/scripts/e10-run.sh`\n   - Takes ~30 min, ~$15-25 API cost (mostly Opus)\n   - Outputs EVAL_DIR path — source its .eval-env for inspection\n   - Continues past phase failures, prints summary at end\n2. Score each phase by reading `$EVAL_DIR/artifacts/phase{N}.stdout.log` against the rubric\n   - Check channel history: `BOTBUS_DATA_DIR=$BOTBUS_DATA_DIR bus history alpha -n 30`\n   - Check bead state: `cd $ALPHA_DIR && br show $BEAD`\n   - Check review state: `cd $ALPHA_DIR && crit reviews list`\n   - Run verify: `bash evals/scripts/e10-verify.sh $EVAL_DIR/.eval-env`\n3. Write report to `evals/results/YYYY-MM-DD-e10-run1-opus.md` using template in `notes/eval-framework.md`\n4. Include tool versions from `$EVAL_DIR/artifacts/tool-versions.env`\n5. Add run to `evals/results/README.md` table\n6. Update `notes/eval-framework.md` completed runs count\n7. Add key learnings to `evals/results/README.md` Key Learnings section\n8. Update rubric Runs table in `evals/rubrics.md` E10 section\n\n## Scoring Notes\n\n- Pass >= 112 (70%), Excellent >= 144 (90%)\n- Critical fails override score: merge while blocked, no cross-project msg, /debug exposed, missing identity flags, unreleased claims\n- Tool versions matter — a crit/maw/bus bug can cause failures that aren't the agent's fault (see R4-1 → R4-2)\n\n## Acceptance Criteria\n\n- [ ] All phases ran (check orchestrator summary)\n- [ ] Report written with phase scores, tool versions, critical fail checklist\n- [ ] Key findings and learnings documented\n- [ ] Results table and rubric Runs table updated\n- [ ] Eval framework doc updated with run count","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-06T21:39:35.819680465Z","created_by":"botbox-dev","updated_at":"2026-02-06T22:42:22.402830818Z","closed_at":"2026-02-06T22:42:22.402806683Z","close_reason":"E10-1 scored 158/160 (99% EXCELLENT). Report at evals/results/2026-02-06-e10-run1-opus.md. 3 trial runs needed to fix eval script bugs (JSON key mismatches, workspace path construction, crit FK constraint workaround, verify.sh fixes). All tracking docs updated.","source_repo":".","compaction_level":0,"original_size":0,"labels":["e10"],"comments":[{"id":7,"issue_id":"bd-12k2","author":"botbox-dev","text":"Run 1 aborted: 4 systemic bugs found in eval scripts, all fixed before run 2.\n\n1. WS_PATH empty — maw ws list --format json has no 'path' field. Fix: construct from name (default → project root, named → $PROJECT_DIR/.workspaces/$WS/).\n2. REVIEW_ID empty — jq used '.id' but crit JSON key is 'review_id'. Fix: use '.review_id' in all scripts.\n3. THREAD_ID empty — jq used '.threads[0].id' but crit JSON key is 'thread_id'. Fix: use '.thread_id'.\n4. Phase 4.5 hook check failed — TOON format splits fields across lines, so grep pipeline couldn't match. Fix: switched to --format json with jq.\n\nAlso: workspace discovery used .[0] which picked 'default' instead of the agent-created workspace. Fix: filter for non-default first, fallback to default.\n\nScripts fixed: e10-phase1.sh, e10-phase4.sh, e10-phase4_5.sh, e10-phase5.sh, e10-phase6.sh, e10-phase7.sh, e10-phase8.sh.","created_at":"2026-02-06T21:57:03Z"},{"id":8,"issue_id":"bd-12k2","author":"botbox-dev","text":"Run 2 completed (all phases ran) but 5 FAILs + 1 CRITICAL FAIL. Fixes applied:\n\n1. REVIEW_ID still empty — crit reviews list hits FK constraint error (crit bug). Added fallback: grep phase4 stdout for cr-XXXX pattern. Applied same fallback to phases 5-8.\n2. THREAD_ID still empty — same crit DB issue. Added fallback: grep phase5 stdout for th-XXXX.\n3. Cargo.toml ../beta path — breaks from .workspaces/*/. Added symlink in setup: ln -s ../../beta $ALPHA_DIR/.workspaces/beta.\n4. Switched all phases from raw 'claude -p' to 'botbox run-agent claude' for richer tool-call logs.\n\nRun 2 also validated prior fixes: WS_PATH correct (radiant-castle), phase 4.5 hooks 3/3 PASS.\n\nRemaining failures are downstream of empty REVIEW_ID: bead not closed, workspace not merged, claims unreleased. The review cr-36ia WAS created — just not discoverable due to crit FK bug.","created_at":"2026-02-06T22:23:29Z"}]}
{"id":"bd-138","title":"R8: Adversarial review eval — subtle, hard-to-find bugs","description":"Reviewer agent given code with subtle, hard-to-find bugs that require deep reasoning: race conditions in concurrent code, edge cases in error recovery paths, TOCTOU vulnerabilities, integer overflow in size calculations, incorrect lifetime assumptions. Tests the ceiling of review quality beyond obvious issues like path traversal. Scoring: true positive rate on subtle bugs, false positive rate, severity calibration, evidence quality (does reviewer cite specific execution scenarios?).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T23:42:30.342616553Z","created_by":"bob","updated_at":"2026-02-01T19:22:50.278012796Z","closed_at":"2026-02-01T19:22:50.277939088Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["eval"],"dependencies":[{"issue_id":"bd-138","depends_on_id":"bd-ppt","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":9,"issue_id":"bd-138","author":"Bob","text":"v2 fixture + rubric implemented: 7-file multi-file fixture, cross-file reasoning category (5pts), FP resistance reduced (10→5pts). Files changed: r8-setup.sh, r8-run.sh, eval-review.md, eval-results/README.md. Next: run setup to verify cargo check/clippy, then execute Opus + Sonnet runs.","created_at":"2026-02-01T19:05:07Z"}]}
{"id":"bd-13m","title":"Run Level 2 eval: agent task execution with protocol compliance scoring","description":"Execute first Level 2 behavioral evaluation.\n\nSteps:\n1. Create eval environment in /tmp with botbox init\n2. Seed with simple task (hello world endpoint)\n3. Spawn agent with minimal prompt\n4. Observe behavior, collect tool outputs\n5. Score using rubric (critical steps: claim/start/finish/release/sync)\n6. Document findings: protocol compliance, work quality, gaps\n7. Update eval-proposal.md or create eval-results/ with findings\n\nGoal: Validate that AGENTS.md enables protocol-compliant behavior in practice.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-29T20:33:05.730919055Z","created_by":"bob","updated_at":"2026-01-29T20:38:45.129884958Z","closed_at":"2026-01-29T20:38:45.129861214Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-1436","title":"E10: Write Phase 4 script (alpha resumes + review request)","description":"# Context\n\nPhase 4: alpha-dev resumes work after beta's fix. Reads inbox, verifies tests pass, completes implementation, creates crit review, and requests alpha-security reviewer.\n\n# Goals\n\n- Create `evals/scripts/e10-phase4.sh`\n- Script sources .eval-env, re-discovers workspace name/path\n- Prompt guides alpha-dev through: inbox → verify tests → complete → crit reviews create --path → request alpha-security → announce with @mention\n\n# Background\n\nPhase 4 is scored at 20 points. Key: reads fix announcement, verifies tests pass, completes implementation, creates crit review with --path, requests alpha-security, announces with @mention.\n\nBeta's fix was merged to main in Phase 3. Alpha's Cargo.toml uses path = \"../beta\" which resolves to beta's main worktree, so cargo test in alpha's workspace should now pass.\n\n# Implementation Approach\n\n## State Discovery (pre-run)\n\nRe-discover workspace from Phase 1:\n```bash\nWS=$(cd \"$ALPHA_DIR\" && maw ws list --format json | jq -r '.[0].name')\nWS_PATH=$(cd \"$ALPHA_DIR\" && maw ws list --format json | jq -r '.[0].path')\n```\n\n## State Discovery (post-run)\n\nDiscover review ID:\n```bash\nREVIEW_ID=$(cd \"$ALPHA_DIR\" && crit inbox --all-workspaces --format json 2>/dev/null | jq -r '.[0].id' || cd \"$ALPHA_DIR\" && crit reviews list --format json 2>/dev/null | jq -r '.[-1].id')\n```\nAppend REVIEW_ID to .eval-env.\n\n## Files to Create\n\n- `evals/scripts/e10-phase4.sh`\n\n## Acceptance Criteria\n\n- [ ] Uses Opus model\n- [ ] Re-discovers workspace name/path\n- [ ] Prompt includes workspace path for crit reviews create --path\n- [ ] Review ID extracted and saved to .eval-env\n- [ ] Artifacts saved","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-06T20:46:59.658762768Z","created_by":"botbox-dev","updated_at":"2026-02-06T21:07:52.467756479Z","closed_at":"2026-02-06T21:07:52.467736612Z","close_reason":"Phase 4 script written: evals/scripts/e10-phase4.sh","source_repo":".","compaction_level":0,"original_size":0,"labels":["e10"],"dependencies":[{"issue_id":"bd-1436","depends_on_id":"bd-11wz","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":10,"issue_id":"bd-1436","author":"botbox-dev","text":"Review note: Script should cd to $ALPHA_DIR before invoking claude.","created_at":"2026-02-06T20:55:09Z"}]}
{"id":"bd-14y","title":"add cli, tui to type of project selection in botbox cli","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-31T21:06:34.989501637Z","created_by":"bob","updated_at":"2026-01-31T21:09:06.517491130Z","closed_at":"2026-01-31T21:09:06.517456154Z","close_reason":"Added 'cli' and 'tui' to PROJECT_TYPES in init.mjs. Now supports all 6 types: api, cli, frontend, library, monorepo, tui.","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli"]}
{"id":"bd-150","title":"Fix listAllScripts to use .mjs instead of .sh","description":"listAllScripts() filters for .sh files but we only ship .mjs now. Update it to return .mjs files.\n\nCurrent code:\n```\nreturn readdirSync(SCRIPTS_DIR).filter((f) => f.endsWith('.sh'))\n```\n\nShould be:\n```\nreturn readdirSync(SCRIPTS_DIR).filter((f) => f.endsWith('.mjs'))\n```\n\nThis will allow botbox sync to copy the new Node.js loop scripts.","status":"closed","priority":2,"issue_type":"bug","owner":"botbox-dev","created_at":"2026-02-03T15:32:54.918496793Z","created_by":"botbox-dev","updated_at":"2026-02-03T15:34:41.387380926Z","closed_at":"2026-02-03T15:34:41.387352784Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","sync"],"comments":[{"id":11,"issue_id":"bd-150","author":"botbox-dev","text":"Fixed listAllScripts and SCRIPT_REGISTRY:\n- Changed filter from .sh to .mjs\n- Updated registry keys from .sh to .mjs\n- Removed spawn-security-reviewer entry (deleted script)\n- Updated all tests to match\n\nTests now pass: 17 pass, 0 fail","created_at":"2026-02-03T15:34:41Z"}]}
{"id":"bd-15g1","title":"[hooks] Claude hooks appear partially broken (missing post-compact and inbox reminders)","description":"Investigate and fix Claude hook behavior in packages/cli/hooks:\n- init-agent.sh and check-jj.sh are intended to run on SessionStart and PostCompact, but appear to run only on SessionStart\n- check-bus-inbox.sh PostToolUse reminder may be failing due to channel resolution in maw v2 (ws/default -> #default mismatch) and/or missing --agent identity handling\n- Verify generated .claude/settings.json hook event wiring\n- Reproduce and add regression tests for hook triggering and reminder output\n- Ensure behavior matches intended UX for botbox-managed projects","status":"closed","priority":1,"issue_type":"bug","owner":"botbox-dev","created_at":"2026-02-08T19:59:57.714486772Z","created_by":"botbox-dev","updated_at":"2026-02-09T00:23:47.531897006Z","closed_at":"2026-02-09T00:23:47.531863694Z","close_reason":"Fixed: removed invalid matcher:{}, added PreCompact events, replaced eval with bash arrays, added migration 1.0.13 for settings.json regeneration, sync.mjs now regenerates settings.json on hook updates","source_repo":".","compaction_level":0,"original_size":0,"labels":["botbox","claude-hooks","hooks","regression"],"comments":[{"id":164,"issue_id":"bd-15g1","author":"botbox-dev","text":"Started in workspace northern-bear (/home/bob/src/botbox/ws/northern-bear/)","created_at":"2026-02-08T23:18:54Z"},{"id":166,"issue_id":"bd-15g1","author":"botbox-dev","text":"Fixed all three hook issues:\n\n1. ✅ PreCompact registration: init-agent.sh and check-jj.sh now register for both SessionStart and PreCompact events, maintaining agent context after compaction\n2. ✅ maw v2 channel resolution: check-bus-inbox.sh reads channel from .botbox.json instead of git basename, fixing ws/default → #default mismatch\n3. ✅ Agent identity: check-bus-inbox.sh uses BOTBUS_AGENT env var or defaultAgent from config, properly filtering messages\n\nChanges in workspace northern-bear:\n- Updated HOOK_REGISTRY to support event arrays\n- Modified generateHooksConfig to handle multiple events per hook\n- Rewrote check-bus-inbox.sh with JSON input parsing and config reading\n- Added integration test for check-bus-inbox.sh\n- All tests pass (138/138 core tests green)\n\nReady for review and merge.","created_at":"2026-02-09T00:14:28Z"}]}
{"id":"bd-15lo","title":"Update docs for unified respond.mjs router","description":"Update workflow docs, AGENTS.md template, and CLAUDE.md to reflect the new respond.mjs unified router architecture.\n\n## Context\n\nThe respond.mjs script has changed from a mention-only responder to the single entrypoint for all project channel messages. Docs need to reflect:\n- New ! command syntax (!dev, !bead, !q, !qq, !bigq, !q(model))\n- Single hook architecture (replaces dual dev+respond hooks)\n- Conversation context persistence\n- Triage behavior for bare messages\n- How escalation from conversation to dev-loop works\n\n## What to update\n\n### CLAUDE.md (project root)\n- Update \"Hook Types That Trigger Agents\" table: remove dev hook row, update respond hook description\n- Update respond.mjs description in \"Agent Loop Scripts\" section\n- Add ! command reference\n- Update \"Agent not spawning\" troubleshooting to reflect single hook\n\n### packages/cli/docs/ (workflow docs copied to target projects)\n- Any docs referencing the dev hook or respond hook separately\n- Add ! command reference to appropriate workflow doc\n\n### packages/cli/src/lib/templates.mjs (AGENTS.md template)\n- Update the managed section that describes hooks and commands\n\n### Notes\n- Remove references to requireFlag (no longer needed)\n- Keep reviewer hook documentation as-is (unchanged)\n\n## Acceptance criteria\n\n- [ ] CLAUDE.md reflects single router hook architecture\n- [ ] ! command syntax documented with examples\n- [ ] Conversation context behavior documented\n- [ ] Triage behavior for bare messages documented\n- [ ] Old q:/qq:/big q: syntax noted as deprecated but still supported\n- [ ] Troubleshooting section updated for single hook\n- [ ] AGENTS.md template updated","status":"closed","priority":3,"issue_type":"task","owner":"bob","created_at":"2026-02-07T18:46:24.275520068Z","created_by":"bob","updated_at":"2026-02-07T20:03:25.753076075Z","closed_at":"2026-02-07T20:03:25.753028967Z","close_reason":"Updated CLAUDE.md (hook types table, respond.mjs description, troubleshooting), packages/cli/AGENTS.md (hook registration section). All 175 tests pass.","source_repo":".","compaction_level":0,"original_size":0,"labels":["docs","respond"],"dependencies":[{"issue_id":"bd-15lo","depends_on_id":"bd-11dr","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-15lo","depends_on_id":"bd-2pnv","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-16t","title":"Clean up auto-inserted tool sections from companion AGENTS.md files","description":"## Problem\n\nCompanion projects (maw, botcrit, botbus, botty, beads-tui) have auto-inserted sections in their AGENTS.md files from various tools:\n- `br` / `bv` - beads CLI added sections\n- `maw` - maw agents init added sections  \n- `crit` - possibly added sections\n- Other tools\n\nThese sections are now redundant since botbox provides unified workflow guidance via the managed section.\n\n## Task\n\nFor each companion project in ~/src:\n1. Check AGENTS.md for auto-inserted tool sections (look for markers like `<!-- br:`, `<!-- maw:`, `<!-- crit:`, etc.)\n2. Remove redundant tool-specific sections that duplicate botbox guidance\n3. Keep project-specific content (architecture, conventions, release process, etc.)\n4. Run `botbox sync` to ensure managed section is current\n5. Commit changes\n\n## Projects to check\n- ~/src/maw\n- ~/src/botcrit\n- ~/src/botbus\n- ~/src/botty\n- ~/src/beads-tui","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-04T14:12:15.128324017Z","created_by":"botbox-dev","updated_at":"2026-02-04T15:39:12.992239784Z","closed_at":"2026-02-04T15:39:12.992210749Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-174","title":"Support workspace-scoped reviews in reviewer-loop","description":"Update reviewer-loop.mjs to check for reviews across all jj workspaces (managed by maw).\n\n## Context\ncrit was recently updated to support reviews in jj workspaces. The reviewer-loop script currently only runs `crit inbox` from the repo root, missing reviews that exist in workspace directories.\n\n## Requirements\n1. List all open workspaces via `maw ws list --format json`\n2. For each workspace, run `crit inbox` from that directory\n3. If reviews are found in a workspace:\n   - Include workspace context in the agent prompt\n   - Instruct agent to `cd <workspace-path>` before running crit commands\n   - Ensure agent reads source files from `.workspaces/<ws>/` not repo root\n\n## Implementation\n- Update `hasWork()` to return workspace info, not just boolean\n- Build prompt with workspace context when reviews exist in non-default workspace\n- Consider: crit may add `--all-workspaces` option later (coordinate with crit project)\n\n## Testing\n- Manual test with a review in a workspace\n- Verify agent is prompted to cd to correct directory","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-04T20:33:24.449579515Z","created_by":"botbox-dev","updated_at":"2026-02-04T20:42:03.680680181Z","closed_at":"2026-02-04T20:42:03.680654142Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","scripts"],"comments":[{"id":12,"issue_id":"bd-174","author":"botbox-dev","text":"Completed reviewer-loop.mjs changes:\n- Added listWorkspaces() to enumerate all jj workspaces via maw ws list\n- Added getWorkspacePath() to resolve workspace directory paths  \n- Changed hasWork() to findWork() - returns workspace info with inbox contents\n- Added buildWorkspaceContext() to inject workspace-specific instructions into prompt\n- Updated main loop to log which workspaces have reviews\n- Tests pass (144 pass, 0 fail)\n\nPending: docs update for author-side (crit reviews create --path) may be separate bead","created_at":"2026-02-04T20:35:24Z"},{"id":13,"issue_id":"bd-174","author":"botbox-dev","text":"Docs updated with --path $WS_PATH for workspace-scoped crit commands:\n\n- worker-loop.md: crit reviews create, crit reviews request\n- review-request.md: added note about --path for workspace reviews  \n- review-response.md: all crit commands (inbox, review, reply, request, merge)\n- review-loop.md: crit inbox, review, diff, comment, block, lgtm, reply\n\nReviewers now explicitly instructed to check all workspaces via maw ws list.","created_at":"2026-02-04T20:37:41Z"}]}
{"id":"bd-1b1","title":"Add real-time agent progress output from JSON stream","description":"Use claude --output-format stream-json to show live agent activity instead of just final response.\n\nCurrent state: Scripts run claude and print nothing until the final result. Silent for minutes during work.\n\nDesired state: Real-time progress output showing:\n- Tool calls as they happen (Read, Write, Edit, Bash, etc.)\n- Tool results (truncated for readability)\n- Thinking progress (optional, could be verbose)\n- Status updates (\"Reading file...\", \"Running tests...\")\n- Final result\n\nJSON stream format:\n- {\"type\":\"tool_use\", \"name\":\"Read\", \"input\":{\"file_path\":\"...\"}}\n- {\"type\":\"tool_result\", \"content\":\"...\"}\n- {\"type\":\"text\", \"text\":\"...\"} (thinking or response)\n- {\"type\":\"result\", ...} (completion signal)\n\nImplementation ideas:\n- Parse JSON stream line-by-line\n- Pretty-print tool calls with colors/formatting\n- Show truncated tool results (first 100 chars)\n- Optional --verbose flag for full output\n- Progress spinner between events\n\nExample output:\n  🔧 Read packages/cli/src/index.mjs\n  ✓ Read complete (1243 bytes)\n  🔧 Edit packages/cli/src/index.mjs\n  ✓ Edit complete\n  📝 Final response: [...]\n\nDependencies: Requires bd-s9n (node mjs conversion) OR implement in bash with jq.","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-03T13:46:21.364957081Z","created_by":"botbox-dev","updated_at":"2026-02-03T13:58:38.034319126Z","closed_at":"2026-02-03T13:58:38.034294980Z","close_reason":"Completed. All loop scripts now show real-time progress with tool calls, results, and thinking output.","source_repo":".","compaction_level":0,"original_size":0,"labels":["agent-loop","enhancement","ux"]}
{"id":"bd-1b2","title":"Improve Claude Code inbox hook to show message previews","description":"## Problem\n\nThe current check-bus-inbox.sh hook shows only count:\n  \"You have 1 unread message\"\n\nAgents see this but deprioritize it because they don't know what the message is about.\n\n## Solution\n\nShow truncated message previews instead:\n\n```\nUnread messages in #botbox:\n- bob: Can you explain why the reviewer didn't spawn...\n- bob: Also check the maw workspace for conflicts...\n```\n\n## Implementation\n\nUpdate ~/.claude/hooks/check-bus-inbox.sh to:\n1. Run `bus inbox --mentions --channels $BASEDIR --limit 5`\n2. Parse output and format as: `sender: truncated_body` (~80 chars)\n3. Include the command to mark read\n\n## Why this helps\n\n- Immediately clear what messages are about\n- Harder to ignore actual content vs abstract count\n- Agent can assess urgency without extra command","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-04T14:31:51.113921225Z","created_by":"botbox-dev","updated_at":"2026-02-04T15:34:26.603590315Z","closed_at":"2026-02-04T15:34:26.603572442Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":14,"issue_id":"bd-1b2","author":"botbox-dev","text":"Updated ~/.claude/hooks/check-bus-inbox.sh to show message previews instead of just count. Uses STOP: prefix and shows sender + truncated body. Tested - working.","created_at":"2026-02-04T15:34:26Z"}]}
{"id":"bd-1c5","title":"Add bead title to worker-loop announcements","description":"Update worker-loop.md task-claim and task-done announcement templates to include the bead title.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T22:34:34.203498408Z","created_by":"bob","updated_at":"2026-02-01T22:45:08.809753985Z","closed_at":"2026-02-01T22:45:08.809730681Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":15,"issue_id":"bd-1c5","author":"Bob","text":"Updated worker-loop.md task-claim/task-done announcement templates to include bead titles.","created_at":"2026-02-01T22:45:05Z"}]}
{"id":"bd-1cu","title":"Add review-loop journal (review-loop-<role>.txt)","description":"Similar to dev-loop.txt, add a journal for review loops: review-loop-<role>.txt. Append entries, truncate at loop start.","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-05T01:47:39.967200118Z","created_by":"botbox-dev","updated_at":"2026-02-05T02:04:58.511717114Z","closed_at":"2026-02-05T02:04:58.511685665Z","close_reason":"Merged to main (cr-3spv approved)","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":16,"issue_id":"bd-1cu","author":"botbox-dev","text":"Implemented in workspace red-falcon. Added review-loop-<role>.txt journal, updated reviewer prompts for iteration-summary output.","created_at":"2026-02-05T01:52:34Z"}]}
{"id":"bd-1db","title":"Add merge conflict recovery guidance to finish.md","description":"## Problem\n\nAgents struggle when `maw ws merge` creates divergent commits or conflicts. Observed in botcrit-dev and maw-dev sessions:\n- Agents try various jj commands (rebase, squash, restore)\n- jj squash sometimes times out\n- Agents end up abandoning 3-8 orphaned commits\n- Eventually reapply changes manually on main\n\n## Fix\n\nUpdate `packages/cli/docs/finish.md` to include a \"Merge Conflict Recovery\" section:\n\n```markdown\n## Merge Conflict Recovery\n\nIf `maw ws merge` shows \"WARNING: Merged workspace has diverged from main\":\n\n### Quick fix for .beads/.crit conflicts only:\n```bash\njj restore --from main .beads/ .crit/\njj squash\n```\n\n### Full recovery if merge is messy:\n```bash\n# 1. Find your feature commit (has your changes)\njj log -r 'all()' --limit 15\n\n# 2. Abandon the merge mess\njj abandon <merge-commit-id> <empty-commit-ids>\n\n# 3. Move to your feature commit\njj edit <feature-commit-id>\n\n# 4. Set main and push\njj bookmark set main -r @\njj git push\n```\n\n### Prevention (coming soon)\nmaw will auto-resolve .beads/ and .crit/ conflicts - see bd-3lq on maw.\n```\n\n## Files\n- packages/cli/docs/finish.md","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-04T00:18:28.703765327Z","created_by":"botbox-dev","updated_at":"2026-02-04T15:32:42.912176725Z","closed_at":"2026-02-04T15:32:42.912152310Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-1e3","title":"Add migration registry and sync wiring","description":"Implement migration registry (packages/cli/src/migrations/index.mjs), add initial scripts-move migration, wire sync to run pending migrations and update .botbox.json.version, and align init to latest migration version. Acceptance: botbox sync runs migrations before other updates, updates config version after each, keeps managed section logic intact. Testing: covered by updated sync tests.","status":"closed","priority":2,"issue_type":"task","owner":"1","created_at":"2026-02-03T16:01:07.015014520Z","created_by":"1","updated_at":"2026-02-03T16:08:29.503661682Z","closed_at":"2026-02-03T16:08:29.503636514Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":17,"issue_id":"bd-1e3","author":"1","text":"Started in workspace botbox (/home/bob/src/botbox). Implementing migration registry, scripts-move migration, and sync wiring.","created_at":"2026-02-03T16:01:19Z"},{"id":18,"issue_id":"bd-1e3","author":"1","text":"Implemented migration registry (packages/cli/src/migrations/index.mjs), wired sync to run pending migrations and update .botbox.json version, moved scripts migration into registry, and aligned init version to latest migration. Ready to close.","created_at":"2026-02-03T16:08:25Z"}]}
{"id":"bd-1eb","title":"Add ecosystem project links to README","description":"Update botbox README.md to include links to all botbox ecosystem projects:\n- beads (https://github.com/StandardInput/beads)\n- maw (https://github.com/StandardInput/maw)\n- crit (https://github.com/StandardInput/crit)\n- botbus (https://github.com/StandardInput/botbus)\n- botty (https://github.com/StandardInput/botty)\n\nAdd a section explaining how these tools work together in the botbox ecosystem.","status":"closed","priority":3,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-03T01:48:03.654416735Z","created_by":"botbox-dev","updated_at":"2026-02-03T01:57:42.032694943Z","closed_at":"2026-02-03T01:57:42.032672962Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":19,"issue_id":"bd-1eb","author":"botbox-dev","text":"Updated README.md with ecosystem project links:\n- Renamed 'Stack' section to 'Ecosystem'\n- Added GitHub links for all 5 tools (botbus, maw, beads, crit, botty)\n- Added 'How they work together' subsection explaining the integration\n- Expanded tool descriptions in the table","created_at":"2026-02-03T01:57:38Z"}]}
{"id":"bd-1ed","title":"Update report-issue.md: check if lead agent is online, spawn if not","description":"report-issue.md currently stops at \"post to the project channel and return to your work.\" It should add a step to check if the receiving project's dev agent is online and spawn it if not.\n\n## New steps (after posting to channel)\n\n5. Check if the lead agent is running:\n   bus check-claim --agent \\$AGENT \"agent://<lead-agent>\"\n6. If not running, spawn it:\n   botty spawn --name <lead-agent> -- bash scripts/dev-loop.sh <project> <lead-agent>\n\nThe lead agent name and project info are already extracted from the #projects registry in step 1.\n\n## Notes\n\n- This is the manual fallback. Once botbus hooks ship (bd-2km), the spawn happens automatically on bus send. But agents should still do this check as a belt-and-suspenders measure.\n- Same pattern already exists in dev-loop.sh for spawning reviewers.\n- botty spawn may not be available in all environments — skip gracefully.\n\n## Acceptance criteria\n\n- report-issue.md includes check-and-spawn steps\n- The steps use the lead agent name from the #projects registry (not hardcoded)\n- Graceful fallback if botty is not available","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-02T16:03:45.940635901Z","created_by":"bob","updated_at":"2026-02-02T16:06:37.357536427Z","closed_at":"2026-02-02T16:06:37.357507904Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":20,"issue_id":"bd-1ed","author":"Bob","text":"Starting: adding spawn-if-offline steps to report-issue.md","created_at":"2026-02-02T16:06:08Z"},{"id":21,"issue_id":"bd-1ed","author":"Bob","text":"Done: added step 5 (check if lead agent is online, spawn via botty if not). Also updated step 1 to use bus history instead of bus inbox for registry queries.","created_at":"2026-02-02T16:06:37Z"}]}
{"id":"bd-1ej","title":"Add .botbox.json config file for project parameters","description":"Replace argument passing with a JSON config file that stores project parameters.\n\nCurrent issue: Project settings (review enabled, models, timeouts, reviewers) are passed as script arguments or hardcoded defaults. This makes configuration inflexible and the hook commands verbose.\n\nSolution: Create .botbox.json config file with structure:\n- project: name, type, languages\n- tools: enabled tools (beads, maw, crit, botbus, botty)\n- review: enabled flag, reviewer roles\n- agents: dev/worker/reviewer settings (model, timeouts, max_loops, pause)\n\nChanges needed:\n1. init.mjs: Generate .botbox.json during botbox init (capture all user selections)\n2. Loop scripts: Read config with jq instead of using arguments/defaults\n   - dev-loop.sh: Read review.enabled, agents.dev.model, etc.\n   - agent-loop.sh: Read agents.worker settings\n   - reviewer-loop.sh: Read agents.reviewer settings\n3. Hook registration: Read config to build spawn commands\n4. doctor command: Validate config file exists and is well-formed\n5. Update AGENTS.md template to reference config file\n\nTesting:\n- Run botbox init, verify .botbox.json created with correct values\n- Run loop scripts, verify they read config correctly\n- Test with various config values (review enabled/disabled, different models)\n- Verify backwards compat (scripts work without config via defaults)","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-02T23:45:11.952493046Z","created_by":"botbox-dev","updated_at":"2026-02-02T23:46:57.237132235Z","closed_at":"2026-02-02T23:46:57.237102579Z","close_reason":"Completed: Added .botbox.json config file for project parameters","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":22,"issue_id":"bd-1ej","author":"botbox-dev","text":"Starting implementation\n\nPlan:\n1. Add config generation to init.mjs (after AGENTS.md generation)\n2. Update loop scripts to read config with jq (with fallback to defaults)\n3. Test with bun test\n4. Manually test config reading\n\nUpdated CLAUDE.md to emphasize tracking work in beads before starting.","created_at":"2026-02-02T23:45:36Z"},{"id":23,"issue_id":"bd-1ej","author":"botbox-dev","text":"Config generation working\n\n.botbox.json is now generated during botbox init with all settings.\nTested manually - config file created with correct structure.\n\nNext: Update loop scripts to read config with jq.","created_at":"2026-02-02T23:46:05Z"},{"id":24,"issue_id":"bd-1ej","author":"botbox-dev","text":"Implementation complete\n\nChanges made:\n1. init.mjs: Generate .botbox.json with all project settings after AGENTS.md\n2. dev-loop.sh: Read review.enabled, agents.dev.* from config\n3. agent-loop.sh: Read agents.worker.* from config\n4. reviewer-loop.sh: Read agents.reviewer.* from config\n\nAll scripts use jq to read config with fallback to defaults if config missing or jq not available.\n\nTesting:\n- All 100 tests pass\n- Manual test: Created test project, config generated correctly\n- Config reading works: REVIEW=true picked up from config\n- Syntax validated for all three scripts\n\nFiles changed:\n- packages/cli/src/commands/init.mjs\n- packages/cli/scripts/dev-loop.sh\n- packages/cli/scripts/agent-loop.sh\n- packages/cli/scripts/reviewer-loop.sh\n- CLAUDE.md (added emphasis on tracking work in beads)","created_at":"2026-02-02T23:46:52Z"}]}
{"id":"bd-1gi","title":"Add guidance: post review details to bead comment","description":"When an agent creates a review, they should post a comment on the bead with:\n- The review ID\n- The workspace name\n- The workspace path relative to the project root\n\nThis helps with crash recovery and handoffs - another agent can find the review and workspace from the bead comments.\n\nUpdate review-request.md to include this guidance.","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-04T22:43:03.862488812Z","created_by":"botbox-dev","updated_at":"2026-02-04T23:28:13.100626487Z","closed_at":"2026-02-04T23:28:13.100600248Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-1gy","title":"R8v2: update results tables and CLAUDE.md eval count","description":"After both runs: add R8-2 and R8-3 rows to eval-review.md Results table, eval-results/README.md Runs table. Update CLAUDE.md eval count. Add individual report links.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T19:08:18.348542476Z","created_by":"bob","updated_at":"2026-02-01T19:22:33.203975072Z","closed_at":"2026-02-01T19:22:33.203906624Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["eval"],"dependencies":[{"issue_id":"bd-1gy","depends_on_id":"bd-138","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-1gy","depends_on_id":"bd-36m","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-1gy","depends_on_id":"bd-fxk","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-1jk","title":"Fix br label command syntax in groom.md","description":"Review cr-xvwo identified critical errors in packages/cli/docs/groom.md:\n\n- Line 16: Shows 'br label create <name>' which doesn't exist, and wrong syntax for 'br label add'\n- Line 79: Same issue - references non-existent 'br label create <name>'\n\nCorrect syntax is:\n- 'br label add -l <label> <issue-id>' (creates label implicitly if it doesn't exist)\n- No 'br label create' command exists\n\nFix all references throughout the document to use correct syntax.\n\nAcceptance criteria:\n- All instances of 'br label create' removed\n- All instances of 'br label add <bead-id> <label>' corrected to 'br label add -l <label> <bead-id>'\n- Document accurately reflects actual br command behavior\n\nTesting: Review the updated doc for accuracy against 'br label --help' output.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T23:40:31.666788909Z","created_by":"bob","updated_at":"2026-02-02T16:57:48.342242534Z","closed_at":"2026-02-02T16:57:48.342218389Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":25,"issue_id":"bd-1jk","author":"botbox-dev","text":"Fixed triage.md line 27: removed non-existent 'br label create' command, corrected 'br label add' syntax to use '-l <label> <bead-id>' format. groom.md was already correct. No other files had wrong syntax.","created_at":"2026-02-02T16:57:48Z"}]}
{"id":"bd-1jp","title":"E2E: existing repo clone and init","description":"Test 3 from testing.md — clone botcrit into /tmp, run botbox init, verify no clobbering","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T18:39:18.848612765Z","created_by":"bob","updated_at":"2026-01-29T18:42:48.498968565Z","closed_at":"2026-01-29T18:42:48.498955330Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-1jx","title":"instruct agents, when creating reviews, always add a description","description":"they should mention relevant beads in the description","status":"closed","priority":3,"issue_type":"feature","owner":"botbox-dev","created_at":"2026-02-03T14:45:09.632237473Z","created_by":"bob","updated_at":"2026-02-03T15:05:30.197180017Z","closed_at":"2026-02-03T15:05:30.197156182Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"labels":["protocol"],"comments":[{"id":26,"issue_id":"bd-1jx","author":"botbox-dev","text":"Updated worker-loop.md step 5:\n\n- Modified crit reviews create instruction to require bead ID in description\n- Added guidance: 'For <bead-id>: <summary of changes, what was done, why>'\n- Added note to always include bead ID for reviewer context\n- Emphasized explaining what and why, not just summary\n\nReviewers will now have bead context when reviewing code.","created_at":"2026-02-03T15:05:26Z"}]}
{"id":"bd-1jz7","title":"Docs: fix jj tag set (not create) and add --title to crit reviews create","description":"Two doc fixes from E10-2 eval:\n\n1. CLAUDE.md references 'jj tag create' but installed jj (0.37.0) uses 'jj tag set'. Phase 8 agent hit 'unrecognized subcommand create', checked --help, recovered.\n\n2. crit reviews create requires --title but this isn't shown in CLAUDE.md quick reference or workflow docs. Phase 4 agent got 'required arguments not provided: --title', retried.","status":"closed","priority":2,"issue_type":"bug","owner":"botbox-dev","created_at":"2026-02-07T02:08:20.411594683Z","created_by":"botbox-dev","updated_at":"2026-02-07T18:19:14.338503299Z","closed_at":"2026-02-07T18:19:14.338465118Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"labels":["docs"],"comments":[{"id":27,"issue_id":"bd-1jz7","author":"botbox-dev","text":"Fixed: changed jj tag create → jj tag set in worker-loop.md, AGENTS.md, dev-loop.mjs, agent-loop.mjs, e10-phase8.sh. Added --title to crit reviews create in AGENTS.md quick reference. All 145 tests pass.","created_at":"2026-02-07T18:19:13Z"}]}
{"id":"bd-1kb","title":"Move botbox scripts to .agents/botbox/scripts/","description":"Change script installation location from scripts/ to .agents/botbox/scripts/ to keep all botbox files together.\n\nCurrent issue: Loop scripts are copied to scripts/ at project root, which mixes botbox tooling with potential project scripts.\n\nSolution: Copy scripts to .agents/botbox/scripts/ instead.\n\nChanges needed:\n1. scripts.mjs: Change destination from scripts/ to .agents/botbox/scripts/\n2. init.mjs: Update hook registration to use .agents/botbox/scripts/dev-loop.sh\n3. Update AGENTS.md template to reference new script location\n4. Tests: Update assertions to check for .agents/botbox/scripts/\n5. Migration: Existing projects need guidance (can delete old scripts/)\n\nHook command changes from:\n  botty spawn ... -- bash scripts/dev-loop.sh\n\nTo:\n  botty spawn ... -- bash .agents/botbox/scripts/dev-loop.sh\n\nTesting:\n- Run botbox init, verify scripts copied to .agents/botbox/scripts/\n- Verify hook registration uses new path\n- Test script execution from new location\n- All tests pass","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-03T00:11:53.824137408Z","created_by":"botbox-dev","updated_at":"2026-02-03T00:13:21.488483937Z","closed_at":"2026-02-03T00:13:21.488459982Z","close_reason":"Completed: Scripts now in .agents/botbox/scripts/","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":28,"issue_id":"bd-1kb","author":"botbox-dev","text":"Implementation complete\n\nChanges:\n1. init.mjs: Changed scriptsDir from scripts/ to .agents/botbox/scripts/\n2. init.mjs: Updated hook registration to use .agents/botbox/scripts/dev-loop.sh\n3. init.test.mjs: Updated tests to check .agents/botbox/scripts/ directory\n\nScripts are now kept with other botbox files in .agents/botbox/:\n  .agents/botbox/\n    docs/          (workflow docs)\n    scripts/       (loop scripts) ← NEW LOCATION\n    .docs-version\n    .scripts-version\n\nHook command now uses: bash .agents/botbox/scripts/dev-loop.sh\n\nTesting:\n- All 100 tests pass\n- Manual test: Scripts copied to correct location\n- Hook registration uses new path (verified in hook output)\n\nMigration note: Existing projects can delete old scripts/ directory after running botbox sync to get updated hooks.","created_at":"2026-02-03T00:13:16Z"}]}
{"id":"bd-1lm","title":"Add loop journal metadata (jj refs, etc)","description":"Brainstorm and optionally add metadata to loop journal entries. Consider jj refs, timestamps, bead IDs. Only if simple and valuable.","status":"closed","priority":3,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-05T01:47:41.944459643Z","created_by":"botbox-dev","updated_at":"2026-02-05T02:04:58.574581734Z","closed_at":"2026-02-05T02:04:58.574550145Z","close_reason":"Merged to main (cr-3spv approved)","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":29,"issue_id":"bd-1lm","author":"botbox-dev","text":"Implemented in workspace red-falcon. Added jj change ID to journal entry headers.","created_at":"2026-02-05T01:53:35Z"}]}
{"id":"bd-1mz","title":"Update maw docs: remove .crit/** from auto_resolve_from_main examples","description":"## Context\n\nCrit v2 migrated from single `events.jsonl` to per-review event logs:\n```\n.crit/reviews/<review-id>/events.jsonl\n```\n\nThis eliminates the concurrent write / merge conflict issues that plagued multi-agent workflows. The old architecture caused truncation and lost reviews (see maw bd-1cl, botcrit bd-2m6).\n\n## Problem\n\nmaw docs still recommend `.crit/**` in auto_resolve_from_main:\n\n**README.md** (line ~96):\n```toml\nauto_resolve_from_main = [\".beads/**\", \".crit/**\"]\n```\n\n**AGENTS.md** (line ~251):\n> Add `auto_resolve_from_main` config to auto-resolve conflicts in specified paths (e.g., `.beads/**`, `.crit/**`)\n\n**finish.md** (~line 55-58):\n```bash\n# Quick fix for .beads/.crit conflicts\njj restore --from main .beads/ .crit/\n```\n\nWith crit v2's per-review structure, `.crit/` conflicts are rare (only if two agents work on the same review). The auto_resolve guidance is now misleading and potentially harmful - it could discard review events unnecessarily.\n\n## Changes needed\n\n1. **README.md**: Remove `.crit/**` from auto_resolve example, or add note that it's only for legacy crit\n2. **AGENTS.md**: Same - update release notes section\n3. **finish.md**: Update \"quick fix\" section - `.crit/` conflicts should be rare now, may not need special handling\n\n## Note on .beads/\n\n`.beads/issues.jsonl` is still a single file, but less problematic than crit was:\n- Issue updates are less frequent than review comments/votes\n- Beads has simpler merge semantics (append-only, dedupe by ID)\n- Keep `.beads/**` in auto_resolve guidance for now\n\n## Source\n\nDiscussion with bob after testing maw+crit v2 multi-workspace workflow. Test confirmed per-review events work correctly and merge cleanly.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-04T19:28:06.457471801Z","created_by":"bob","updated_at":"2026-02-04T19:32:28.493471715Z","closed_at":"2026-02-04T19:32:28.493444013Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":30,"issue_id":"bd-1mz","author":"botbox-dev","text":"Completed. Updated docs in both repos:\n\nmaw (e8468a7):\n- README.md: removed .crit/** from auto_resolve example, added note about crit v2 per-review structure\n- AGENTS.md: updated release notes\n\nbotbox (e979e23):\n- finish.md: updated quick fix section to focus on .beads/, added note that .crit/ conflicts should be investigated\n\nBoth pushed to main.","created_at":"2026-02-04T19:32:28Z"}]}
{"id":"bd-1pe","title":"botbox sync should update managed section even when docs are unchanged","description":"sync checks doc content hashes and exits early with 'Already up to date' when docs haven't changed. But the managed section is rendered from templates.mjs, which can change independently. Template changes (e.g., identity section, workspace claim URI) don't trigger a managed section update. Fix: either include templates.mjs in the version hash, or always regenerate the managed section and compare.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-30T16:57:27.959057530Z","created_by":"bob","updated_at":"2026-02-02T00:14:09.012315039Z","closed_at":"2026-02-02T00:14:09.012292798Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":31,"issue_id":"bd-1pe","author":"Bob","text":"Grooming: Acceptance criteria: 'botbox sync' must regenerate managed section even when doc content unchanged. Testing: modify templates.mjs without changing docs, run sync, verify AGENTS.md updated. Implementation approach: remove early exit when docs unchanged, or include template version in hash.","created_at":"2026-02-01T23:45:05Z"},{"id":32,"issue_id":"bd-1pe","author":"Bob","text":"Progress: Fixed sync.mjs to always regenerate managed section. Now testing the fix.","created_at":"2026-02-01T23:45:52Z"},{"id":33,"issue_id":"bd-1pe","author":"Bob","text":"Resolved conflict in .beads/issues.jsonl in workspace red-forge. Workspace is clean and ready for review. Review cr-1d5x pending with bronze-beacon.","created_at":"2026-02-01T23:49:57Z"},{"id":34,"issue_id":"bd-1pe","author":"Bob","text":"Review feedback addressed:\n- th-a7o0 (MEDIUM): Added --check validation for stale managed section. Now sync --check throws when managed section is stale even if docs are current.\n- th-j7n2 (INFO): Won't fix - inline comparison is intentional for simplicity.\n- th-4lsq (LOW): Added test case for --check with stale managed section.\nAll tests pass (8/8). Re-requesting review.","created_at":"2026-02-01T23:56:32Z"},{"id":35,"issue_id":"bd-1pe","author":"Bob","text":"Addressed all review feedback from cr-1d5x:\n\nHIGH issues fixed:\n- th-j5ah: Moved --check validation to after both doc and managed section checks, before any writes\n- th-r375: --check is now truly read-only, throws before any writeFileSync calls\n- th-a7o0: --check now validates both doc and managed section staleness\n\nMEDIUM issue fixed:\n- th-4lsq: Added test case for --check with stale managed section\n\nLOW issue fixed:\n- th-tlnr: Added console output for managed-only updates\n\nAll tests pass. Re-requesting review.","created_at":"2026-02-02T00:01:45Z"},{"id":36,"issue_id":"bd-1pe","author":"Bob","text":"Re-requested review cr-1d5x after applying all fixes. Issues addressed: (1) --check validation moved to line 43, before any writes, checking BOTH docs and managed section. (2) Test added at lines 134-162 for --check with stale managed section. (3) Console output added at line 73 for managed-only updates. All 8 tests pass. Waiting for re-review.","created_at":"2026-02-02T00:04:59Z"},{"id":37,"issue_id":"bd-1pe","author":"Bob","text":"Responded to review cr-1d5x feedback. Clarified to reviewers that fixes are in workspace /home/bob/src/botbox/.workspaces/red-forge/, not project root. All fixes are implemented: sync.mjs lines 28-40 (staleness checks), line 43 (--check validation before writes), test at lines 134-162. All 8 tests pass in workspace.","created_at":"2026-02-02T00:06:29Z"},{"id":38,"issue_id":"bd-1pe","author":"Bob","text":"Responded to review cr-1d5x with evidence that all fixes are implemented in workspace .workspaces/red-forge/.\n\nIssue: Reviewer (phantom-tower) was reading project root (55 lines, unchanged) instead of workspace (76 lines, refactored). Added clarifying comments to threads th-a7o0, th-j5ah, th-r375, th-4lsq with:\n- Line-by-line breakdown of fix implementation\n- Test verification (all 8 tests pass)\n- Reminder that review protocol evaluates workspace content, not project root\n\nWaiting for reviewer to re-evaluate using workspace content. Review currently BLOCKED by botbox-dev (vote), though phantom-tower is the active commenter. Review status: 1 block (botbox-dev), 1 LGTM (phantom-tower).","created_at":"2026-02-02T00:08:32Z"},{"id":39,"issue_id":"bd-1pe","author":"Bob","text":"Review feedback addressed. Root cause was stale jj workspace (needed 'jj workspace update-stale'). All fixes were already in workspace files but not visible to jj until update. Re-described commit as xwwlsvol/0 (338d3602), replied to 5 blocking threads (th-j5ah, th-r375, th-a7o0, th-tlnr, th-4lsq), re-requested review from botbox-dev and phantom-tower. Workspace: red-forge at /home/bob/src/botbox/.workspaces/red-forge/","created_at":"2026-02-02T00:11:32Z"},{"id":40,"issue_id":"bd-1pe","author":"Bob","text":"Completed by crystal-anchor. Review cr-1d5x merged with commit fe839efa.","created_at":"2026-02-02T00:14:05Z"}]}
{"id":"bd-1pp","title":"UX test: subagent reads AGENTS.md and answers workflow questions","description":"Spawn a subagent in a fresh botbox-initialized repo. Have them read AGENTS.md and answer questions about the workflow to validate doc clarity and completeness.\n\nSteps:\n1. Create fresh test repo with botbox init\n2. Spawn subagent in that directory\n3. Ask them to read AGENTS.md\n4. Ask non-leading questions about: identity, triage, starting work, cross-project feedback, reviews, tools\n5. Evaluate their understanding\n6. Write report of findings\n7. Create ux-test.md documenting this testing methodology","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T19:47:54.813706644Z","created_by":"bob","updated_at":"2026-01-29T19:50:25.957862776Z","closed_at":"2026-01-29T19:50:25.957834984Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-1sc","title":"Dev loops should check for unfinished work on startup","description":"Dev lead agents (dev-loop.mjs) should always check for in_progress beads they own on startup, not just triage for new work. This handles crash recovery naturally - if an agent dies mid-work, the next dev loop picks up where it left off.\n\nChanges needed:\n- dev-loop.mjs: Check for owned in_progress beads before triaging\n- Possibly add to worker-loop.md guidance\n- Consider: should this also check for uncommitted workspace changes?","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-05T16:41:09.222533364Z","created_by":"botbox-dev","updated_at":"2026-02-05T17:26:28.003187513Z","closed_at":"2026-02-05T17:26:28.003124344Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":41,"issue_id":"bd-1sc","author":"botbox-dev","text":"Completed implementation:\n\n1. Added getUnfinishedBeads() helper function to dev-loop.mjs that queries br list --status in_progress --assignee\n2. Modified hasWork() to check for unfinished beads first (crash recovery)\n3. Enhanced buildPrompt() to add comprehensive UNFINISHED WORK CHECK as step 1, before the existing RESUME CHECK\n4. Renumbered all subsequent steps (INBOX became step 3, TRIAGE became step 4, etc.)\n5. Updated worker-loop.md step 0 to include comprehensive unfinished work check instructions\n6. All tests pass (bun test)\n\nThe dev loop now automatically resumes unfinished work on startup, handling crash recovery naturally.","created_at":"2026-02-05T17:26:25Z"}]}
{"id":"bd-1st","title":"Remove 'correctness' reviewer role from docs and examples","description":"The 'correctness' reviewer role is vague and doesn't convey a clear responsibility. Remove it from all docs and examples.\n\nAreas to update:\n- Workflow docs (review-request.md mentions it)\n- Example reviewer names in docs\n- Any .botbox.json examples or templates\n- AGENTS.md templates\n\nKeep 'security' as the primary specialist role for now. We can define additional specific roles later (e.g., performance, api-design, concurrency) when we have clear use cases.","status":"closed","priority":3,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-03T15:12:07.281886741Z","created_by":"botbox-dev","updated_at":"2026-02-03T15:17:41.321539215Z","closed_at":"2026-02-03T15:17:41.321516602Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"labels":["cleanup","docs"],"comments":[{"id":42,"issue_id":"bd-1st","author":"botbox-dev","text":"Removed 'correctness' reviewer role from all sources:\n\nUpdated code:\n- init.mjs: Removed from REVIEWER_ROLES array and JSDoc\n- index.mjs: Updated help text to only mention 'security'\n- templates.test.mjs: Updated tests to use only 'security'\n- scripts.test.mjs: Changed test to use empty reviewer array\n\nAlready removed in earlier commit:\n- review-request.md: Only mentions 'security' as example\n- worker-loop.md: Changed to 'e.g., security'\n\nLeft unchanged (general concept, not reviewer role):\n- dev-loop.mjs: 'correctness' as code quality concept\n- reviewer-loop.mjs: Same\n- review-loop.md: Same\n\nNote: Some tests now fail due to removed bash scripts (separate issue)","created_at":"2026-02-03T15:17:37Z"}]}
{"id":"bd-1tf","title":"Update workflow docs for simplified maw merge","description":"Check latest maw release in #maw channel for simplified merge workflow. Update botbox workflow docs, scripts, and guidance to cover the new approach.","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-05T16:01:15.590631867Z","created_by":"botbox-dev","updated_at":"2026-02-05T16:02:22.544178574Z","closed_at":"2026-02-05T16:02:22.544148878Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":43,"issue_id":"bd-1tf","author":"botbox-dev","text":"Progress: Reviewed maw v0.22.0 release notes. Key change: maw ws merge now produces linear history with squash-based approach instead of merge commits. No merge commits, auto-abandon scaffolding, auto-moves main bookmark. Now updating botbox docs to reflect this.","created_at":"2026-02-05T16:01:41Z"},{"id":44,"issue_id":"bd-1tf","author":"botbox-dev","text":"Updated all relevant workflow docs and scripts to document maw v0.22.0's simplified merge workflow. Changes made:\n\n1. finish.md: Added notes that maw ws merge now produces linear history with rebased and squashed commits, with auto-abandoned scaffolding and auto-moved main bookmark\n2. worker-loop.md: Added v0.22.0+ note about linear squashed history\n3. review-response.md: Clarified that maw ws merge rebases and squashes (v0.22.0+)\n4. agent-loop.mjs: Updated finish step prompt to document linear merge and auto-moved main\n5. dev-loop.mjs: Updated both sequential and parallel dispatch merge steps with v0.22.0+ notes\n\nAll updates are backward compatible and focus on explaining the improved workflow to agents.","created_at":"2026-02-05T16:02:20Z"}]}
{"id":"bd-1thv","title":"E10: Write Phase 5 script (security review)","description":"# Context\n\nPhase 5: alpha-security reviews the code, finds the /debug vulnerability, leaves a CRITICAL crit comment, and blocks the review.\n\n# Goals\n\n- Create `evals/scripts/e10-phase5.sh`\n- Script sources .eval-env, uses $REVIEW_ID and $WS_PATH\n- Prompt guides alpha-security through: crit inbox → read review → read FULL source files from workspace path → find /debug → comment with CRITICAL → block → announce on bus\n\n# Background\n\nPhase 5 is scored at 20 points. Key: discovers review via crit inbox, reads from workspace path (not project root), finds /debug secret exposure (5 pts — highest single criterion), correct severity tag, blocks review, announces.\n\nIMPORTANT: crit reviews create produces a diff-based review. The /debug endpoint is pre-existing code and won't appear in the diff. The prompt MUST instruct the reviewer to \"review the full codebase accessible at the workspace path, not just the diff\" to ensure the vulnerability is discoverable.\n\n# Implementation Approach\n\n## State Discovery (pre-run)\n\nRe-discover review ID and workspace path:\n```bash\nREVIEW_ID=$(cd \"$ALPHA_DIR\" && crit reviews list --format json 2>/dev/null | jq -r '.[-1].id')\nWS_PATH=$(cd \"$ALPHA_DIR\" && maw ws list --format json | jq -r '.[0].path')\n```\n\n## Prompt Construction\n\nCritical prompt elements:\n- Agent identity: alpha-security (security reviewer)\n- Explicit instruction to read the FULL source files from workspace, not just the diff\n- Review ID and workspace path\n- Focus areas: input validation, data exposure, access control, secret management\n- Severity tags: CRITICAL, HIGH, MEDIUM, LOW, INFO\n- Block threshold: CRITICAL or HIGH issues → block\n\n## State Discovery (post-run)\n\nDiscover thread ID for Phase 6:\n```bash\nTHREAD_ID=$(cd \"$ALPHA_DIR\" && crit review \"$REVIEW_ID\" --format json | jq -r '.threads[0].id')\n```\nAppend THREAD_ID to .eval-env.\n\n## Files to Create\n\n- `evals/scripts/e10-phase5.sh`\n\n## Acceptance Criteria\n\n- [ ] Prompt explicitly tells reviewer to read full source files, not just diff\n- [ ] Uses Opus model\n- [ ] Review ID and workspace path injected into prompt\n- [ ] Thread ID extracted and saved to .eval-env\n- [ ] Artifacts saved","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-06T20:47:25.000850691Z","created_by":"botbox-dev","updated_at":"2026-02-06T21:07:53.995413892Z","closed_at":"2026-02-06T21:07:53.995379768Z","close_reason":"Phase 5 script written: evals/scripts/e10-phase5.sh","source_repo":".","compaction_level":0,"original_size":0,"labels":["e10"],"dependencies":[{"issue_id":"bd-1thv","depends_on_id":"bd-32b7","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":45,"issue_id":"bd-1thv","author":"botbox-dev","text":"Review note: Script should cd to $ALPHA_DIR before invoking claude (reviewer needs to be in alpha project root for crit commands).","created_at":"2026-02-06T20:55:09Z"}]}
{"id":"bd-1u3","title":"Update reviewer-loop.mjs to continue on claim failure","description":"## Context\nbotbus is being updated so that staking an already-held claim will fail (instead of extending TTL). This prevents double-firing hooks.\n\n## Changes needed\nIn reviewer-loop.mjs, when refreshing/staking claims:\n- If refresh fails, try to stake\n- If stake fails because claim is already held, **continue** (don't exit/fail)\n- Another agent is orchestrating, that's fine\n\nThe script currently has a refresh -> stake fallback pattern. Update to handle stake failures gracefully.","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-04T21:53:34.724195195Z","created_by":"botbox-dev","updated_at":"2026-02-04T21:59:51.111833999Z","closed_at":"2026-02-04T21:59:51.111809974Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-1u8p","title":"respond.mjs: smart triage for bare messages","description":"Implement the handleTriage() handler for messages with no ! prefix. This is the intelligent routing layer that decides if a message is chat or work.\n\n## Context\n\nWhen someone posts a bare message to a project channel (no !dev, !bead, !q prefix), respond.mjs needs to decide what to do with it. This is the \"smart front door\" — most messages will hit this path.\n\n## What to build\n\n`handleTriage(route, channel, triggerMessage, transcript)`:\n\n1. **Fast classification** via haiku:\n   - Pass the message body to a haiku call with a classification prompt\n   - Categories: \"chat\" (conversational, greeting, status update, thank you), \"question\" (asking about the project), \"work\" (bug report, feature request, task, something that needs action)\n   - Keep the classification prompt minimal for speed\n\n2. **Route based on classification:**\n   - **chat** → Quick conversational response via haiku (one-shot, no follow-up loop). Example: \"hey how is the refactor going?\" → \"Going well! The auth module is done, working on the API layer now.\"\n   - **question** → Hand off to handleQuestion() with model=sonnet (default). Enters conversation mode with transcript.\n   - **work** → Hand off to handleDev() to create bead + spawn dev-loop. The message becomes the bead description.\n\n3. **Edge case: ambiguous messages**\n   - When haiku cannot confidently classify, default to \"question\" mode (conversational, low cost, can escalate later)\n   - The question handler already supports mid-conversation escalation to dev-loop\n\n### Classification prompt design\n\nKeep it tight — this is a latency-sensitive call:\n```\nClassify this message as one of: chat, question, work\n\n- chat: greetings, thanks, status updates, casual conversation\n- question: asking about the project, how something works, debugging help\n- work: bug reports, feature requests, tasks, \"please fix/add/change X\"\n\nMessage: \"<body>\"\n\nReply with just the category name.\n```\n\n## Acceptance criteria\n\n- [ ] Bare messages (no prefix) get classified by haiku\n- [ ] \"chat\" messages get a quick one-shot response\n- [ ] \"question\" messages hand off to handleQuestion() with sonnet\n- [ ] \"work\" messages hand off to handleDev() to create bead + spawn dev-loop\n- [ ] Classification is fast (haiku, minimal prompt)\n- [ ] Ambiguous messages default to question mode\n- [ ] Chat responses do NOT enter conversation mode (one-shot reply, exit)\n\n## Files to modify\n\n- `packages/cli/scripts/respond.mjs` — implement handleTriage()","status":"closed","priority":2,"issue_type":"feature","owner":"bob","created_at":"2026-02-07T18:45:48.304824156Z","created_by":"bob","updated_at":"2026-02-07T19:57:58.441319002Z","closed_at":"2026-02-07T19:57:58.441291581Z","close_reason":"Implemented: handleTriage() with haiku classification, chat/question/work routing, conversation follow-up loop.","source_repo":".","compaction_level":0,"original_size":0,"labels":["respond"],"dependencies":[{"issue_id":"bd-1u8p","depends_on_id":"bd-2wq0","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-1u8p","depends_on_id":"bd-c128","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-1u8p","depends_on_id":"bd-ock3","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-1v3","title":"Add testing guidelines to CLAUDE.md for botbus isolation","description":"Document that manual testing with botbus should use BOTBUS_DATA_DIR to avoid polluting actual data.\n\nIssue: When testing botbox init or hook registration, running commands creates hooks and data in the real botbus data directory (~/.local/share/botbus), mixing test artifacts with actual project data.\n\nSolution: Use BOTBUS_DATA_DIR environment variable for all manual testing:\n  BOTBUS_DATA_DIR=/tmp/test-botbus botbox init ...\n\nChanges:\n- Add testing section to CLAUDE.md\n- Document BOTBUS_DATA_DIR usage\n- Note to clean up test hooks/data after testing\n- Mention this applies to bus, crit, maw manual testing too\n\nTesting note: The automated bun tests already use isolated environments, this is specifically for manual testing during development.","status":"closed","priority":3,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-03T00:59:03.823057631Z","created_by":"botbox-dev","updated_at":"2026-02-03T00:59:29.441319690Z","closed_at":"2026-02-03T00:59:29.441291907Z","close_reason":"Completed: Added testing guidelines to CLAUDE.md","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":46,"issue_id":"bd-1v3","author":"botbox-dev","text":"Added Testing section to CLAUDE.md\n\nDocuments BOTBUS_DATA_DIR usage for isolated manual testing:\n- Use BOTBUS_DATA_DIR=/tmp/test-botbus for all manual tests\n- Prevents polluting actual botbus data with test artifacts\n- Clean up /tmp/test-botbus after testing\n- Applies to bus, botty, crit, maw, br commands\n\nAutomated bun tests already use isolation - this is for manual testing during development.","created_at":"2026-02-03T00:59:25Z"}]}
{"id":"bd-1vm","title":"Add --seed-work flag to botbox init for initial bead creation","description":"Add a flag/option to botbox init that seeds initial beads by: (1) registering the project on botbus (botbus send projects ... following the convention of existing project registrations), (2) scouting the repo for spec files, README, source structure, and (3) creating beads for initial work items found. Reference: terseid project has bd-3am (review spec.md and create beads) and bd-6z5 (register project on botbus) as examples of what this should automate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-30T17:03:00.203110324Z","created_by":"bob","updated_at":"2026-02-02T17:00:24.064934818Z","closed_at":"2026-02-02T17:00:24.064907927Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":47,"issue_id":"bd-1vm","author":"botbox-dev","text":"Completed: Added --seed-work flag to botbox init. Scans for spec files (spec.md, SPEC.md, specification.md, design.md), README.md, and src/ directory. Creates targeted beads for each finding, or a generic 'Scout project' fallback bead if nothing found. Uses br create with --actor/--owner flags. Gracefully skips if br not installed or beads not in tools. 3 new tests added (spec detection, fallback bead, skip-without-beads). All 57 tests pass, no new lint errors. Note: botbus registration (part 1 of original description) was already implemented in bd-29l.","created_at":"2026-02-02T17:00:20Z"}]}
{"id":"bd-1vn","title":"Add light-touch planning docs","description":"Add workflow docs for the pre-botbox planning phase:\n- planning.md or spec-to-beads.md: How to break a spec/PRD into actionable beads\n- scout.md: How to explore a new codebase before creating beads\n- Brief mention in worker-loop.md that planning happens before the loop\n\nKeep it light - botbox is about execution, not heavy planning frameworks. Just guidance on creating good beads from specs.","status":"closed","priority":3,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-05T16:31:03.100021383Z","created_by":"botbox-dev","updated_at":"2026-02-05T16:33:55.360094325Z","closed_at":"2026-02-05T16:33:55.360047928Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-1vo","title":"Add scripts migration to sync command","description":"sync should detect scripts in old location (scripts/) and migrate them to new location (.agents/botbox/scripts/). Should move the directory and preserve version marker.","status":"closed","priority":1,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-03T01:14:33.135771927Z","created_by":"botbox-dev","updated_at":"2026-02-03T01:16:20.060127088Z","closed_at":"2026-02-03T01:16:20.060104505Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":48,"issue_id":"bd-1vo","author":"botbox-dev","text":"Added scripts migration to sync.mjs:\n- Detects scripts in old location (scripts/)\n- Migrates to new location (.agents/botbox/scripts/) using renameSync\n- Only migrates if old location exists and new location doesn't\n- Added test to verify migration works\nAll 105 tests pass.","created_at":"2026-02-03T01:16:16Z"}]}
{"id":"bd-1w7","title":"Question system: lightweight model-specific Q&A via bus","description":"I want to be able to ask questions without firing off the dev-loop.\nI want different models to respond based on some trigger in the question. examples:\n- \"q: what's state of bd-xyz?\" -- triggers sonnet\n- \"qq: how far is it to the moon?\" -- trigger haiku\n- \"big q: what's the biggest security flaw in the project?\" -- triggers opus\n\npossible explicit alternative:\n- \"q(haiku) what's ...?\"","status":"closed","priority":4,"issue_type":"feature","created_at":"2026-02-04T14:06:18.199176902Z","created_by":"bob","updated_at":"2026-02-04T21:29:31.536368160Z","closed_at":"2026-02-04T21:29:31.536330169Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"labels":["bus","conventions"],"comments":[{"id":49,"issue_id":"bd-1w7","author":"botbox-dev","text":"Support both syntaxes - shortcuts for mobile, explicit for precision:\n\nShortcut syntax (easy to type on phone):\n- q: → sonnet (default/normal)\n- qq: → haiku (quick/cheap)\n- big q: → opus (deep analysis)\n\nExplicit syntax (when you need specific model):\n- q(haiku): \n- q(sonnet):\n- q(opus):\n\nImplementation options:\n1. Bus hook with pattern matching on message prefix\n2. Dedicated 'bus ask' command that handles both syntaxes\n3. Lightweight question-responder agent\n\nLikely approach: bus hook that spawns one-shot responder with appropriate model. No workspace, no bead, just answer. Hook pattern matches q:/qq:/big q: or q(model): prefixes.","created_at":"2026-02-04T18:07:51Z"},{"id":50,"issue_id":"bd-1w7","author":"botbox-dev","text":"Design refinement - conversational model:\n\nMentions are conversations, not one-shots. After answering:\n- Agent calls 'bus wait --timeout 5m' (or similar)\n- If follow-up comes, continues conversation\n- If timeout, gracefully exits\n\nThis applies to q: questions too - they're mentions that expect dialogue potential.\n\nContrast with bare channel posts:\n- Work requests: \"Fix the auth bug\" → triggers dev-loop, creates bead\n- Announcements: \"Released v1.2\" → no agent response needed\n\nPattern:\n- @mention or q: prefix → conversational agent, waits for follow-up\n- Bare post to project channel → work dispatch, bead-driven","created_at":"2026-02-04T18:19:26Z"},{"id":51,"issue_id":"bd-1w7","author":"botbox-dev","text":"Starting implementation. Plan:\n\n1. respond.mjs - new script for conversational responses\n   - Reads BOTBUS_CHANNEL, BOTBUS_MESSAGE_ID from env\n   - Fetches triggering message via bus\n   - Parses q:/qq:/big q:/q(model): prefixes → model selection\n   - Responds, calls bus wait for follow-up\n   - Loop until timeout\n\n2. botbox init - auto-create respond hook for @<project>-dev mentions\n3. botbox sync - update/recreate hooks as needed\n\nRequires @mention to trigger (e.g., @maw-dev q: how does X work?)","created_at":"2026-02-04T19:47:53Z"},{"id":52,"issue_id":"bd-1w7","author":"botbox-dev","text":"Progress: Core implementation complete.\n\nFiles created/modified:\n- packages/cli/scripts/respond.mjs (new) - conversational responder\n- packages/cli/src/commands/init.mjs - register respond hook for @<project>-dev\n- packages/cli/src/lib/scripts.mjs - add respond.mjs to registry\n- packages/cli/src/lib/scripts.test.mjs - update tests\n\nFeatures:\n- Question prefixes: q: (sonnet), qq: (haiku), big q: (opus), q(model): (explicit)\n- Uses bus wait for follow-up conversation after initial response\n- Loops until timeout (5min default) or max conversations (5)\n- Hook triggers on @<project>-dev mentions (separate from dev-loop claim hook)\n\nRemaining:\n- sync command could ensure hooks exist (nice-to-have)\n- Manual testing needed\n- bd-3og (cross-project mentions) naturally handled by same script","created_at":"2026-02-04T19:52:04Z"},{"id":53,"issue_id":"bd-1w7","author":"botbox-dev","text":"Added migration 1.0.5 for sync support.\n\nExisting projects now get the respond hook automatically when running botbox sync.\n\nFull implementation:\n- respond.mjs script\n- init.mjs registers hook for new projects\n- Migration 1.0.5 registers hook for existing projects via sync\n- scripts.mjs registry updated\n\nReady for testing.","created_at":"2026-02-04T19:57:21Z"},{"id":54,"issue_id":"bd-1w7","author":"botbox-dev","text":"Completed migration 1.0.6 to fix env var passing. All botty spawn hooks now include --pass-env BOTBUS_CHANNEL,BOTBUS_MESSAGE_ID,BOTBUS_AGENT,BOTBUS_HOOK_ID. The respond hook relies on these for message context. Also fixed glob expansion bug in migration (channel '*' was expanding to filenames).","created_at":"2026-02-04T21:03:35Z"},{"id":55,"issue_id":"bd-1w7","author":"botbox-dev","text":"Completed respond hook implementation:\n\n- respond.mjs: question prefixes (q:/qq:/big q:/q(model):), conversation continuation via bus wait, claim-based duplicate prevention\n- init.mjs: registers respond hook for @<project>-dev mentions\n- Migration 1.0.5: adds respond hook for existing projects\n- Migration 1.0.6: adds --pass-env to all botty spawn hooks\n\nFiled bugs in botbus:\n- bd-2ec6: --mention can't be used with --claim/--ttl\n- bd-1f0w: --format json doesn't work for wait command\n\nTested end-to-end: hook fires, agent responds to channel, conversation continues with follow-ups.","created_at":"2026-02-04T21:29:28Z"}]}
{"id":"bd-1wd3","title":"Dev loop merges workspace before review cycle completes","description":"Reviewer spawns via @mention hook but finds no reviews in crit inbox. Root cause: dev agent merges workspace (maw ws merge --destroy) BEFORE reviewer has a chance to read the review. The workspace .crit/ data is destroyed with the workspace.\n\nTimeline:\n1. Dev creates review in workspace → crit writes ReviewCreated to workspace .crit/\n2. Dev sends @reviewer mention → reviewer hook fires\n3. Dev loop continues and merges workspace (--destroy) before reviewer spawns\n4. Reviewer spawns → crit inbox --all-workspaces → empty (workspace is gone)\n\nThis is a workflow timing bug in dev-loop.mjs. The worker-loop.md says 'STOP this iteration' after requesting review — the dev should NOT merge until the review cycle completes. But dev-loop.mjs may not enforce this wait.\n\nTwo fixes needed:\n1. (botbox) dev-loop.mjs must not merge/destroy workspace until review is complete (LGTM or self-reviewed)\n2. (crit) bd-1bs auto-search helps if workspace still exists, but doesn't help if already destroyed\n\nObserved in: botcrit channel — botcrit-security spawned 3 times, found no reviews each time (cr-33e1 and cr-1dlj both in destroyed workspaces).","status":"closed","priority":2,"issue_type":"bug","owner":"botbox-dev","created_at":"2026-02-07T17:16:56.707339497Z","created_by":"botbox-dev","updated_at":"2026-02-07T18:24:07.857128712Z","closed_at":"2026-02-07T18:24:07.857099026Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"labels":["dev-loop"],"comments":[{"id":56,"issue_id":"bd-1wd3","author":"botbox-dev","text":"Fixed with two changes:\n\n1. Prompt fix (dev-loop.mjs + agent-loop.mjs): Changed 'If review not found: Check if workspace still exists and create new review if needed' to 'DO NOT merge or create a new review. The reviewer may still be starting up. STOP and wait.'\n\n2. Script fix (dev-loop.mjs + agent-loop.mjs): Added hasPendingReview() guard in main loop. If an in_progress bead has a 'Review created:' comment but no 'Completed by' comment, skip the Claude invocation and wait 30s instead. This prevents the agent from even having the opportunity to merge prematurely.\n\nAll 145 tests pass.","created_at":"2026-02-07T18:24:07Z"}]}
{"id":"bd-1ws","title":"E2E: fresh repo non-interactive init","description":"Test 1 from testing.md — create tmp repo, run botbox init with all CLI flags, verify outputs, doctor, sync --check","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-29T18:39:18.815660619Z","created_by":"bob","updated_at":"2026-01-29T18:42:48.488116080Z","closed_at":"2026-01-29T18:42:48.488085552Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-1x3x","title":"respond.mjs: transcript buffer for conversation context","description":"Add a transcript buffer that accumulates conversation history across bus wait iterations, so each Claude call gets full prior context.\n\n## Context\n\nCurrently respond.mjs spawns a fresh `botbox run-agent` process for each conversation turn. There is zero memory between turns — each call gets only the current message in its prompt. This means multi-turn conversations lose all context.\n\nThe transcript buffer is used by question mode (\\!q) and is also critical for the conversation-to-work handoff (when a conversation reveals something that needs dev-loop attention, the full context needs to be captured).\n\n## What to build\n\nA `Transcript` class or simple array-based buffer:\n\n```js\nlet transcript = []  // Array of { role: \"user\"|\"assistant\", agent: string, body: string, timestamp: string }\n\nfunction addToTranscript(role, agent, body) { ... }\nfunction formatTranscriptForPrompt() { ... }  // Returns formatted string for inclusion in Claude prompt\n```\n\nIntegrate with the conversation loop:\n1. Before first Claude call: add the trigger message to transcript\n2. After Claude responds (capture response from bus send): add assistant response to transcript\n3. On each follow-up from bus wait: add to transcript\n4. Pass `formatTranscriptForPrompt()` into `buildPrompt()` so Claude sees the full history\n\n### Capturing assistant responses\n\nThis is the tricky part. Currently `runClaude()` captures stdout but does not extract the actual bus message the agent sent. Options:\n- Parse the Claude output for the bus send command/content (fragile)\n- After runClaude() returns, fetch the latest message from the channel sent by our agent via `bus history --from AGENT -n 1 --format json`\n- Have the prompt instruct Claude to output the response text in a parseable format (e.g. `<response>text</response>`)\n\nRecommend: fetch from bus history after each Claude call. It is the source of truth for what was actually posted.\n\n## Acceptance criteria\n\n- [ ] Transcript array accumulates entries across conversation turns\n- [ ] Each entry has: role (user/assistant), agent name, body text, timestamp\n- [ ] `formatTranscriptForPrompt()` produces a readable conversation history string\n- [ ] `buildPrompt()` includes transcript context when available\n- [ ] Assistant responses captured from bus history after each Claude call\n- [ ] Transcript is bounded by MAX_CONVERSATIONS (no unbounded growth)\n- [ ] Transcript is passed to handoff functions (handleDev, handleBead) when escalating mid-conversation\n\n## Files to modify\n\n- `packages/cli/scripts/respond.mjs` — add transcript logic, update buildPrompt(), update conversation loop","status":"closed","priority":2,"issue_type":"feature","owner":"bob","created_at":"2026-02-07T18:44:38.502781316Z","created_by":"bob","updated_at":"2026-02-07T19:57:58.176858902Z","closed_at":"2026-02-07T19:57:58.176826461Z","close_reason":"Implemented: transcript buffer with addToTranscript(), formatTranscriptForPrompt(), captureAgentResponse().","source_repo":".","compaction_level":0,"original_size":0,"labels":["respond"]}
{"id":"bd-1y1","title":"Document label conventions for bead grooming","description":"Triage now includes bead grooming, which tells agents to add labels when appropriate. Need guidance on:\n\n- When to create vs reuse labels\n- Naming conventions (kebab-case? categories?)\n- Common label categories (e.g., type:bug, area:api, effort:small)\n- How to list existing labels (br label list)\n- Whether labels should be project-specific or cross-project\n\nThis was identified during eval-driven doc improvements — agents need to know what labels to use.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-29T23:04:19.555287633Z","created_by":"bob","updated_at":"2026-02-01T23:31:43.740813310Z","closed_at":"2026-02-01T23:31:43.740791019Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":57,"issue_id":"bd-1y1","author":"Bob","text":"Progress: Researched existing label usage (9 labels across categories: epic, eval, docs, cli, review, etc). Added comprehensive Label Conventions section to groom.md covering: when to label, categories, naming conventions, creating new labels, project-specific guidance, filtering, and examples. Location: packages/cli/docs/groom.md lines 44-89.","created_at":"2026-02-01T23:28:48Z"},{"id":58,"issue_id":"bd-1y1","author":"Bob","text":"Completed by crystal-anchor","created_at":"2026-02-01T23:31:41Z"}]}
{"id":"bd-1ysj","title":"E10: Write Phase 7 script (re-review + LGTM)","description":"# Context\n\nPhase 7: alpha-security re-reviews the code from workspace path, verifies /debug is removed, and LGTMs.\n\n# Goals\n\n- Create `evals/scripts/e10-phase7.sh`\n- Script sources .eval-env, uses $REVIEW_ID, $WS_PATH\n- Prompt guides alpha-security through: crit inbox or bus inbox → crit review --since → read workspace files → verify /debug gone → lgtm → announce\n\n# Background\n\nPhase 7 is scored at 10 points. Key: reads from workspace path (not main), verifies /debug removed, LGTMs.\n\n# Implementation Approach\n\n## Prompt Construction\n\nInclude:\n- Agent identity (alpha-security), Opus model\n- Review ID, workspace path\n- Instructions to: check for pending re-review, use crit review --since to see changes, read source files from workspace path to verify /debug is gone, verify registration endpoint still correct, lgtm, announce on bus\n\n## Files to Create\n\n- `evals/scripts/e10-phase7.sh`\n\n## Acceptance Criteria\n\n- [ ] Prompt explicitly tells reviewer to read from workspace path\n- [ ] Uses Opus model\n- [ ] Artifacts saved","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-06T20:47:42.072759526Z","created_by":"botbox-dev","updated_at":"2026-02-06T21:07:55.346486522Z","closed_at":"2026-02-06T21:07:55.346458840Z","close_reason":"Phase 7 script written: evals/scripts/e10-phase7.sh","source_repo":".","compaction_level":0,"original_size":0,"labels":["e10"],"dependencies":[{"issue_id":"bd-1ysj","depends_on_id":"bd-96tu","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":59,"issue_id":"bd-1ysj","author":"botbox-dev","text":"Review note: Script should cd to $ALPHA_DIR before invoking claude.","created_at":"2026-02-06T20:55:09Z"}]}
{"id":"bd-204","title":"Clarify migration idempotency and AGENTS handling","description":"Update notes/migration-system.md to clarify safe file deletion patterns and AGENTS.md managed-section handling in migrations and sync.","status":"closed","priority":3,"issue_type":"task","owner":"1","created_at":"2026-02-03T15:54:10.364961919Z","created_by":"1","updated_at":"2026-02-03T15:54:34.906400233Z","closed_at":"2026-02-03T15:54:34.906372652Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":60,"issue_id":"bd-204","author":"1","text":"Started in workspace botbox (/home/bob/src/botbox). Will update migration plan doc with idempotent deletion guidance and AGENTS.md managed section handling.","created_at":"2026-02-03T15:54:16Z"},{"id":61,"issue_id":"bd-204","author":"1","text":"Updated notes/migration-system.md with idempotent delete guidance and AGENTS.md managed-section handling. Ready to close.","created_at":"2026-02-03T15:54:30Z"}]}
{"id":"bd-20d","title":"Register auto-spawn hook during botbox init","description":"After botbus ships channel hooks (bd-2km in botbus), botbox init should register an auto-spawn hook so the project's dev agent starts automatically when messages arrive.\n\n## What to register\n\n```\nbus hooks add --channel <project> \\\n  --if-claim-available \"agent://<project>-dev\" \\\n  --cwd <abs-repo-path> \\\n  -- bash scripts/dev-loop.sh <project> <project>-dev\n```\n\n## Requirements\n\n- Only register if botbus is in the tools list\n- Only register if bus binary supports hooks (check bus hooks --help or version)\n- Use absolute repo path for --cwd\n- Skip gracefully if bus doesn't support hooks yet (don't fail init)\n- Idempotent: don't add duplicate hooks (check bus hooks list first)\n\n## Blocked by\n\nbotbus channel hooks feature (bd-2km in botbus project). File this bead but mark blocked until that ships.\n\n## Acceptance criteria\n\n- `botbox init` registers a hook for the project channel\n- `bus hooks list` shows the hook with correct channel, claim guard, cwd, and command\n- Running init twice doesn't create duplicate hooks\n- Init works fine if bus doesn't support hooks (graceful skip)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-02T16:03:35.066751488Z","created_by":"bob","updated_at":"2026-02-02T17:54:33.438626034Z","closed_at":"2026-02-02T17:54:33.438602920Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":62,"issue_id":"bd-20d","author":"Bob","text":"Blocked on botbus channel hooks feature (bd-2km in ~/src/botbus). Will unblock when bus hooks add ships.","created_at":"2026-02-02T16:03:52Z"},{"id":63,"issue_id":"bd-20d","author":"botbox-dev","text":"Completed: Added registerSpawnHook() to init.mjs. Registers 'bus hooks add --channel <project> --claim agent://<project>-dev --release-on-exit --cwd <abs-path> -- bash scripts/dev-loop.sh <project> <project>-dev'. Checks for hooks support (graceful skip if missing), deduplicates (checks bus hooks list before adding). 2 new tests: hook registration + idempotency. All 59 tests pass.","created_at":"2026-02-02T17:54:33Z"}]}
{"id":"bd-22c","title":"recommend whether or not to incorporate cass_memory_system","description":"Do a deep dive of ~/repos/cass_memory_system\n\nEvaluate the purpose and how it might fit into the botbox ecosystem.\nYou'll be evaluating whether it should be a standard part of all botbox projects.\nFeel free to actually run it, try it out, evaluate how it would actually be incorporated.\nDetermine if it would bring significant value over the complexity of using it.\n\nWrite up a detailed doc in notes/cass.md with findings. Put a clear recommendation/not line near the top.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-05T14:19:01.587188506Z","created_by":"bob","updated_at":"2026-02-05T14:28:47.193659203Z","closed_at":"2026-02-05T14:21:53.892101817Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"labels":["explore"],"comments":[{"id":64,"issue_id":"bd-22c","author":"botbox-dev","text":"Completed evaluation. Wrote detailed analysis to notes/cass.md with recommendation NOT to integrate into standard botbox setup. Key reasons: (1) solves different problem (individual learning vs team coordination), (2) high overlap with existing CLAUDE.md + basic-memory, (3) additional complexity with cass dependency and LLM costs. Could be documented as optional tool for power users.","created_at":"2026-02-05T14:21:53Z"},{"id":65,"issue_id":"bd-22c","author":"botbox-dev","text":"Updated evaluation after clarification. Revised from 'NOT RECOMMENDED' to 'CONDITIONALLY RECOMMENDED'. Key insight: cm fills genuine gaps - session search (130+ sessions in botbox alone), auto-discovery of rules, and effectiveness tracking. These complement beads (work tracking) with knowledge tracking. Recommended path: document as optional tool now, consider deeper integration after validation.","created_at":"2026-02-05T14:28:47Z"}]}
{"id":"bd-22eh","title":"E10: Write Phase 2 script (beta investigates + responds)","description":"# Context\n\nPhase 2: beta-dev reads alpha-dev's question from inbox, investigates validate_email code, responds with domain expertise, and creates a bug bead to track the fix.\n\n# Goals\n\n- Create `evals/scripts/e10-phase2.sh`\n- Script sources .eval-env, builds prompt for beta-dev (Sonnet model), invokes claude\n- Prompt guides beta-dev through: inbox → read question → investigate src/lib.rs → respond with RFC knowledge → create bug bead → send response to alpha channel\n\n# Background\n\nPhase 2 is scored at 15 points. Key: reads inbox with --mentions, investigates own code, responds with domain expertise (not just \"ok I'll fix it\"), creates bug bead, sends response cross-project.\n\nSee notes/proposals/e10-full-lifecycle-eval.md Phase 2 section.\n\n# Implementation Approach\n\n## Prompt Construction\n\nInclude:\n- Agent identity (beta-dev)\n- Project directory ($BETA_DIR)\n- Context: alpha-dev asked about validate_email rejecting +\n- Instructions to: check inbox, read the question, investigate own code, consider RFC 5321, respond thoughtfully, create tracking bead, send response to alpha channel\n\n## State Discovery (post-run)\n\nDiscover beta bug bead ID:\n```bash\nBUG_BEAD=$(cd \"$BETA_DIR\" && br ready 2>&1 | grep -oP 'bd-\\w+' | head -1)\n```\nAppend BUG_BEAD to .eval-env.\n\n## Files to Create\n\n- `evals/scripts/e10-phase2.sh`\n\n## Acceptance Criteria\n\n- [ ] Uses Sonnet model (not Opus)\n- [ ] Prompt includes beta-dev identity and beta project dir\n- [ ] Bug bead ID extracted and saved to .eval-env\n- [ ] Artifacts saved","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-06T20:46:36.925087369Z","created_by":"botbox-dev","updated_at":"2026-02-06T21:07:51.063748221Z","closed_at":"2026-02-06T21:07:51.063711321Z","close_reason":"Phase 2 script written: evals/scripts/e10-phase2.sh","source_repo":".","compaction_level":0,"original_size":0,"labels":["e10"],"dependencies":[{"issue_id":"bd-22eh","depends_on_id":"bd-10um","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":66,"issue_id":"bd-22eh","author":"botbox-dev","text":"Review note: Script should cd to $BETA_DIR before invoking claude so beta-dev starts in the beta project root.","created_at":"2026-02-06T20:55:08Z"}]}
{"id":"bd-22i","title":"Warn when --init-beads is ignored due to tools list","description":"init --init-beads is silently skipped when beads is not in the tools list. Should warn the user: 'Skipping beads init: beads not in tools list'.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-29T17:33:15.809769092Z","created_by":"bob","updated_at":"2026-01-29T17:37:25.439001077Z","closed_at":"2026-01-29T17:37:25.438977603Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"labels":["review-finding","should-fix"]}
{"id":"bd-23l7","title":"E10-2: Second clean run of Full Lifecycle eval","description":"Run the E10 Full Lifecycle eval and score it. This is the first fully clean run with all script fixes applied.\n\n## Runbook\n\nFull instructions: notes/eval-framework.md → \"Running E10\" section.\nRubric (160 pts, 10 categories): evals/rubrics.md → \"E10: Full Lifecycle\" section.\nReport template: notes/eval-framework.md → \"Writing the Report\" section.\nPrevious run report (for reference): evals/results/2026-02-06-e10-run1-opus.md\n\n## What E10 Tests\n\n2 Rust projects (Alpha API + Beta library), 3 agents (alpha-dev/Opus, alpha-security/Opus, beta-dev/Sonnet), 8 phases. Tests triage, cross-project communication, workspace management, code review with security block/fix/LGTM cycle, finish protocol, and release. 160-point rubric with 5 critical fail conditions.\n\nPlanted defects:\n- Beta: validate_email rejects + in local part (overly strict char whitelist)\n- Alpha: /debug endpoint exposes api_secret in JSON response\n\n## How to Run\n\n1. bash evals/scripts/e10-run.sh\n   - Takes ~30 min, ~$15-25 API cost (mostly Opus)\n   - Eval dir persists in ~/.cache/botbox-evals/e10-XXXXXXXXXX/\n   - Continues past phase failures, prints summary at end\n2. Source the env: source $EVAL_DIR/.eval-env\n3. Run verify: already runs automatically at end of orchestrator\n\n## How to Score\n\nRead each phase's stdout log ($EVAL_DIR/artifacts/phase{N}.stdout.log) and score against the rubric in evals/rubrics.md. The logs show tool calls, results, and intermediate reasoning (botbox run-agent format).\n\nFor each phase, check:\n- Did the agent call the right tools with correct flags?\n- Did the agent produce the right outcome (code changes, messages, reviews)?\n- Were identity flags (--agent, --actor, --author) used on mutating commands?\n\nAlso check:\n- Channel history: BOTBUS_DATA_DIR=$BOTBUS_DATA_DIR bus history alpha -n 30\n- Bead state: cd $ALPHA_DIR && br show $BEAD\n- Review state: cd $ALPHA_DIR && crit reviews list --all-workspaces\n- Claims: BOTBUS_DATA_DIR=$BOTBUS_DATA_DIR bus claims list\n\n## Critical Fail Conditions (override score → FAIL)\n\n1. Alpha merges while review BLOCKED (no LGTM)\n2. No cross-project message from alpha-dev to beta channel in Phase 1\n3. /debug still exposes api_secret after Phase 6\n4. Mutating commands missing --agent/--actor flags\n5. Work claims (bead://, workspace://) unreleased after Phase 8\n\n## What Changed Since E10-1\n\n- crit queries now use --all-workspaces --path (should fix FK constraint error)\n- Fallback grep recovery now LOGS when hit (look for \"FALLBACK:\" in phase output)\n- verify.sh fixes: .[0].status, is_default filter, bead://|workspace:// claims only\n- Eval dir now persists to ~/.cache/botbox-evals/ (survives reboots)\n\n## Problems to Watch For\n\n1. **FALLBACK lines in phase output**: If you see \"FALLBACK: REVIEW_ID=...\" or \"FALLBACK: THREAD_ID=...\", it means --all-workspaces didn't fix the crit FK constraint issue. Record this in the report. Posted to #botcrit for investigation.\n\n2. **Phase 5 REVIEW_ID/THREAD_ID empty**: The orchestrator discovers these after each phase for the next phase's prompt. Check the phase output headers (e.g., \"REVIEW_ID=cr-xxxx\"). If empty, the agent prompt won't have the ID, but agents can still discover it themselves via crit commands.\n\n3. **verify.sh false positives**: The verify script checks observable state but some checks are approximations:\n   - \"Alpha bead closed\" — uses br show --format json .[0].status\n   - \"Workspaces cleaned up\" — filters is_default==false\n   - \"Claims released\" — only counts bead:// and workspace:// (agent:// are hook-managed)\n   - \"Review exists/merged\" — uses crit reviews list --all-workspaces; may still fail if crit FK issue persists\n\n4. **Phase 8 merge conflicts on .beads/**: Known issue. The agent prompt includes a recovery hint (jj restore --from main .beads/ && jj squash).\n\n5. **agent:// claims re-staked by hooks**: When Phase 8 announces completion, the dev-loop hook fires and re-claims agent://alpha-dev. This is expected behavior, not a failure.\n\n6. **Setup hook fires during setup**: The task-request message in setup triggers the dev-loop hook (bus hooks add fires on channel messages). This is harmless — the spawned agent exits quickly because botty isn't running the loop.\n\n## Scoring Thresholds\n\n- Pass: >= 112/160 (70%)\n- Excellent: >= 144/160 (90%)\n- E10-1 scored 158/160 (99%)\n\n## Deliverables\n\n1. Score each phase, write report: evals/results/YYYY-MM-DD-e10-run2-opus.md\n2. Update evals/results/README.md runs table\n3. Update evals/rubrics.md E10 Runs table\n4. Record any FALLBACK hits or new issues in the report's Learnings section\n5. If --all-workspaces fixed the crit FK issue, update the E10-1 report's learnings to note it was a workspace scoping issue, not a crit bug","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-07T01:22:04.495103593Z","created_by":"botbox-dev","updated_at":"2026-02-07T01:45:53.400788263Z","closed_at":"2026-02-07T01:45:53.400748067Z","close_reason":"E10-2 scored 159/160 (99%) EXCELLENT. Report at evals/results/2026-02-07-e10-run2-opus.md. All tables updated.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-23n","title":"Document --dangerously-skip-permissions requirement for agent-loop.sh","description":"claude -p requires --dangerously-skip-permissions for autonomous file operations. This is currently hardcoded in agent-loop.sh but needs documentation. Add to eval-loop.md setup, AGENTS.md agent loop section, and consider making it configurable (CLAUDE_SKIP_PERMISSIONS env var).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-30T14:23:47.728594911Z","created_by":"bob","updated_at":"2026-01-30T16:25:45.904990894Z","closed_at":"2026-01-30T16:25:45.904907669Z","close_reason":"--dangerously-skip-permissions added to agent-loop.sh, documented in script","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-25h","title":"Add timeout wrapper to claude calls in loop scripts","description":"Add timeout command to wrap claude calls in agent-loop.sh, dev-loop.sh, and reviewer-loop.sh to prevent hung API calls from blocking iterations indefinitely.\n\nCurrent issue: When Claude API returns 'No messages returned' or hangs, the process doesn't exit and blocks the entire loop.\n\nSolution: Wrap claude calls with timeout command:\n  timeout ${TIMEOUT} claude --model ...\n\nSuggested timeouts:\n- agent-loop.sh: 600s (10 min) - single task iteration\n- dev-loop.sh: 900s (15 min) - may dispatch workers, needs more time\n- reviewer-loop.sh: 600s (10 min) - single review iteration\n\nAfter timeout, the script should:\n1. Log the timeout event\n2. Optionally notify via bus send\n3. Continue to next iteration (let the outer loop handle retry logic)\n\nTesting: Verify timeout triggers correctly and loop continues.","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-02T22:10:14.577385760Z","created_by":"botbox-dev","updated_at":"2026-02-02T22:11:59.590029939Z","closed_at":"2026-02-02T22:11:59.590006536Z","close_reason":"Completed: Added timeout wrapper to prevent hung Claude API calls","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":67,"issue_id":"bd-25h","author":"botbox-dev","text":"Implemented timeout wrapper for all three loop scripts\n\nChanges:\n- agent-loop.sh: CLAUDE_TIMEOUT=600s (10 min)\n- dev-loop.sh: CLAUDE_TIMEOUT=900s (15 min, needs more time for dispatching workers)\n- reviewer-loop.sh: CLAUDE_TIMEOUT=600s (10 min)\n\nWrapped claude commands with timeout:\n  if ! timeout \"$CLAUDE_TIMEOUT\" claude ...; then\n    exit_code=$?\n    if [[ $exit_code -eq 124 ]]; then\n      echo \"Claude timed out...\"\n      bus send ... -L tool-issue\n    else\n      echo \"Claude exited with code $exit_code\"\n    fi\n  fi\n\nAfter timeout (exit code 124) or error, the script:\n1. Logs the event to stdout (visible in botty tail)\n2. Sends bus notification to project channel with -L tool-issue\n3. Continues to next iteration (outer loop handles retry)\n\nAll tests pass (100/100). Syntax validated.","created_at":"2026-02-02T22:11:55Z"}]}
{"id":"bd-25u","title":"Include bead title in botbus announcements","description":"Agents currently post 'Working on bd-3cx' and 'Completed bd-3cx' on botbus. They should include the full bead title: 'Working on bd-3cx: Setup project structure and data models'. Update worker-loop.md announcement templates in the Start and Finish steps. Check other docs (start.md, finish.md, update.md) for the same pattern.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T22:31:46.928557704Z","created_by":"bob","updated_at":"2026-02-01T22:45:32.598258089Z","closed_at":"2026-02-01T22:45:32.598235106Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"labels":["docs"],"dependencies":[{"issue_id":"bd-25u","depends_on_id":"bd-1c5","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-25u","depends_on_id":"bd-3ni","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":68,"issue_id":"bd-25u","author":"Bob","text":"Updated Working/Completed announcement templates to include bead titles in worker-loop.md, start.md, and finish.md.","created_at":"2026-02-01T22:45:29Z"}]}
{"id":"bd-27i","title":"Evaluate DCG (Destructive Command Guard) for botbox","description":"Evaluate https://github.com/Dicklesworthstone/destructive_command_guard for potential integration with botbox/botty. Check: install process, how it intercepts commands, configurability, performance overhead, whether it fits our safety model.","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-05T16:25:15.461083728Z","created_by":"botbox-dev","updated_at":"2026-02-05T16:27:52.616965255Z","closed_at":"2026-02-05T16:27:52.616933665Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-288","title":"Proposal: Agent health monitoring (stuck detection)","description":"See notes/proposals/agent-health-monitoring.md\n\nCreate the proposal doc with:\n- Status: PROPOSAL header\n- Proposed design for stuck detection\n- Answered questions from existing investigation\n- Remaining open questions\n\nAcceptance criteria: proposal doc exists with proper structure.","status":"closed","priority":4,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-05T16:41:15.840520822Z","created_by":"botbox-dev","updated_at":"2026-02-05T20:54:16.591243336Z","closed_at":"2026-02-05T20:54:16.591200756Z","close_reason":"Proposal doc created at notes/proposals/agent-health-monitoring.md","source_repo":".","compaction_level":0,"original_size":0,"labels":["proposal"]}
{"id":"bd-28m","title":"Add bus whoami check to agent identity instructions","description":"All docs that mention bus/botbus agent identity should recommend calling 'bus whoami' first to check if the agent already has an assigned identity before generating or adopting one. Update worker-loop.md Identity section and any other docs that cover agent naming (start.md, preflight.md, etc.).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T22:31:46.991205333Z","created_by":"bob","updated_at":"2026-02-01T22:44:55.470963426Z","closed_at":"2026-02-01T22:44:55.470942166Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"labels":["docs"],"dependencies":[{"issue_id":"bd-28m","depends_on_id":"bd-318","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-28m","depends_on_id":"bd-qzg","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":69,"issue_id":"bd-28m","author":"Bob","text":"Added bus whoami guidance across identity sections in worker-loop/start/preflight and other identity-resolve steps.","created_at":"2026-02-01T22:44:52Z"}]}
{"id":"bd-29c","title":"Build the real botbox CLI (init, sync, doctor)","description":"The CLI scaffold is built with commander, inquirer, bun. Commands are stubbed with real logic. Needs end-to-end validation: run botbox init in a temp project, verify files created, run botbox sync, run botbox doctor. Fix any issues found.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-29T17:22:46.699530307Z","created_by":"bob","updated_at":"2026-01-29T19:36:56.263044270Z","closed_at":"2026-01-29T19:36:56.263018902Z","close_reason":"CLI is complete. init/sync/doctor all implemented with 50 passing tests and 8 e2e tests. Dog-fooded during development.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-29l","title":"Register project on #projects channel during botbox init","description":"botbox init should register the project on the botbus #projects channel so other agents can discover it via report-issue.md.\n\n## What to send\n\n```\nbus send --agent <project>-dev projects \\\n  \"project:<name> repo:<abs-path> lead:<name>-dev tools:<tool-list>\" \\\n  -L project-registry\n```\n\nThe project name, repo path, and tools list are all available during init. The lead agent follows the convention `<project>-dev`.\n\n## Requirements\n\n- After botbox init completes, send a #projects registry message\n- Only send if botbus is in the tools list (don't send if the project doesn't use botbus)\n- Use absolute repo path (resolve relative paths)\n- Idempotent: running init twice shouldn't create duplicate registry entries (check if one exists first, or accept duplicates as harmless)\n- Skip gracefully if bus command isn't available (don't fail init)\n\n## Acceptance criteria\n\n- `botbox init --name myapp --type api --tools beads,botbus` sends a registry message\n- `bus history projects` shows the entry with correct format\n- `botbox init --name myapp --type api --tools beads` (no botbus) does NOT send\n- Init succeeds even if bus binary is missing","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-02T16:03:24.495407451Z","created_by":"bob","updated_at":"2026-02-02T16:06:36.043175277Z","closed_at":"2026-02-02T16:06:36.043149218Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":70,"issue_id":"bd-29l","author":"Bob","text":"Starting implementation","created_at":"2026-02-02T16:03:57Z"},{"id":71,"issue_id":"bd-29l","author":"Bob","text":"Done: added bus send to #projects after beads init in init.mjs. Sends registry entry with project name, abs path, lead agent, tools list. Skips gracefully if bus not installed. Tests added and passing.","created_at":"2026-02-02T16:06:36Z"}]}
{"id":"bd-2b1","title":"Update companion projects with new botbox run-agent scripts","description":"Update botbus, maw, botcrit, botty, and beads-tui projects to use the new botbox infrastructure:\n\n1. Run 'botbox sync' to get latest workflow docs\n2. Copy new loop scripts (agent-loop.mjs, dev-loop.mjs, reviewer-loop.mjs) from packages/cli/scripts/\n3. Test that loop scripts work with 'botbox run-agent claude' command\n4. Update any project-specific customizations if needed\n\nProjects to update:\n- ~/src/botbus (already has botbox structure)\n- ~/src/maw (already has botbox structure)\n- ~/src/botcrit (already has botbox structure)\n- ~/src/botty (already has botbox structure)\n- ~/src/beads-tui (already has botbox structure)\n\nThis ensures all projects benefit from the centralized pretty output and ~350 lines less duplicate code.","status":"closed","priority":3,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-03T14:46:49.072225264Z","created_by":"botbox-dev","updated_at":"2026-02-04T17:04:19.658253383Z","closed_at":"2026-02-04T17:04:19.658222205Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"labels":["maintenance","sync"],"comments":[{"id":72,"issue_id":"bd-2b1","author":"botbox-dev","text":"Starting sync of companion projects. Will run botbox sync in each.","created_at":"2026-02-04T17:03:57Z"}]}
{"id":"bd-2bv","title":"Add triage guidance for checking blocked bead status","description":"During grooming/triage, agents should check blocked beads to see if their blockers have been resolved (e.g., missing requirements were added, upstream tool fixed). If resolved, unblock and consider for work. Update triage.md and worker-loop.md with this guidance.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-30T14:23:47.315139001Z","created_by":"bob","updated_at":"2026-01-30T16:25:45.962545945Z","closed_at":"2026-01-30T16:25:45.962518293Z","close_reason":"Added blocked bead re-evaluation step to triage.md (step 4) and worker-loop.md","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-2bz","title":"Add botbus whoami guidance to agent-loop.sh and worker-loop.md","description":"Agent-loop.sh should run 'botbus whoami --agent $AGENT' at start to confirm identity. botbus v0.3.7+ generates a random name if BOTBUS_AGENT isn't set. Worker-loop.md preflight section should also recommend this. Currently agents get BOTBUS_AGENT from the script but whoami confirms it and handles the fallback case.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-30T16:21:49.331883347Z","created_by":"bob","updated_at":"2026-01-30T16:25:45.934682903Z","closed_at":"2026-01-30T16:25:45.934645933Z","close_reason":"Added botbus whoami --agent to agent-loop.sh and preflight.md, naming convention in worker-loop.md and preflight.md","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-2dt","title":"Draft mesh protocol spec","description":"Write initial mesh protocol draft with message schema, claims/leases, spawn lifecycle, and review loop.","status":"closed","priority":2,"issue_type":"docs","created_at":"2026-01-26T23:29:03.072497216Z","created_by":"bob","updated_at":"2026-01-26T23:29:52.038608285Z","closed_at":"2026-01-26T23:29:52.038538374Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-2dw","title":"Fix extra blank line in AGENTS.md when no reviewers","description":"renderAgentsMd produces a double blank line before the comment when reviewers is empty, due to template string interpolation of empty reviewerSection. Normalize the whitespace.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-29T17:33:16.437183159Z","created_by":"bob","updated_at":"2026-01-29T17:37:25.449996035Z","closed_at":"2026-01-29T17:37:25.449977390Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"labels":["review-finding","should-fix"],"dependencies":[{"issue_id":"bd-2dw","depends_on_id":"bd-3fm","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-2dx","title":"R7: Planning eval — epic decomposition and sequencing","description":"Opus dev agent receives a large feature request, breaks it into beads with dependency graph, sequences work across iterations. Tests: (1) agent analyzes a complex feature (e.g., 'add user auth with OAuth + JWT + role-based access'), (2) creates an epic with subtasks, (3) sets dependencies between subtasks, (4) executes in correct order, (5) handles a subtask that reveals a design issue requiring replanning. Scoring: decomposition quality, dependency correctness, replanning ability.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T23:42:24.740165294Z","created_by":"bob","updated_at":"2026-02-01T22:28:02.490589203Z","closed_at":"2026-02-01T22:28:02.490522698Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["eval"],"dependencies":[{"issue_id":"bd-2dx","depends_on_id":"bd-ppt","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":73,"issue_id":"bd-2dx","author":"Bob","text":"R8 informs R7 design: The bd-138 breakdown (5 subtasks with dependency ordering) is itself a testable planning behavior. R7 should score: (1) does agent create resumable subtasks (not just a flat list), (2) are dependencies wired correctly (sibling ordering, not just parent-child), (3) does each subtask have clear acceptance criteria. The 'one bead = one resumable unit' principle from groom.md is the standard.","created_at":"2026-02-01T19:43:50Z"},{"id":74,"issue_id":"bd-2dx","author":"Bob","text":"R7-1 complete: Opus 76/95 (80%) PASS. Strong diamond DAG (7 subtasks, 3 parallel). Completed 3/7 subtasks before context limit, all code compiles, 8 tests pass. Key finding: worker-loop.md lacked decomposition guidance — agent created good structure but skipped parent grooming, flat priorities, and implicit SQLite decision. Updated worker-loop.md triage step with detailed decomposition protocol. Eval is done — remaining gaps (multi-agent handoff) belong to the full autonomous workflow, not R7.","created_at":"2026-02-01T22:27:58Z"}]}
{"id":"bd-2dyi","title":"Migrate botbox to maw v2 architecture","description":"## Summary\n\nmaw v2 introduces breaking changes that affect how botbox scripts, docs, templates, and evals interact with workspaces. The core change: no more default workspace at project root — all workspaces live in `./ws/`, and `maw exec <ws> -- command` becomes the uniform way to run commands (br, bv, crit, jj) inside a workspace context. `maw ws jj` is removed.\n\n## Prerequisites\n\n- maw v2 must be released and installed\n- Run `maw upgrade` in botbox repo first to migrate our own workspace setup\n- Verify `maw exec` works with br, bv, crit, jj before starting script changes\n\n## Migration Checklist\n\n### 1. Scripts (highest priority)\n\nAll loop scripts in `packages/cli/scripts/` need updating:\n\n**agent-loop.mjs**\n- Replace `maw ws jj <ws> describe -m \"...\"` → `maw exec <ws> -- jj describe -m \"...\"`\n- Any br/bv commands that currently run from project root expecting workspace context → `maw exec <ws> -- br ...`\n- Workspace path construction: `.workspaces/$WS/` → `./ws/$WS/` (or use path returned by `maw ws create`)\n- Verify crash recovery logic still works with new paths\n\n**dev-loop.mjs**\n- Same maw ws jj → maw exec changes\n- Worker dispatch: workspace creation, path passing to spawned workers\n- Workspace merge: verify `maw ws merge <ws> --destroy` still works or has new syntax\n- Any path construction for monitoring worker progress\n\n**reviewer-loop.mjs**\n- Currently reads code from workspace absolute paths — verify these still work under `./ws/`\n- crit commands that reference workspace paths: `crit reviews create --path $WS_PATH` → may need `maw exec`\n- File reading for review diffs\n\n**respond.mjs**\n- Spawns dev-loop with workspace context — verify env passing still works\n- Any workspace path references in escalation logic\n\n**iteration-start.mjs / triage.mjs**\n- Check for any workspace path references (likely minimal impact)\n\n### 2. Documentation & Templates\n\n**src/lib/templates.mjs** (AGENTS.md managed section):\n- Workspace Quick Reference table: update commands\n- Replace all `maw ws jj <name> <args>` → `maw exec <name> -- jj <args>`\n- Update workspace path references: `.workspaces/$WS/` → `./ws/$WS/`\n- Update \"Safe vs Dangerous\" jj operations table\n- Add `maw exec` as the primary command pattern\n\n**packages/cli/docs/** (workflow docs copied to target projects):\n- worker-loop.md — full lifecycle references\n- start.md — workspace creation, path usage\n- finish.md — merge, destroy commands\n- review-request.md — crit commands with workspace paths\n- review-response.md — reading reviewer code from workspace\n- merge-check.md — pre-merge verification\n- All other docs that reference workspace paths or maw commands\n\n**CLAUDE.md** (project instructions):\n- Workspace Quick Reference section\n- Debugging and Troubleshooting section\n- \"How the Whole System Works\" section\n- Companion Tools Deep Dive > maw section\n\n### 3. Hooks & Migrations\n\n- Add a new botbox migration (e.g., 1.0.11) that:\n  - Updates .botbox.json if needed for v2 compatibility\n  - Any hook command updates if workspace paths changed\n  - Possibly runs `maw upgrade` as part of migration\n- Review Claude Code hooks for workspace path references\n\n### 4. Source Library Code\n\n- `src/lib/` — check for any hardcoded `.workspaces/` path construction\n- `src/commands/` — init.mjs, sync.mjs, status.mjs, doctor.mjs for workspace references\n\n### 5. Evals\n\n- E10v2 (bd-3n4l) and E11 (bd-ydxa) are deferred pending this migration\n- All eval scripts in `evals/scripts/` that create/use workspaces need updating\n- Eval rubrics referencing workspace commands or paths\n- After migration, undefer and update both eval beads\n\n### 6. Tests\n\n- Run `bun test` after all changes — version hashes will need updating\n- Manual test with isolated BOTBUS_DATA_DIR as always\n- Verify end-to-end: botbox init → sync → agent spawns → workspace ops all work with v2\n\n## Key Pattern Change\n\nOld (3 separate rules):\n```\nbr ready                              # from project root\nmaw ws jj myws describe -m \"feat: x\" # special maw ws jj syntax\ncd /abs/path/.workspaces/myws/        # absolute paths for file ops\n```\n\nNew (1 uniform rule):\n```\nmaw exec myws -- br ready\nmaw exec myws -- jj describe -m \"feat: x\"\nmaw exec myws -- crit reviews create --title \"...\"\n# file ops still use absolute path from maw ws create output\n```\n\n## Acceptance Criteria\n\n- [ ] All scripts updated and working with maw v2\n- [ ] All docs and templates reference new commands/paths\n- [ ] Migration added for target project upgrades\n- [ ] Tests passing\n- [ ] Manual end-to-end test successful\n- [ ] E10v2 and E11 eval beads undeferred and updated","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-07T23:22:48.812527028Z","created_by":"botbox-dev","updated_at":"2026-02-08T20:43:11.405763598Z","closed_at":"2026-02-08T20:43:11.405723923Z","close_reason":"All migration work complete: 6 scripts, 14 workflow docs, templates, prompts, sync v2 detection, migration 1.0.12, CLAUDE.md, bare-root stubs. All companion projects upgraded and synced.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-2dyk","title":"Exclude deferred beads from dev loop work queue","description":"br ready may return deferred/backlog beads. The dev loop should not pick these up. Need to check what br ready returns and filter or use a flag to exclude deferred status.","status":"closed","priority":2,"issue_type":"bug","owner":"botbox-dev","created_at":"2026-02-07T17:16:48.469786923Z","created_by":"botbox-dev","updated_at":"2026-02-07T17:21:20.792715297Z","closed_at":"2026-02-07T17:21:20.792690200Z","close_reason":"Not a bug: br ready already excludes deferred beads (help: 'List ready issues (unblocked, not deferred)'). No code change needed.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-2e7","title":"Draft migration system plan","description":"Write a comprehensive migration-system plan doc in notes/migration-system.md based on bd-3lp requirements and research.","status":"closed","priority":3,"issue_type":"task","owner":"1","created_at":"2026-02-03T15:43:11.249246383Z","created_by":"1","updated_at":"2026-02-03T15:46:30.308303782Z","closed_at":"2026-02-03T15:46:30.308268306Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2e7","depends_on_id":"bd-3nz","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":75,"issue_id":"bd-2e7","author":"1","text":"Started in workspace botbox (/home/bob/src/botbox). Drafting migration system plan doc for botbox sync based on bd-3lp requirements and migration patterns.","created_at":"2026-02-03T15:45:20Z"},{"id":76,"issue_id":"bd-2e7","author":"1","text":"Drafted migration system plan in notes/migration-system.md with design, registry format, execution flow, safety, and testing plan. Ready for review.","created_at":"2026-02-03T15:46:25Z"}]}
{"id":"bd-2f9","title":"Fix has_work() wasted iteration from self-messages","description":"After agent sends 'Completed bd-xxx' on the project channel, has_work() sees unread messages and spawns a claude session that finds no work. Upstream fix requested in #botbus (self-messages shouldn't count as unread). Fallback: only check br ready in has_work(), drop inbox check. Or mark own messages as read after sending.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-30T14:23:47.198651008Z","created_by":"bob","updated_at":"2026-01-30T16:05:43.138958537Z","closed_at":"2026-01-30T16:05:43.138930836Z","close_reason":"Fixed upstream in botbus v0.3.8 — inbox now filters own messages","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-2fg9","title":"!dev triggers bead creation","description":"it should just trigger the dev loop. only create a bead if it also has \"!bead\"","status":"open","priority":3,"issue_type":"bug","created_at":"2026-02-09T18:26:48.171648840Z","created_by":"bob","updated_at":"2026-02-09T18:26:48.253854882Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["bus"]}
{"id":"bd-2fo","title":"Write and run agent-loop.sh eval","description":"Create an eval doc for testing agent-loop.sh end-to-end. The eval should:\n\n1. Set up a fresh botbox project with 2-3 beads of varying quality\n2. Run agent-loop.sh (or simulate its behavior) with Sonnet\n3. Verify the shell loop works: one bead per iteration, has_work() gate, clean exit\n4. Score each iteration using the Level 2 rubric\n5. Verify shell-level concerns: cleanup trap, agent lease, shutdown message\n\nKey difference from Level 2 evals: the shell script controls iteration, not the agent.\nThe agent should complete exactly one task per invocation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T23:55:21.777899728Z","created_by":"bob","updated_at":"2026-01-30T16:21:54.451536600Z","closed_at":"2026-01-30T16:21:54.451513827Z","close_reason":"Eval written (eval-loop.md) and executed (2 runs: run 1 found has_work() bugs + sandbox issue, run 2 scored 211/218 97%)","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":77,"issue_id":"bd-2fo","author":"Bob","text":"Context for next session:\n- eval-loop.md has the full eval plan (218 pts total)\n- agent-loop.sh is updated with all eval learnings (random workspaces, grooming, exit-after-finish)\n- maw v0.8.0 fixed the merge issue (bd-l3w closed)\n- maw output now includes 'IMPORTANT: All files must be under this path'\n- Use Option B (simulate per-iteration) to avoid running the full shell script\n- Seed 2 beads: 1 well-specified, 1 poorly specified\n- Key test: does the agent complete exactly 1 bead then stop?","created_at":"2026-01-30T00:02:53Z"}]}
{"id":"bd-2fq","title":"Add review-loop.md guidance for workspace code visibility during re-review","description":"The review-loop.md doc should include explicit guidance for reviewers during re-review: read code from the workspace path, not from the project root. The project root has the pre-fix code until merge.\n\nAdd a note like:\n  IMPORTANT: During re-review, the author's fixes are in their workspace, not the main branch.\n  Check the botbus review-response message for the workspace path, or use maw ws list to find it.\n  Read source files from .workspaces/<ws-name>/ to see the current code.\n\nDiscovered in R4-1: reviewer read main branch src/main.rs (unfixed) instead of workspace copy (fixed), resulting in a false 'NOT FIXED' re-block.\n\nAcceptance criteria:\n- review-loop.md includes workspace visibility guidance for re-review step\n- Guidance is clear enough that a reviewer agent follows it without explicit prompt help\n\nTesting: bun test (doc hash changes)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T19:59:49.313763836Z","created_by":"bob","updated_at":"2026-01-31T20:14:11.607477654Z","closed_at":"2026-01-31T20:14:11.607453118Z","close_reason":"Added Re-review section to review-loop.md with workspace visibility guidance","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-2g4","title":"Add language selection to botbox init with .gitignore generation","description":"Add a language/framework selection step to botbox init (e.g., rust, python, node, go). Use a CLI tool (like gitignore.io or similar) to generate an appropriate .gitignore for the selected language. Should be optional — skip if .gitignore already exists. Add --language flag for non-interactive use.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-30T16:53:44.402288614Z","created_by":"bob","updated_at":"2026-02-01T23:44:04.048605557Z","closed_at":"2026-02-01T23:44:04.048581792Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":78,"issue_id":"bd-2g4","author":"Bob","text":"Implementation complete: Added language selection to botbox init with .gitignore generation using gitignore.io. Tested non-interactive mode and existing .gitignore skip logic.","created_at":"2026-02-01T23:38:17Z"},{"id":79,"issue_id":"bd-2g4","author":"Bob","text":"Review requested: cr-rgy9, workspace: silent-tower (/home/bob/src/botbox/.workspaces/silent-tower)","created_at":"2026-02-01T23:38:48Z"},{"id":80,"issue_id":"bd-2g4","author":"Bob","text":"Waiting for review feedback on cr-rgy9. Created follow-up bead bd-1jk to address documentation errors identified in review cr-xvwo.","created_at":"2026-02-01T23:40:41Z"},{"id":81,"issue_id":"bd-2g4","author":"Bob","text":"Completed by crystal-anchor","created_at":"2026-02-01T23:44:01Z"}]}
{"id":"bd-2gl","title":"Replace process.exit() in commands with thrown errors","description":"Commands call process.exit() directly, which kills testability and prevents composition. Refactor: commands throw errors or return exit codes, entry point (index.mjs) catches and calls process.exit(). This also fixes doctor calling process.exit(0) on success and unblocks testing sync --check and sync with missing .agents/.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-29T17:33:14.716639412Z","created_by":"bob","updated_at":"2026-01-29T17:36:31.803459446Z","closed_at":"2026-01-29T17:36:31.803435641Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"labels":["review-finding","should-fix"]}
{"id":"bd-2gn","title":"Add mention-based hooks for specialist reviewers","description":"Configure botbus hooks to spawn specialist reviewers when @mentioned.\n\nUse case: When a dev agent or user needs a security review, they can @mention the reviewer (e.g., '@security-reviewer please review this for auth vulnerabilities'), which triggers a hook to spawn that reviewer.\n\nDepends on: botbus shipping mention-based hook triggers\n\nChanges needed:\n1. init.mjs: Register mention hooks for each reviewer role during botbox init\n   - For 'security' reviewer: hook fires on @security-reviewer mentions\n   - For 'correctness' reviewer: hook fires on @correctness-reviewer mentions\n2. Hook command: spawn reviewer with context from the mention\n   - botty spawn --name security-reviewer --cwd $PWD -- bash scripts/spawn-security-reviewer.sh\n3. Reviewer script: Read the mention message to understand what needs review\n   - Check if message references a crit review ID\n   - Or check recent reviews in the channel\n4. Update .botbox.json to store reviewer hook config (optional)\n\nExample hook:\n  bus hooks add --agent <project>-dev \\\n    --channel <project> \\\n    --mention-pattern '@security-reviewer' \\\n    --claim 'agent://security-reviewer' \\\n    --claim-owner security-reviewer \\\n    -- botty spawn --name security-reviewer --cwd $PWD \\\n    -- bash scripts/spawn-security-reviewer.sh\n\nBenefits:\n- On-demand reviewer spawning (only when needed)\n- Natural workflow (just @mention the reviewer)\n- No manual spawning or polling needed","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-02T23:53:18.496925489Z","created_by":"botbox-dev","updated_at":"2026-02-03T00:53:25.629174932Z","closed_at":"2026-02-03T00:53:25.629146909Z","close_reason":"Completed: Mention-based reviewer hooks registered","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":82,"issue_id":"bd-2gn","author":"botbox-dev","text":"Implementation complete\n\nChanges:\n- init.mjs: Updated registerSpawnHook() to accept reviewers parameter\n- init.mjs: Register mention-based hooks for each reviewer role\n  - security → @security-reviewer mentions spawn spawn-security-reviewer.sh\n  - correctness → @correctness-reviewer mentions spawn reviewer-loop.sh\n\nHook registration:\n  bus hooks add --agent ${project}-dev --channel ${project} \\\n    --mention \"@${reviewer}\" \\\n    --claim-owner ${reviewer} \\\n    --cwd ${absPath} --ttl 600 \\\n    -- botty spawn --name ${reviewer} --cwd ${absPath} \\\n    -- bash .agents/botbox/scripts/${script}\n\nHooks fire on mention (condition.type: mention_received) and spawn the appropriate reviewer.\n\nTesting:\n- All 100 tests pass\n- Manual test: Hooks registered for security-reviewer and correctness-reviewer\n- Verified hooks show correct condition.type and condition.agent\n\nUsage: Dev agent or user can @mention reviewers:\n  bus send test \"@security-reviewer please review bd-123 for auth vulnerabilities\"\n  → Hook fires → security-reviewer spawns → reviews code","created_at":"2026-02-03T00:53:20Z"}]}
{"id":"bd-2h4","title":"Add cass tip to AGENTS.md managed section","description":"Add the cass search tip to the generated managed section in AGENTS.md (via templates.mjs), not just the workflow docs. Something like:\n\n### Session Search (optional)\nUse `cass search \"error or problem\"` to find how similar issues were solved in past sessions.","status":"closed","priority":3,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-05T16:41:05.830856286Z","created_by":"botbox-dev","updated_at":"2026-02-05T17:24:00.752697407Z","closed_at":"2026-02-05T17:24:00.752667Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-2h9","title":"Add prominent Botbox Release Process section to AGENTS.md","description":"## Problem\n\nBotbox has specific release requirements that agents might miss:\n- Changes to docs/scripts/prompts need version bumps\n- Version bumps need tags\n- Migration system must handle breaking changes\n- Release includes `just install` to use locally\n\nThis guidance is split between root AGENTS.md and packages/cli/AGENTS.md. Agents may not discover it.\n\n## Solution\n\n1. Add prominent \"Botbox Release Process\" section to root AGENTS.md (near top, after \"CRITICAL: Track ALL Work\"):\n\n```markdown\n## Botbox Release Process\n\nChanges to workflow docs, scripts, prompts, or templates require:\n\n1. Make the change in `packages/cli/`\n2. If behavior changes, add a migration in `src/migrations/index.mjs`\n3. Run `bun test` - version hashes auto-update\n4. Commit, push to main\n5. Tag: `jj tag set vX.Y.Z -r main && git push origin vX.Y.Z`\n6. Install locally: `just install`\n\nSee [packages/cli/AGENTS.md](packages/cli/AGENTS.md) for component details.\n```\n\n2. Add `installCommand: \"just install\"` to .botbox.json so managed section shows install reminder\n\n3. Ensure packages/cli/AGENTS.md is referenced clearly","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-04T14:22:28.722694733Z","created_by":"botbox-dev","updated_at":"2026-02-04T15:31:00.402680810Z","closed_at":"2026-02-04T15:31:00.402653229Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-2ijm","title":"E10: Add rubric to evals/rubrics.md","description":"# Context\n\nThe E10 scoring rubric needs to be added to the existing evals/rubrics.md file alongside the existing eval rubrics (R1-R9, Agent Loop, L2).\n\n# Goals\n\n- Add E10 rubric section to evals/rubrics.md\n- Include all phase scoring criteria, critical fail conditions, and pass/excellent thresholds\n- Follow the format of existing rubric entries\n\n# Background\n\nThe E10 rubric is defined in the proposal (notes/proposals/e10-full-lifecycle-eval.md, \"Scoring Rubric\" section). Total: 160 points across 10 scoring categories. Pass >= 112 (70%), Excellent >= 144 (90%).\n\n# Implementation Approach\n\n## Content\n\nAdd an \"E10: Full Lifecycle\" section to evals/rubrics.md containing:\n- Phase-by-phase scoring tables (Phases 1-8 + Phase 4.5 + Communication)\n- Point totals (30+15+15+20+5+20+15+10+15+15 = 160)\n- Critical fail conditions (5 conditions that override score)\n- Pass/Excellent thresholds\n\n## Files to Modify\n\n- `evals/rubrics.md` — Add E10 section\n\n## Acceptance Criteria\n\n- [ ] E10 rubric added to evals/rubrics.md\n- [ ] All scoring criteria from proposal included\n- [ ] Critical fail conditions listed\n- [ ] Pass/Excellent thresholds documented\n- [ ] Format matches existing rubric entries","status":"closed","priority":3,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-06T20:48:16.499200323Z","created_by":"botbox-dev","updated_at":"2026-02-06T21:07:57.524128202Z","closed_at":"2026-02-06T21:07:57.524103385Z","close_reason":"Rubric added to evals/rubrics.md","source_repo":".","compaction_level":0,"original_size":0,"labels":["e10"]}
{"id":"bd-2jd","title":"wrapper script to simplify `bv --robot-triage`","description":"That is a handy tool, but it dumps way too much json, hyper-precise floats, etc. It's a token-waster. We should have either a script that gets copied to .agents/botbox/scripts/ or is part of the botbox cli tool (prefer the first) that wraps the tool and trims it down.","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-02-03T20:54:12.021729668Z","created_by":"bob","updated_at":"2026-02-04T17:03:34.097326741Z","closed_at":"2026-02-04T17:03:34.097283259Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","scripts"],"comments":[{"id":83,"issue_id":"bd-2jd","author":"botbox-dev","text":"Started in workspace bd-2jd (/home/bob/src/botbox/.workspaces/bd-2jd). Creating triage.mjs script.","created_at":"2026-02-04T17:01:55Z"}]}
{"id":"bd-2jws","title":"Proposal: Multi-project coordination patterns","description":"See notes/proposals/multi-project-coordination.md\n\nCurrent model: per-project agents with clear boundaries. This works well.\nExplore if/when multi-project coordination is needed:\n- Shared libraries used by multiple projects\n- Upstream/downstream dependencies\n- Cross-repo refactoring\n\nProposal conclusion: Current model is sufficient. Gaps can be addressed through documentation rather than new infrastructure.","status":"closed","priority":4,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-05T16:41:22.387895200Z","created_by":"botbox-dev","updated_at":"2026-02-05T20:54:17.741542988Z","closed_at":"2026-02-05T20:54:17.741513322Z","close_reason":"Proposal doc created at notes/proposals/multi-project-coordination.md","source_repo":".","compaction_level":0,"original_size":0,"labels":["proposal"],"comments":[{"id":84,"issue_id":"bd-2jws","author":"botbox-dev","text":"Created proposal doc at notes/proposals/multi-project-coordination.md. Key conclusion: current per-project model is sufficient. The R5 eval demonstrates cross-project coordination already works via report-issue.md and #projects registry. Recommendations are documentation updates, not new infrastructure.","created_at":"2026-02-05T20:52:00Z"}]}
{"id":"bd-2l9i","title":"E10: Write Phase 8 script (merge + finish + release)","description":"# Context\n\nPhase 8: alpha-dev completes the full finish protocol — mark review merged, merge workspace, close bead, release claims, sync, version bump, tag, announce.\n\n# Goals\n\n- Create `evals/scripts/e10-phase8.sh`\n- Script sources .eval-env, uses $REVIEW_ID, $WS, $BEAD\n- Prompt guides alpha-dev through the complete finish protocol from finish.md\n\n# Background\n\nPhase 8 is scored at 15 points. Key: marks review merged, merges workspace --destroy, closes bead, releases all claims, syncs beads, version bump + tag, completion announcement.\n\nThis phase tests the full finish.md protocol compliance.\n\n# Implementation Approach\n\n## Prompt Construction\n\nInclude:\n- Agent identity (alpha-dev), Opus model\n- Review ID, workspace name, bead ID\n- Full finish protocol instructions: crit reviews mark-merged → maw ws merge --destroy → br close → bus claims release --all → br sync --flush-only → version bump → jj tag → announce\n- Reference to finish.md workflow\n\n## Files to Create\n\n- `evals/scripts/e10-phase8.sh`\n\n## Acceptance Criteria\n\n- [ ] Prompt includes complete finish protocol\n- [ ] Uses Opus model\n- [ ] Artifacts saved","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-06T20:47:51.738709618Z","created_by":"botbox-dev","updated_at":"2026-02-06T21:07:56.128876873Z","closed_at":"2026-02-06T21:07:56.128844833Z","close_reason":"Phase 8 script written: evals/scripts/e10-phase8.sh","source_repo":".","compaction_level":0,"original_size":0,"labels":["e10"],"dependencies":[{"issue_id":"bd-2l9i","depends_on_id":"bd-1ysj","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":85,"issue_id":"bd-2l9i","author":"botbox-dev","text":"Review note: Script should cd to $ALPHA_DIR before invoking claude.","created_at":"2026-02-06T20:55:09Z"},{"id":86,"issue_id":"bd-2l9i","author":"botbox-dev","text":"Review note: Script should cd to $ALPHA_DIR before invoking claude.","created_at":"2026-02-06T20:55:13Z"}]}
{"id":"bd-2mr","title":"Update botbox ecosystem projects to use botbox","description":"Run botbox init on all botbox ecosystem projects (beads, maw, crit, botbus, botty). This will:\n- Add .agents/botbox/ directories with workflow docs\n- Generate AGENTS.md with managed sections (clean up auto-generated content from individual tools)\n- Create .botbox.json config files\n- Add loop scripts where applicable\n- Register hooks for auto-spawning\n\nProjects to update:\n- beads (~/src/beads)\n- maw (~/src/maw)\n- crit (~/src/crit)\n- botbus (~/src/botbus)\n- botty (~/src/botty)\n- terseid (~/src/terseid) - already has scripts moved, but needs full botbox init","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-03T01:47:54.555592771Z","created_by":"botbox-dev","updated_at":"2026-02-03T02:10:56.649346568Z","closed_at":"2026-02-03T02:02:40.336327454Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":87,"issue_id":"bd-2mr","author":"botbox-dev","text":"Successfully initialized botbox on all ecosystem projects:\n\n✓ crit (botcrit repo)\n  - Created .agents/botbox/ with workflow docs\n  - Generated AGENTS.md and .botbox.json\n  - Copied loop scripts\n  - Registered hooks: crit-dev (channel), @crit-security (mention)\n\n✓ maw\n  - Created .agents/botbox/ with workflow docs\n  - Generated AGENTS.md and .botbox.json\n  - Copied loop scripts\n  - Registered hooks: maw-dev (channel), @maw-security (mention)\n\n✓ botbus\n  - Created .agents/botbox/ with workflow docs\n  - Generated AGENTS.md and .botbox.json\n  - Copied loop scripts\n  - Registered hooks: botbus-dev (channel), @botbus-security (mention)\n\n✓ botty\n  - Created .agents/botbox/ with workflow docs\n  - Generated AGENTS.md and .botbox.json\n  - Copied loop scripts\n  - Registered hooks: botty-dev (channel), @botty-security (mention)\n\nAll projects are now using the botbox workflow system with:\n- Standardized workflow docs in .agents/botbox/\n- Auto-spawn hooks for dev agents\n- Mention-based security reviewer hooks\n- Full tool stack enabled (beads, maw, crit, botbus, botty)","created_at":"2026-02-03T02:02:37Z"},{"id":88,"issue_id":"bd-2mr","author":"botbox-dev","text":"Updated: Restored custom project-specific content for all ecosystem projects.\n\nAfter initial botbox init, extracted custom content from previous AGENTS.md versions and inserted above the botbox managed section:\n- crit: 599 lines (bv/ast-grep guidance, crit workflow, release process)\n- maw: 304 lines (workspace management, jj concepts, architecture)\n- botbus: 442 lines (agent communication, CLI output guidelines, dev workflow)\n- botty: 234 lines (daily dev workflow, feature development loop)\n\nAll projects now have:\n✓ .agents/botbox/ workflow docs (standardized)\n✓ .botbox.json config\n✓ Loop scripts in .agents/botbox/scripts/\n✓ Auto-spawn hooks registered\n✓ Custom project-specific content preserved (above managed section)\n✓ Botbox managed section (workflow docs, stack reference)","created_at":"2026-02-03T02:10:56Z"}]}
{"id":"bd-2ms","title":"Add cass to botbox doctor as optional check","description":"Add cass (coding agent session search) availability check to botbox doctor command. Should be optional/informational - not a failure if missing. Check if 'cass --version' works, report as available or not.","status":"closed","priority":3,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-05T16:25:17.571340561Z","created_by":"botbox-dev","updated_at":"2026-02-05T16:25:54.926055861Z","closed_at":"2026-02-05T16:25:54.926025224Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-2n7","title":"copy beads grooming guidelines from triage.md to groom.md","description":"This is because I occasionally ask agents just to groom beads.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-31T20:56:25.781130366Z","created_by":"bob","updated_at":"2026-01-31T20:57:00.357261766Z","closed_at":"2026-01-31T20:57:00.315988068Z","close_reason":"Created groom.md with beads grooming guidelines extracted from triage.md. Includes: title/description/priority/labels/acceptance criteria/testing strategy validation. Handles bead breakdown and announces grooming completions.","source_repo":".","compaction_level":0,"original_size":0,"labels":["skill"],"comments":[{"id":89,"issue_id":"bd-2n7","author":"Bob","text":"Closed: groom.md created","created_at":"2026-01-31T20:57:00Z"}]}
{"id":"bd-2no","title":"Add pushMain config option to auto-push to GitHub","description":"Add a 'pushMain' boolean config option to .botbox.json that determines if work should automatically push to GitHub main branch.\n\nImplementation:\n1. Add 'pushMain' field to config schema in init.mjs (default: false)\n2. Update finish.md workflow doc to include conditional push step:\n   - If pushMain is true: 'jj bookmark set main -r @ && jj git push'\n   - Document the config option\n3. Update loop script prompts (agent-loop.sh, dev-loop.sh) to include push instructions in FINISH step when config.pushMain is true\n4. Add test to verify config field is generated\n\nThis allows projects to opt-in to automatic GitHub pushing at the end of each completed task.\n\nExample .botbox.json:\n{\n  \"version\": \"1.0.0\",\n  \"project\": { \"name\": \"my-project\", \"type\": [\"api\"] },\n  \"pushMain\": true,\n  ...\n}","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-03T01:54:33.061078060Z","created_by":"botbox-dev","updated_at":"2026-02-03T01:57:01.174545191Z","closed_at":"2026-02-03T01:57:01.174521988Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":90,"issue_id":"bd-2no","author":"botbox-dev","text":"Implemented pushMain config option:\n- Added 'pushMain: false' field to .botbox.json in init.mjs\n- Updated finish.md with conditional push step (step 8)\n- Added PUSH_MAIN variable to agent-loop.sh and dev-loop.sh\n- Both loop scripts read pushMain from config and conditionally include push instructions\n- Added test to verify pushMain field is generated\nAll 106 tests pass.","created_at":"2026-02-03T01:56:57Z"}]}
{"id":"bd-2od","title":"Rename botbus to bus in all docs","description":"The main binary for botbus has been renamed to bus. Update all workflow docs, CLAUDE.md, and any other references. Search for 'botbus' across the repo and replace with 'bus' where it refers to the CLI command. Keep 'botbus' where it refers to the project/system name (e.g., 'the botbus channel').","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T22:31:46.961251737Z","created_by":"bob","updated_at":"2026-02-01T22:45:45.715673500Z","closed_at":"2026-02-01T22:45:45.715656258Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"labels":["docs"],"dependencies":[{"issue_id":"bd-2od","depends_on_id":"bd-35u","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-2od","depends_on_id":"bd-ztw","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":91,"issue_id":"bd-2od","author":"Bob","text":"Replaced botbus CLI references with bus across workflow docs and core project docs (README, eval-review/loop, dev-agent-architecture, AGENTS). Kept botbus for system/channel mentions.","created_at":"2026-02-01T22:45:42Z"}]}
{"id":"bd-2onb","title":"Add cross-channel communication and tracking beads for async agent collaboration","description":"## Summary\n\nAgents should be able to communicate across project channels (ask questions, file bugs, give feedback) and track those conversations asynchronously via local tracking beads.\n\n## Problem\n\nWhen an agent encounters a confusing tool error (e.g., crit returns 'orphaned events'), it silently retries or gives up. It has no mechanism to:\n1. Ask the responsible project's channel for help\n2. Remember that it asked\n3. Check back for a response later\n\n## Solution\n\n### 1. Tracking beads\nWhen an agent files a bug, asks a question, or posts feedback to another project's channel, it creates a local tracking bead:\n```\nbr create --actor $AGENT --owner $AGENT \\\n  --title=\"[tracking] <summary of what was posted>\" \\\n  --labels tracking,cross-project \\\n  --description=\"Posted to #<channel>. Message: <summary>. Check bus history <channel> for response.\" \\\n  --type=task --priority=3\n```\n\n### 2. Triage handling for tracking beads\nLoop scripts (dev-loop.mjs, agent-loop.mjs) need a triage step that handles tracking-labeled beads differently:\n- Don't treat them as regular work items\n- Check `bus history <channel> --since <bead-created-at> --format json` for responses\n- If response found: add comment with the response, close the tracking bead\n- If no response and it's been a while: optionally bump/re-post\n\n### 3. Workflow docs\n- Update `report-issue.md` to cover questions and confusion, not just bugs. Rename or expand to `cross-channel.md`.\n- Add tracking bead creation as a mandatory step after any cross-channel post\n- Add examples: filing a bug, asking a question, giving feedback\n- Update `worker-loop.md` and `triage.md` to mention checking tracking beads\n\n### 4. Prompt/instruction updates\nAdd to CLAUDE.md or workflow docs:\n- 'If you are confused by a tool error, post a question to that tool's project channel'\n- 'Always create a local tracking bead after cross-channel communication'\n- List known project channels: botbus=#botbus, botcrit=#botcrit, maw=#maw, botty=#botty\n\n## Acceptance criteria\n- [ ] Workflow doc for cross-channel communication (expand report-issue.md or create cross-channel.md)\n- [ ] Tracking bead convention documented with examples\n- [ ] Triage logic in dev-loop.mjs and agent-loop.mjs handles tracking beads (check for responses, close when resolved)\n- [ ] CLAUDE.md updated to encourage cross-channel communication\n- [ ] Integration test: simulate filing a cross-channel message, creating tracking bead, receiving response, closing tracker","status":"closed","priority":2,"issue_type":"feature","owner":"botbox-dev","created_at":"2026-02-07T20:50:14.430299331Z","created_by":"botbox-dev","updated_at":"2026-02-07T20:53:42.180359062Z","closed_at":"2026-02-07T20:53:42.180328094Z","close_reason":"Completed: cross-channel.md, triage tracking beads, updated worker-loop/templates/proposal","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-2ot8","title":"Dev loop sends duplicate sign-off messages","description":"The dev loop sometimes posts two sign-off messages (e.g. agent-idle twice). The alreadySignedOff guard may not be working across rapid spawn cycles, or the cleanup path and the no-work exit both send sign-off.","status":"closed","priority":3,"issue_type":"bug","owner":"botbox-dev","created_at":"2026-02-07T17:16:51.307681929Z","created_by":"botbox-dev","updated_at":"2026-02-07T18:25:24.178773637Z","closed_at":"2026-02-07T18:25:24.178742709Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"labels":["dev-loop"],"comments":[{"id":92,"issue_id":"bd-2ot8","author":"botbox-dev","text":"Fixed: set alreadySignedOff=true on COMPLETE signal in dev-loop.mjs, agent-loop.mjs, and reviewer-loop.mjs. The agent sends its own sign-off via bus send inside the Claude session when outputting COMPLETE, but the loop script didn't know this and sent a second one from cleanup(). All 145 tests pass.","created_at":"2026-02-07T18:25:23Z"}]}
{"id":"bd-2pnv","title":"Migration: replace dev+respond hooks with single router hook","description":"Add migration 1.0.11 that replaces the separate dev-loop and respond hooks with a single channel router hook per project.\n\n## Context\n\nCurrently each project has 2-3 hooks:\n1. **Dev hook** (claim-based): fires on any channel message when `agent://X-dev` claim is available → spawns dev-loop.mjs\n2. **Respond hook** (mention-based): fires on @X-dev mentions → spawns respond.mjs\n3. **Reviewer hooks** (mention-based): fires on @X-security etc → spawns reviewer-loop.mjs\n\nWith the unified router, hooks 1+2 are replaced by a single hook:\n- Channel match (project channel)\n- Claim: `agent://X-dev` (only fires when no agent active)\n- Command: spawns respond.mjs (which now routes everything)\n\nReviewer hooks remain unchanged.\n\n## What to build\n\n### Migration 1.0.11 in `src/migrations/index.mjs`\n\n1. List all hooks via `bus hooks list --format json`\n2. Find hooks for this project (matching `h.cwd === ctx.projectDir`) that are:\n   - The dev hook: claim-based, command includes `dev-loop.mjs`\n   - The respond hook: mention-based, command includes `respond.mjs`\n3. Remove both hooks via `bus hooks remove <id>`\n4. Add single replacement hook:\n   ```\n   bus hooks add --agent X-dev --channel <project> --claim \"agent://X-dev\" --claim-owner X-dev --cwd <dir> --ttl 600 -- botty spawn --env-inherit BOTBUS_CHANNEL,BOTBUS_MESSAGE_ID,BOTBUS_AGENT,BOTBUS_HOOK_ID --name X-dev --cwd <dir> -- bun .agents/botbox/scripts/respond.mjs <project> X-dev\n   ```\n5. Leave reviewer hooks untouched\n\n### Update init.mjs `registerSpawnHook()`\n\nReplace the two-hook registration (dev hook + respond hook) with the single router hook. Keep reviewer hook registration as-is.\n\nThe new hook:\n- `--channel <name>` — matches all messages on project channel\n- `--claim \"agent://X-dev\"` — only fires when claim available (prevents duplicate spawns)\n- `--claim-owner X-dev`\n- `--ttl 600`\n- Command: `botty spawn ... -- bun .agents/botbox/scripts/respond.mjs <project> <agent>`\n\n### What about @mentions?\n\nWith the old setup, @X-dev triggered the respond hook. With the new single hook, @mentions are just regular channel messages — they hit the router like everything else. The router handles them via triage (or explicit ! prefix).\n\nFor @X-dev mentions that do NOT contain a ! prefix: the triage handler classifies them. Since the mention is explicit, this will likely route to \"question\" mode.\n\nNo special mention-matching needed on the hook itself.\n\n## Acceptance criteria\n\n- [ ] Migration removes both dev and respond hooks for the project\n- [ ] Migration adds single router hook with correct channel + claim + command\n- [ ] Reviewer hooks are NOT modified\n- [ ] init.mjs registers single router hook instead of dev+respond pair\n- [ ] Hook uses --env-inherit to pass BOTBUS_* vars\n- [ ] Existing projects: `botbox sync` runs migration and switches hooks\n- [ ] New projects: `botbox init` creates the correct single hook\n\n## Files to modify\n\n- `packages/cli/src/migrations/index.mjs` — add migration 1.0.11\n- `packages/cli/src/commands/init.mjs` — update registerSpawnHook()","status":"closed","priority":2,"issue_type":"feature","owner":"bob","created_at":"2026-02-07T18:46:10.532313450Z","created_by":"bob","updated_at":"2026-02-07T19:59:26.786421863Z","closed_at":"2026-02-07T19:59:26.786388440Z","close_reason":"Implemented: migration 1.0.11 replaces dev+respond hooks with single router hook. init.mjs updated to register single router hook. All 175 tests pass.","source_repo":".","compaction_level":0,"original_size":0,"labels":["hooks","respond"],"dependencies":[{"issue_id":"bd-2pnv","depends_on_id":"bd-1u8p","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-2r0","title":"R4-2: Re-run integration eval with crit v0.9.1","description":"Re-run R4 integration eval to verify crit v0.9.1 fixes the vote index bug (bd-1s1). Phase 4 should now succeed without manual index rebuild or prompt workaround for workspace path.\n\nSteps:\n1. Update crit to v0.9.1+ in the eval environment\n2. Run scratchpad/r4-setup.sh\n3. Run all 5 phases\n4. Score and compare to R4-1 (89/95)\n5. Write eval report, update eval-review.md + README\n\nKey question: Does Phase 4 re-review work without the workspace path hint in the prompt? Test both with and without the hint to see if the crit diff fix (bd-2do, if shipped) makes the workspace path unnecessary.\n\nExpected: 95/95 if vote bug is fixed. If workspace visibility still needs the prompt hint, 93-95/95.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-31T22:11:09.523437866Z","created_by":"bob","updated_at":"2026-01-31T22:39:15.482455124Z","closed_at":"2026-01-31T22:39:15.482422463Z","close_reason":"R4-2 complete: 95/95 (100%). crit v0.9.1 vote override fix confirmed.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-2r9","title":"botbox run-agent should detect errors and post on botbus","description":"I just hit API Error: 500 in claude. We need to detect hard errors like those (and rate limit exceeded), post to botbus and exit the dev loop.\nThis is so people watching botbus, expecting agents to be running know why they're not.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-03T15:45:15.243703556Z","created_by":"bob","updated_at":"2026-02-04T15:40:46.523754002Z","closed_at":"2026-02-04T15:40:46.523724346Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"labels":["ux"]}
{"id":"bd-2rb","title":"R6: Parallel dispatch eval","description":"Dev agent receives 3+ independent beads, spawns Haiku workers in parallel, tracks completions, handles failures (worker gets stuck or produces bad code). Tests: (1) dev agent triages multiple beads, (2) creates workspaces and dispatches workers via claude -p, (3) monitors progress via botbus, (4) handles a stuck worker (timeout → reassign), (5) reviews and merges completed work. Scoring: dispatch correctness, failure handling, merge sequencing.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T23:42:18.648617336Z","created_by":"bob","updated_at":"2026-02-02T02:13:41.051923780Z","closed_at":"2026-02-02T02:13:41.051897440Z","close_reason":"R6-1: Opus 69/70 (99%). Parallel dispatch validated.","source_repo":".","compaction_level":0,"original_size":0,"labels":["eval"],"comments":[{"id":93,"issue_id":"bd-2rb","author":"Bob","text":"R6-1 complete: Opus 69/70 (99%). Perfect parallel dispatch — 3 Haiku workers launched in 2s, all completed in 85s wall-clock. Dev agent pre-wrote code in worker prompts. All beads closed, workspaces destroyed, cargo check passes. Only deduction: jj merge conflict markers (cosmetic). See eval-results/2026-02-02-r6-run1.md.","created_at":"2026-02-02T02:13:25Z"}]}
{"id":"bd-2rr","title":"Remove emojis from triage.mjs, use unicode/nerdfonts + ANSI colors","description":"Scripts should use unicode symbols or nerdfonts glyphs with ANSI colors instead of emojis. Update triage.mjs to follow this convention.","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-04T17:38:02.299415631Z","created_by":"botbox-dev","updated_at":"2026-02-04T17:39:01.259444263Z","closed_at":"2026-02-04T17:39:01.259417412Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-2s1","title":"R5: Multi-project coordination eval","description":"Dev agents from different projects file cross-project issues (report-issue.md), review each other's APIs, and coordinate via botbus #projects registry. Tests: (1) dev agent discovers a dependency issue in another project, (2) files an issue via report-issue.md, (3) other project's agent picks it up, (4) fix flows back. Scoring: issue filed correctly, cross-project botbus routing, fix integrated.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T23:42:12.611527372Z","created_by":"bob","updated_at":"2026-02-02T14:13:09.725740708Z","closed_at":"2026-02-02T14:13:09.725709680Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"labels":["eval"],"comments":[{"id":94,"issue_id":"bd-2s1","author":"Bob","text":"R5-1 complete: Opus 70/70 (100%). Perfect cross-project coordination — agent queried #projects registry, found r5-utils, filed detailed bug report (bd-31f) for validate_name() off-by-one, announced with -L feedback and @r5-utils-dev. Implemented correct validation in r5-app. Used BOTBUS_DATA_DIR isolation to avoid polluting real registry.","created_at":"2026-02-02T14:12:49Z"}]}
{"id":"bd-2sn","title":"Update loop script prompts to include reviewer spawning pattern","description":"## Problem\n\nThe prompts in dev-loop.mjs and agent-loop.mjs tell agents to request reviews but don't clearly explain how to spawn specialist reviewers via @mention.\n\nObserved: maw-dev tried generic `--reviewer security` then asked bob for help before figuring out the @mention pattern.\n\n## Fix\n\nUpdate the embedded prompts in:\n- `packages/cli/scripts/dev-loop.mjs` (buildPrompt function)\n- `packages/cli/scripts/agent-loop.mjs` (buildPrompt function)\n\nAdd explicit instructions like:\n```\nTo request security review:\n1. crit reviews request <review-id> --reviewers ${PROJECT}-security --agent $AGENT\n2. bus send --agent $AGENT ${PROJECT} \"Review requested: <review-id> @${PROJECT}-security\" -L review-request\n   (The @mention triggers the reviewer hook - this is required to spawn the reviewer)\n```\n\n## Note\nThese scripts are self-contained and copied to target projects, so the fix will propagate on next `botbox sync`.","status":"closed","priority":1,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-04T00:18:08.762263879Z","created_by":"botbox-dev","updated_at":"2026-02-04T00:28:20.491693978Z","closed_at":"2026-02-04T00:28:20.491664192Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-2tg","title":"Draft botbox website","description":"Create a minimal brutalist botbox landing page for agents, covering tools and workflow.","status":"closed","priority":2,"issue_type":"docs","created_at":"2026-01-27T14:14:39.448840834Z","created_by":"bob","updated_at":"2026-01-27T14:15:23.058956182Z","closed_at":"2026-01-27T14:15:23.058873196Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-2u2","title":"look at this project's AGENTS.md, remove duplicate chunks","description":"there are sections duplicated in and outside the managed area. consolidate and remove the _duplicated_ stuff outside the managed area.\nalso review and clean up. anything not key to daily work should be moved to notes/ with a markdown link","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-05T00:07:13.009310223Z","created_by":"bob","updated_at":"2026-02-05T00:10:20.262729460Z","closed_at":"2026-02-05T00:10:20.262699454Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-2ue","title":"Add tool-issue botbus reporting to workflow docs","description":"When agents encounter unexpected tool behavior (e.g., maw ws merge --destroy not destroying, br update failing silently), they should post a botbus message with -L tool-issue for observability. Add guidance to worker-loop.md stuck check section and finish.md. Example: botbus send --agent $AGENT $PROJECT 'Tool issue: maw ws merge --destroy did not remove workspace' -L tool-issue","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-30T14:23:47.593348743Z","created_by":"bob","updated_at":"2026-01-30T16:25:46.022592312Z","closed_at":"2026-01-30T16:25:46.022559470Z","close_reason":"Added tool-issue reporting to worker-loop.md stuck check and finish.md workspace destroy","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-2ul","title":"Improve review-loop.md: add cross-file consistency and boundary checks","description":"Add two new review steps to review-loop.md: (1) cross-file consistency comparison step between individual file review and commenting, (2) boundary/arithmetic check on user-supplied values. These address gaps found in R8v2 where both models missed TOCTOU (no cross-file comparison) and pagination underflow (no boundary checking). Also update r8-run.sh to reference the doc instead of embedding the workflow inline.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T19:37:38.136547583Z","created_by":"bob","updated_at":"2026-02-01T19:38:57.573034883Z","closed_at":"2026-02-01T19:38:57.572960023Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["eval"],"comments":[{"id":95,"issue_id":"bd-2ul","author":"Bob","text":"Done. review-loop.md updated with cross-file consistency (3f) and boundary checks (3g). r8-run.sh now references the doc instead of embedding. r8-setup.sh copies local docs. Tests pass (50/50). Committed as 4f5662a1.","created_at":"2026-02-01T19:38:57Z"}]}
{"id":"bd-2vct","title":"Respond script: triage messages and escalate to dev-loop","description":"Update respond.mjs to act as a triage layer that decides whether a message is casual chat or a work request, and only escalates to the dev-loop when needed.\n\n## Context\n\nCurrently dev-loop hooks fire on every message in a project channel. We're adding a `requireFlag` field to botbus hooks (see botbus bead) so dev-loops only fire on `!dev` messages. The respond script needs to become the intelligent entry point that can escalate when appropriate.\n\n## Design\n\nrespond.mjs currently handles @mention responses. It should be updated to:\n\n1. Read the incoming message\n2. Make a quick triage decision: is this chat/conversation or a work request (bug report, feature request, task)?\n3. If chat → reply conversationally inline\n4. If work → escalate to dev-loop by either:\n   a. Acquiring the `agent://X-dev` claim and exec'ing dev-loop.mjs directly, OR\n   b. Sending a `!dev` message to the channel to trigger the dev-loop hook\n5. If message already contains `!dev` → escalate immediately (skip triage)\n\n## Key considerations\n\n- Keep triage fast and cheap (small/fast LLM call or heuristic)\n- `!dev` in original message = force-escalate, no triage needed\n- This pairs with botbus's `requireFlag` feature — without it, escalation via `!dev` message won't gate the dev-loop hook\n- Migrate one project at a time to validate the workflow","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-02-06T21:31:49.214324760Z","created_by":"bob","updated_at":"2026-02-07T18:43:57.457468846Z","closed_at":"2026-02-07T18:43:57.457429973Z","close_reason":"Superseded by unified router plan — respond.mjs becomes the single entrypoint for all channel messages, not just a triage layer. New beads track the implementation.","source_repo":".","compaction_level":0,"original_size":0,"labels":["agents","hooks","respond"],"comments":[{"id":96,"issue_id":"bd-2vct","author":"botbox-dev","text":"Grooming: This would also fix bd-2wx4 (respond/dev hook race). Depends on botbus requireFlag feature — check if that's been implemented. Without it, the escalation via \\!dev message won't gate the dev hook.","created_at":"2026-02-07T17:21:56Z"}]}
{"id":"bd-2wq0","title":"respond.mjs: dev-loop escalation (!dev command + conversation handoff)","description":"Implement the handleDev() handler for !dev commands and conversation-to-dev handoffs.\n\n## Context\n\n`!dev` is the force-escalation command. It means \"I want the dev agent to handle this.\" It can be invoked directly (`!dev fix the login page`) or triggered by the triage handler or mid-conversation escalation.\n\nWhen called with conversation context (transcript), the dev-loop should receive that context so it understands what was discussed and why it is being escalated.\n\n## What to build\n\n`handleDev(route, channel, triggerMessage, transcript)`:\n\n### Direct !dev (message has body)\n\n1. Create a bead from the message body (reuse handleBead logic or call it directly)\n2. Spawn dev-loop via botty:\n   ```\n   botty spawn --env-inherit BOTBUS_CHANNEL,BOTBUS_MESSAGE_ID,BOTBUS_AGENT,BOTBUS_HOOK_ID\n     --name $AGENT --cwd $PROJECT_DIR\n     -- bun .agents/botbox/scripts/dev-loop.mjs $PROJECT $AGENT\n   ```\n3. The dev-loop will pick up the bead from `br ready` on its first iteration\n4. Exit respond.mjs (dev-loop takes over)\n\n### Bare !dev (no body)\n\n1. Just spawn dev-loop — it will check inbox and br ready on its own\n2. Exit respond.mjs\n\n### Conversation handoff (transcript has entries)\n\n1. Create a bead with conversation summary as description:\n   - Title: derived from the escalation reason (what the conversation identified)\n   - Description: includes formatted transcript + the specific issue identified\n   - Call handleBead() or create directly\n2. Spawn dev-loop via botty\n3. Exit respond.mjs\n\n### Claim management\n\n- respond.mjs holds `agent://X-dev` claim from the hook\n- When spawning dev-loop, the dev-loop will re-stake the claim on its own (it already does this)\n- respond.mjs should release its claim before exiting, OR the hook should use --release-on-exit so the claim is released when respond.mjs process ends\n- The botty-spawned dev-loop is a separate process, so it manages its own claim lifecycle\n\n### Important: do NOT exec into dev-loop\n\nSpawn via botty, do not exec. This keeps the process lifecycle clean — respond.mjs exits, dev-loop runs independently in its own PTY managed by botty.\n\n## Acceptance criteria\n\n- [ ] `!dev fix something` creates a bead + spawns dev-loop\n- [ ] Bare `!dev` spawns dev-loop without creating a bead\n- [ ] Conversation handoff: bead description includes transcript summary\n- [ ] Dev-loop spawned via botty spawn with correct env vars and args\n- [ ] respond.mjs exits cleanly after spawning dev-loop\n- [ ] Claim lifecycle is clean (no orphaned claims blocking future hooks)\n- [ ] Dev-loop picks up the work (bead shows in br ready or inbox)\n\n## Files to modify\n\n- `packages/cli/scripts/respond.mjs` — implement handleDev()","status":"closed","priority":2,"issue_type":"feature","owner":"bob","created_at":"2026-02-07T18:45:32.090309718Z","created_by":"bob","updated_at":"2026-02-07T19:57:58.374696370Z","closed_at":"2026-02-07T19:57:58.374669049Z","close_reason":"Implemented: handleDev() with bead creation, botty spawn, env-inherit, conversation handoff.","source_repo":".","compaction_level":0,"original_size":0,"labels":["respond"],"dependencies":[{"issue_id":"bd-2wq0","depends_on_id":"bd-1x3x","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-2wq0","depends_on_id":"bd-32fe","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-2wq0","depends_on_id":"bd-c128","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-2wx4","title":"#botcrit respond fired first, exited immediately","description":"When a message is posted to #botcrit containing @botcrit-dev, two hooks match simultaneously:\n- hk-1sg (mention-based, priority 1): spawns botcrit-dev running respond.mjs\n- hk-18y (claim-based, priority 0): spawns botcrit-dev running dev-loop.mjs\n\nBoth try to spawn the same agent name. The respond hook fires first, respond.mjs sees a task message (not a question), exits immediately (~2s). Then the dev hook fires and processes the actual work.\n\nImpact: Low — system recovers. The respond spawn is wasted (brief PTY session, no useful work). But it adds latency and confusing log noise.\n\nRoot cause: respond and dev hooks share the same agent name and can both match the same message. No priority ordering prevents dual-fire for different condition types.\n\nRelated: bd-2vct (respond as triage layer) would solve this by making respond the single entry point that decides whether to escalate to dev-loop.","status":"closed","priority":3,"issue_type":"bug","created_at":"2026-02-07T01:20:29.580464783Z","created_by":"bob","updated_at":"2026-02-07T18:44:00.577646808Z","closed_at":"2026-02-07T18:44:00.577619847Z","close_reason":"Fixed by unified router plan — single hook per project channel replaces the dual dev+respond hooks that caused this race condition. See new respond.mjs router beads.","source_repo":".","compaction_level":0,"original_size":0,"labels":["bus"]}
{"id":"bd-2xgo","title":"add claude hook to claim agent://$BOTBUS_AGENT on session start","description":"only do if BOTBUS_AGENT is set\n\nshould fail silently\n\neach tool call and/or message should try to refresh the claim if it's within a couple of minutes of expiring and fail silently\n","status":"closed","priority":2,"issue_type":"feature","owner":"botbox-dev","created_at":"2026-02-09T15:53:58.404930451Z","created_by":"bob","updated_at":"2026-02-09T16:11:04.365612366Z","closed_at":"2026-02-09T16:11:04.365589573Z","close_reason":"Added claim-agent.sh hook with SessionStart+PostToolUse events. Stakes agent:// claim on session start, refreshes when within 120s of TTL expiry. All errors silent.","source_repo":".","compaction_level":0,"original_size":0,"labels":["claude"],"dependencies":[{"issue_id":"bd-2xgo","depends_on_id":"bd-3emc","type":"blocks","created_at":"2026-02-09T16:08:44.551523856Z","created_by":"botbox-dev","metadata":"{}","thread_id":""}],"comments":[{"id":171,"issue_id":"bd-2xgo","author":"botbox-dev","text":"Grooming: New hook claim-agent.sh. Events: SessionStart (stake claim), PostToolUse (refresh if TTL < 120s). Requires: botbus tool enabled. Guard: only if BOTBUS_AGENT env var is set. All errors silent (exit 0). Claim URI: agent://$BOTBUS_AGENT with --ttl 600. Depends on bd-3emc being fixed first so hooks actually work at repo root.","created_at":"2026-02-09T16:08:41Z"}]}
{"id":"bd-2ya","title":"Fix sync printing null for missing version marker","description":"When .version file is missing, readVersionMarker returns null. sync.mjs prints 'Synced: null → abc123'. Should print 'Synced: (none) → abc123' or similar.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-29T17:33:15.114715661Z","created_by":"bob","updated_at":"2026-01-29T17:36:31.813981708Z","closed_at":"2026-01-29T17:36:31.813957092Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"labels":["review-finding","should-fix"],"dependencies":[{"issue_id":"bd-2ya","depends_on_id":"bd-2gl","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-2ydt","title":"Add JSON envelope convention to cli-conventions.md","description":"Formalize the JSON output envelope pattern across all CLI tools in the ecosystem.\n\nConvention:\n- Never return bare arrays — always wrap in a named object\n- Always include an 'advice' array for sideband messages (warnings, deprecation, hints)\n- Each advice entry: { level: info|warn|error|fatal, type: string, message: string, details: object }\n- Loosely inspired by RFC 9457 (Problem Details for HTTP APIs)\n\nReference implementation: maw ws list --format json returns { workspaces: [...], advice: [...] }\n\nCurrent state — needs updating:\n- crit reviews list --format json → bare array\n- bus hooks list --format json → bare array\n- br ready --format json → bare array\n\nTasks:\n1. Add JSON envelope section to cli-conventions.md with examples and rationale\n2. File beads/issues in companion projects (botbus, botcrit, beads) to adopt the convention","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-09T14:53:24.231743806Z","created_by":"botbox-dev","updated_at":"2026-02-09T16:04:12.063454068Z","closed_at":"2026-02-09T16:04:12.063423480Z","close_reason":"Shipped in v0.5.0 — JSON envelope convention added to cli-conventions.md, beads filed in all 5 companion projects","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli-conventions","design"],"comments":[{"id":167,"issue_id":"bd-2ydt","author":"botbox-dev","text":"Advice entry spec finalized:\n\n{ level: \"info\"|\"warn\"|\"error\"|\"fatal\", type: \"kebab-case-string\", message: \"...\", details: { ... } }\n\ntype is a short kebab-case identifier (e.g. stale-workspace, deprecated-flag, missing-config). NOT a URI. Enables programmatic matching without string-parsing message text.\n\nNeed strong naming conventions in the doc to prevent drift — examples of good/bad type names, guidance on granularity.","created_at":"2026-02-09T14:55:03Z"}]}
{"id":"bd-2ym","title":"Write tests for @botbox/cli","description":"Write bun test suite covering: lib/docs.mjs (listWorkflowDocs, copyWorkflowDocs, currentVersion, version markers), lib/templates.mjs (renderAgentsMd, updateManagedSection with and without existing markers), commands/init.mjs (non-interactive mode, file creation, symlink), commands/sync.mjs (up-to-date check, stale detection, update), commands/doctor.mjs (tool checks, project structure checks). Use bun:test framework with temp directories.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-29T17:22:46.527815809Z","created_by":"bob","updated_at":"2026-01-29T17:25:07.020276186Z","closed_at":"2026-01-29T17:25:07.020248515Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-2zx","title":"Improve workflow docs based on eval insights","description":"Based on Level 2 eval results (Opus: 100%, Sonnet: 88%), improve workflow docs to close the 11-point gap:\n\n1. Emphasize complete workflow sequence (triage → start → update → finish)\n2. Clarify optional vs mandatory steps in docs\n3. Add explicit workspace cleanup to finish.md (merge + destroy)\n4. Clarify progress update timing in update.md (at least once during work)\n5. Reference worker-loop.md more prominently in AGENTS.md managed section\n6. Fix claim format from \"src/**\" to \"file://<project>/<file-glob>\"\n\nGap analysis:\n- No triage workflow (-2)\n- No progress update (-2)\n- Workspace not destroyed (-2)\n- Error handling gap (-5)\n\nAll gaps are documentation clarity issues, not capability issues.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T21:22:17.026061387Z","created_by":"bob","updated_at":"2026-01-29T21:23:45.635892504Z","closed_at":"2026-01-29T21:23:45.635863320Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":97,"issue_id":"bd-2zx","author":"Bob","text":"Completed workflow doc improvements:\n\n1. Fixed claim format: \"path/**\" → \"file://$BOTBOX_PROJECT/path/**\" (start.md + templates.mjs)\n2. Emphasized progress comments: \"at least one during work\" (worker-loop.md)\n3. Clarified update.md description: \"status updates\" → \"change bead status\" (templates.mjs)\n4. Emphasized workspace cleanup: made --destroy flag importance clear (finish.md)\n5. Added pointer to worker-loop.md as canonical workflow in managed section\n\nAll tests pass (50/50). Version hash: 14e15a9821fe","created_at":"2026-01-29T21:23:42Z"}]}
{"id":"bd-30v","title":"E2E: interactive edge cases via botty","description":"Test 7 from testing.md — arrow keys, deselect all, send-bytes for special keys","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-29T18:39:18.889592741Z","created_by":"bob","updated_at":"2026-01-29T18:45:49.631799510Z","closed_at":"2026-01-29T18:45:49.631780985Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-30v","depends_on_id":"bd-32v","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-310","title":"Add bus status updates to agent loops","description":"Update agent loop scripts (agent-loop.sh, dev-loop.sh, reviewer-loop.sh) to use `bus statuses set` for showing what they're doing.\n\nAPI: `bus statuses set --agent $AGENT \"message\" [--ttl 1h]`\nMax message length: 32 characters\n\nStatus updates to add:\n1. On loop start: \"Starting loop\"\n2. When claiming/working on bead: \"Working: bd-xyz\"\n3. When requesting review: \"Review: cr-xyz\"\n4. When blocked: \"Blocked: <reason>\"\n5. When idle (no work): \"Idle\"\n6. On shutdown: Clear status with `bus statuses clear`\n\nKey points:\n- Keep messages under 32 chars\n- Set appropriate TTL (e.g., --ttl 10m for active work)\n- Clear status on cleanup/exit\n- Add to agent-loop.sh, dev-loop.sh, reviewer-loop.sh prompts so agents set status as they work","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-03T03:21:37.444199600Z","created_by":"botbox-dev","updated_at":"2026-02-03T03:39:56.157934027Z","closed_at":"2026-02-03T03:39:56.157883802Z","close_reason":"Implemented bus status updates in all loop scripts","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-318","title":"Check other naming docs for whoami guidance","description":"Scan other workflow docs for agent naming/identity and add 'bus whoami' guidance where missing.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T22:34:31.696841109Z","created_by":"bob","updated_at":"2026-02-01T22:44:44.620734762Z","closed_at":"2026-02-01T22:44:44.620713462Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":98,"issue_id":"bd-318","author":"Bob","text":"Added bus whoami confirmation notes to remaining identity-resolve steps (triage, update, finish, merge-check, review-request, review-loop, review-response).","created_at":"2026-02-01T22:44:41Z"}]}
{"id":"bd-31q","title":"Update respond.mjs to continue on claim failure","description":"## Context\nbotbus is being updated so that staking an already-held claim will fail (instead of extending TTL). This prevents double-firing hooks.\n\n## Changes needed\nIn respond.mjs, when staking/refreshing the `respond://<agent>` claim:\n- If stake fails because claim is already held, **continue** (don't exit)\n- Another agent is orchestrating, that's fine\n- Same for refreshing before wait - if refresh fails, continue\n\n## Current behavior (wrong)\n```javascript\ntry {\n  await runCommand('bus', ['claims', 'stake', ...])\n} catch (err) {\n  console.log('Claim not available, exiting')\n  process.exit(0)  // <-- This should continue, not exit\n}\n```\n\n## New behavior\n```javascript\ntry {\n  await runCommand('bus', ['claims', 'stake', ...])\n  console.log('Claimed: ...')\n} catch {\n  console.log('Claim held by another agent, continuing')\n  // Continue - another agent is orchestrating\n}\n```","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-04T21:52:57.153042839Z","created_by":"botbox-dev","updated_at":"2026-02-04T21:58:52.646826665Z","closed_at":"2026-02-04T21:58:52.646794695Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-325q","title":"Drop TOON format recommendation, codify text output guidelines","description":"Remove TOON from cli-conventions.md as a recommended format. Simplify to two formats: text (default, for humans + agents) and json (for machines/parsing).\n\nAdd a 'Text Output Guidelines' section with concrete rules for making text output simultaneously human-scannable and LLM-comprehensible while staying token-efficient.\n\nUpdate the Output Formats table and all references to TOON throughout the doc.\n\nRelated: bd-2ydt (JSON envelope convention)","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-09T15:00:34.327857562Z","created_by":"botbox-dev","updated_at":"2026-02-09T16:04:13.459984690Z","closed_at":"2026-02-09T16:04:13.459951619Z","close_reason":"Shipped in v0.5.0 — TOON dropped, text guidelines added, pretty format with TTY auto-detection codified","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli-conventions","design"],"comments":[{"id":168,"issue_id":"bd-325q","author":"botbox-dev","text":"Updated format matrix — three formats:\n\n- text (default): agents + humans. Token-efficient, grep-friendly, no decoration.\n- pretty (optional): humans interactively. Tables, color, box-drawing, alignment. Pure presentation.\n- json: machines. Structured, parseable, envelope convention (bd-2ydt).\n\nConsider: auto-select pretty when stdout is a TTY and no --format given. Agents always get text (they pipe or pass --format explicitly). Humans get pretty for free.\n\nTOON is fully removed from recommendations.","created_at":"2026-02-09T15:02:47Z"},{"id":169,"issue_id":"bd-325q","author":"botbox-dev","text":"Decided: TTY auto-detection for pretty.\n\nDefault resolution order:\n1. --format flag (highest priority, explicit always wins)\n2. FORMAT env var\n3. TTY detection: stdout is TTY → pretty, not TTY → text\n\nThis means:\n- Human typing in terminal → pretty (tables, color, alignment)\n- Agent piping output → text (token-efficient, grep-friendly)\n- Script with explicit --format json → json\n- Human who prefers text → --format text or FORMAT=text\n\nAgents never see pretty unless they explicitly ask for it. Humans get it for free.","created_at":"2026-02-09T15:03:57Z"}]}
{"id":"bd-32b7","title":"E10: Write Phase 4.5 script (hook verification)","description":"# Context\n\nPhase 4.5 is an automated (no-agent) verification step between Phase 4 and Phase 5. It checks that botbox init correctly registered hooks, particularly the mention hook for alpha-security.\n\n# Goals\n\n- Create `evals/scripts/e10-phase4_5.sh`\n- Script sources .eval-env, runs bus hooks list, validates hook structure\n- No claude invocation — purely automated checks\n- Saves pass/fail results to artifacts\n\n# Background\n\nPhase 4.5 is scored at 5 points. Key: mention hook registered for alpha-security (3 pts), hook command is well-formed with botty spawn and --pass-env (2 pts).\n\n# Implementation Approach\n\n## Verification Logic\n\n```bash\nHOOKS_OUTPUT=$(BOTBUS_DATA_DIR=\"$BOTBUS_DATA_DIR\" bus hooks list)\n# Check alpha-security mention hook exists\necho \"$HOOKS_OUTPUT\" | grep -q \"alpha-security\" && echo \"PASS: alpha-security hook found\" || echo \"FAIL: alpha-security hook missing\"\n# Check hook command format (botty spawn, --pass-env)\necho \"$HOOKS_OUTPUT\" | grep \"alpha-security\" | grep -q \"pass-env\" && echo \"PASS: --pass-env present\" || echo \"FAIL: --pass-env missing\"\necho \"$HOOKS_OUTPUT\" | grep \"alpha-security\" | grep -q \"botty spawn\" && echo \"PASS: botty spawn present\" || echo \"FAIL: botty spawn missing\"\n```\n\n## Files to Create\n\n- `evals/scripts/e10-phase4_5.sh`\n\n## Acceptance Criteria\n\n- [ ] No claude invocation (automated only)\n- [ ] Checks for alpha-security mention hook\n- [ ] Checks for --pass-env and botty spawn in hook command\n- [ ] Results saved to artifacts","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-06T20:47:10.909900750Z","created_by":"botbox-dev","updated_at":"2026-02-06T21:07:53.239581262Z","closed_at":"2026-02-06T21:07:53.239545735Z","close_reason":"Phase 4.5 script written: evals/scripts/e10-phase4_5.sh","source_repo":".","compaction_level":0,"original_size":0,"labels":["e10"],"dependencies":[{"issue_id":"bd-32b7","depends_on_id":"bd-1436","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-32fe","title":"respond.mjs: bead creation (!bead command)","description":"Implement the handleBead() handler for the !bead command. Smart bead creation with dedup.\n\n## Context\n\nUsers should be able to quickly capture work items from a channel message without spawning a full dev-loop. `!bead fix the login page timeout` should create a bead titled \"fix the login page timeout\" if one does not already exist.\n\n## What to build\n\n`handleBead(route, channel, triggerMessage, transcript)`:\n\n1. Extract the bead description from route.body\n2. **Dedup check**: Search existing open beads for duplicates:\n   - `br search \"<keywords from body>\"` — full-text search\n   - If matches found, use a quick haiku call to compare: \"Is this new request already covered by any of these existing beads?\" Pass the message body + list of matching bead titles/descriptions.\n   - If duplicate found: reply on channel \"Already tracked as bd-XXXX: <title>\" and exit\n3. **Create bead**: If no duplicate:\n   - Parse title from body (first sentence or first N words)\n   - Use haiku to generate a clean title + description from the raw message if it is long/messy\n   - `br create --actor $AGENT --owner $AGENT --title=\"...\" --description=\"...\" --type=task --priority=2`\n   - If transcript has context (called from mid-conversation escalation), include conversation summary in description\n4. **Report back**: Post to channel \"Created bd-XXXX: <title>\"\n\n### Edge cases\n\n- `!bead` with no body: reply \"Usage: !bead <description of what needs to be done>\"\n- Very long messages: truncate title to first sentence, put full text in description\n- If `br search` fails or returns error: skip dedup, create anyway (fail open)\n\n## Acceptance criteria\n\n- [ ] `!bead <description>` creates a bead with appropriate title and description\n- [ ] Dedup via `br search` prevents obvious duplicates\n- [ ] Haiku used for fuzzy dedup comparison when br search returns potential matches\n- [ ] Reports created bead ID back to channel via bus send\n- [ ] Reports duplicate bead ID if dedup matches\n- [ ] Handles empty body gracefully (usage message)\n- [ ] Long messages: first sentence as title, full text as description\n- [ ] Conversation context from transcript included in description when available\n\n## Files to modify\n\n- `packages/cli/scripts/respond.mjs` — implement handleBead()","status":"closed","priority":2,"issue_type":"feature","owner":"bob","created_at":"2026-02-07T18:45:12.471633653Z","created_by":"bob","updated_at":"2026-02-07T19:57:58.307994610Z","closed_at":"2026-02-07T19:57:58.307966638Z","close_reason":"Implemented: handleBead() with br search dedup, bead creation, channel reporting.","source_repo":".","compaction_level":0,"original_size":0,"labels":["respond"],"dependencies":[{"issue_id":"bd-32fe","depends_on_id":"bd-c128","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-32v","title":"E2E: interactive init via botty","description":"Test 2 from testing.md — spawn botbox init inside botty, drive prompts with send/wait/snapshot","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T18:39:18.836055714Z","created_by":"bob","updated_at":"2026-01-29T18:45:49.627517082Z","closed_at":"2026-01-29T18:45:49.627489710Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-32v","depends_on_id":"bd-1ws","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-330b","title":"Document botbox ecosystem expertise in AGENTS.md","description":"Deep dive into all companion tools (botbus, maw, botcrit, botty, beads), understand how agents run, how scripts launch, how hooks connect everything. Distill into AGENTS.md for fresh context pre-loading.","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-06T15:30:10.303752115Z","created_by":"botbox-dev","updated_at":"2026-02-06T15:37:13.459535607Z","closed_at":"2026-02-06T15:37:13.459508977Z","close_reason":"Completed - AGENTS.md enriched with full ecosystem expertise","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":99,"issue_id":"bd-330b","author":"botbox-dev","text":"Rewrote AGENTS.md with comprehensive ecosystem documentation: companion tools deep dive (bus, maw, crit, botty, br), end-to-end agent spawn chain, loop scripts, hook types, debugging/troubleshooting guide, botty tail workflow, eval framework summary, config schema, output formats, and message labels. All 145 tests pass.","created_at":"2026-02-06T15:37:09Z"}]}
{"id":"bd-33z","title":"Add default_agent and project_channel to .botbox.json","description":"Add two new fields to .botbox.json:\n- default_agent: the lead agent name (e.g. botbox-dev) derived from dirname during init\n- project_channel: the botbus channel for the project\n\nUpdate all references:\n- init.mjs: populate these fields during init\n- sync.mjs: use these values instead of re-deriving\n- scripts (agent-loop, dev-loop, reviewer-loop): read from config\n- docs: reference the config values\n\nThis centralizes project identity in one place.","status":"closed","priority":1,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-03T20:47:54.131624343Z","created_by":"botbox-dev","updated_at":"2026-02-03T20:51:24.269626534Z","closed_at":"2026-02-03T20:51:24.269592971Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":100,"issue_id":"bd-33z","author":"botbox-dev","text":"Completed:\n- Added project.default_agent and project.channel to .botbox.json config in init.mjs\n- Created migration 1.0.4 to add these fields to existing configs\n- Updated dev-loop.mjs, agent-loop.mjs, reviewer-loop.mjs to read from config\n- Scripts now have optional CLI args (fall back to config values)\n- Updated packages/cli/AGENTS.md with documentation\n- All 105 tests pass\n- Verified migration on maw companion project","created_at":"2026-02-03T20:51:21Z"}]}
{"id":"bd-340","title":"Auto-commit botbox sync changes","description":"## Problem\n\nWhen `botbox sync` updates docs, scripts, prompts, or runs migrations, these changes sit in the working copy. Agents often accidentally commit them with unrelated feature work, making messy commits.\n\n## Proposal\n\nHave `botbox sync` auto-commit its changes with a message like:\n```\nchore: upgrade botbox from v1.0.3 to v1.0.4\n```\n\nIn jj terms:\n1. After making changes, run `jj describe -m \"chore: upgrade botbox ...\"`\n2. Then `jj new` to finalize and leave a clean working copy\n\n## Considerations\n\n- Should be opt-in or opt-out? (flag like `--no-commit`?)\n- Need to detect if there are already uncommitted changes and warn/abort\n- Should include what was updated in the commit message (docs, scripts, prompts, migrations)\n- Version info: read old version from .botbox.json before update, compare with new\n\n## Example output\n\n```\nUpdated workflow docs\nUpdated managed section of AGENTS.md\nUpdated loop scripts: dev-loop.mjs, reviewer-loop.mjs\nUpdated .botbox.json: 1.0.3 → 1.0.4\nCommitted: chore: upgrade botbox from 1.0.3 to 1.0.4\n```","status":"closed","priority":3,"issue_type":"feature","owner":"botbox-dev","created_at":"2026-02-04T14:14:31.906593014Z","created_by":"botbox-dev","updated_at":"2026-02-04T17:01:19.868902550Z","closed_at":"2026-02-04T17:01:19.868867234Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":101,"issue_id":"bd-340","author":"botbox-dev","text":"Decisions: (1) Opt-out - auto-commit by default, use --no-commit to skip. (2) If working copy already has uncommitted changes, warn and skip auto-commit (don't mix sync changes with existing work).","created_at":"2026-02-04T14:15:19Z"},{"id":102,"issue_id":"bd-340","author":"botbox-dev","text":"More decisions:\n1. jj only - botbox is opinionated, no git support needed\n2. No-op = no commit (don't create empty commits)\n3. Only commit changes made by botbox sync - track which files sync touches and commit only those (not unrelated working copy changes)\n4. First-time case: botbox init should also auto-commit with \"chore: initialize botbox v1.0.4\"\n5. Commit message includes what changed (docs, scripts, prompts, migrations)\n6. No auto-push - keep it local only","created_at":"2026-02-04T14:18:01Z"},{"id":103,"issue_id":"bd-340","author":"botbox-dev","text":"Started in workspace bd-340 (/home/bob/src/botbox/.workspaces/bd-340). Will implement auto-commit for sync/init with jj.","created_at":"2026-02-04T16:56:55Z"}]}
{"id":"bd-358v","title":"crit: auto-search workspace .crit/ dirs when review not found at cwd","description":"When a review ID is provided and not found at the current path, crit should search .workspaces/*/.crit/ directories and either auto-resolve or print a better error like 'Review cr-xxxx not found here, but found in workspace gold-tiger — use --path .workspaces/gold-tiger/'. This would also solve thread lookup for crit reply: instead of working globally, reply would search workspaces and suggest --path.\n\nEvidence from E10-2: the --path requirement was hit 5 times across 4 phases (4, 5, 6, 7, 8), causing ~34 wasted tool calls due to sibling cancellation amplification. Every agent in every phase that touched the review hit this friction.","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-02-07T02:08:16.652813700Z","created_by":"botbox-dev","updated_at":"2026-02-07T18:38:05.577572507Z","closed_at":"2026-02-07T18:38:05.577546789Z","close_reason":"crit v0.15.0 shipped auto-search workspaces feature (commit 8882eb63 in botcrit). We have v0.15.1 installed which includes it.","source_repo":".","compaction_level":0,"original_size":0,"labels":["crit","tool-issue"],"comments":[{"id":104,"issue_id":"bd-358v","author":"botbox-dev","text":"Grooming: bd-1bs filed in botcrit for the actual implementation. Review cr-2g4r is approved. Waiting on crit release. This bead is now a tracking bead — close when crit ships the feature and we upgrade.","created_at":"2026-02-07T17:21:45Z"}]}
{"id":"bd-35u","title":"Update workflow docs to use bus CLI","description":"Replace botbus CLI command references with bus in packages/cli/docs, preserving botbus when referring to the system or channel.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T22:34:22.516757868Z","created_by":"bob","updated_at":"2026-02-01T22:37:53.744255429Z","closed_at":"2026-02-01T22:37:53.744238637Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":105,"issue_id":"bd-35u","author":"Bob","text":"Updated workflow docs in packages/cli/docs to use bus commands; adjusted announcement templates and whoami guidance where applicable.","created_at":"2026-02-01T22:37:15Z"}]}
{"id":"bd-363","title":"Handle claude CLI 'no messages returned' freeze","description":"Implement workaround for claude CLI hang bug (Issue #19060).\n\nProblem: claude CLI occasionally hangs during exit with 'no messages returned' error. Process never exits, requires Ctrl+C.\n\nSolution (production-tested):\n1. Use --output-format stream-json\n2. Parse streamed JSON for '\"type\":\"result\"' message (emitted before hang)\n3. After detecting result, give 2s grace period then kill if hung\n4. Add explicit completion signals to prompts (<promise>COMPLETE</promise>)\n\nImplementation:\n- Update loop scripts to spawn claude with stream-json output\n- Parse JSON stream line-by-line\n- Detect completion via result message\n- Timeout-kill if process hangs\n- Validate completion with explicit signals\n\nTesting:\n- Run agent loops for extended periods\n- Verify graceful handling of hangs\n- Confirm no false positives (killing working sessions)\n\nReference: https://github.com/anthropics/claude-code/issues/19060","status":"closed","priority":1,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-03T13:46:07.528116202Z","created_by":"botbox-dev","updated_at":"2026-02-03T13:55:29.237467287Z","closed_at":"2026-02-03T13:55:29.237452980Z","close_reason":"Completed. All three loop scripts converted to Node.js with stream-json parsing and hang workaround implemented.","source_repo":".","compaction_level":0,"original_size":0,"labels":["agent-loop","bug"]}
{"id":"bd-369","title":"Standardize ecosystem projects on Justfile targets","description":"Update all ecosystem projects to use standard Justfile targets for build/install/test.\n\nProjects: crit, maw, botbus, botty, botbox\n\nImplementation:\n1. Ensure each project has a Justfile with standard targets:\n   - `just build` - builds the project (calls cargo build, npm build, etc.)\n   - `just install` - installs locally (cargo install --path ., npm link, etc.)\n   - `just test` - runs tests (cargo test, npm test, etc.)\n\n2. Update release sections in each AGENTS.md to reference `just build` and `just install` instead of cargo/npm commands directly\n\n3. Benefits:\n   - Consistent interface across all projects regardless of language\n   - Easier for agents to follow release workflows\n   - Single source of truth for build/install commands\n\nExample release section should reference:\n```bash\njust test      # instead of cargo test\njust build     # instead of cargo build\njust install   # instead of cargo install --path .\n```","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-03T02:13:20.994909049Z","created_by":"botbox-dev","updated_at":"2026-02-03T02:15:52.763855848Z","closed_at":"2026-02-03T02:15:52.763825852Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":106,"issue_id":"bd-369","author":"botbox-dev","text":"Standardized all ecosystem projects on Justfile targets:\n\n✓ Updated Justfiles:\n  - crit, maw, botbus, botty: Added `build`, `test`, `install` targets\n  - botbox: Added `build`, `test`, updated `install` to use bun link\n\n✓ Updated AGENTS.md release/dev sections:\n  - crit: Release checklist now uses `just test` and `just install`\n  - maw: Release process now uses `just install`\n  - botbus: Pre-commit checklist uses `just test`, dev workflow uses `just build && just test`\n  - botty: Test commands use `just test` and `just build`\n\nAll projects now have consistent interface:\n- `just build` - builds the project\n- `just test` - runs tests\n- `just install` - installs locally","created_at":"2026-02-03T02:15:48Z"}]}
{"id":"bd-36et","title":"update botbox agent instructions for release","description":"maw v0.28.1 now pushes tags when doing `maw push`\nthis can be skipped with `--no-tags`\nwe should be able to simplify instructions for releases if we were saying to push tags","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-09T00:21:39.515033318Z","created_by":"bob","updated_at":"2026-02-09T00:33:56.212077236Z","closed_at":"2026-02-09T00:33:56.212017914Z","close_reason":"Simplified release tag instructions: maw push now handles tag pushing, removed separate jj git push commands","source_repo":".","compaction_level":0,"original_size":0,"labels":["maw"]}
{"id":"bd-36m","title":"R8v2: run Opus eval, score, write report","description":"Fresh r8-setup.sh, run r8-run.sh with CLAUDE_MODEL=opus. Score against v2 rubric (65pts). Write eval-results/2026-02-01-review-r8-run2-opus.md. Key: cross-file reasoning category (did reviewer compare download.rs vs delete.rs?).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T19:08:10.496823470Z","created_by":"bob","updated_at":"2026-02-01T19:18:50.297840219Z","closed_at":"2026-02-01T19:18:50.297765449Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["eval"],"dependencies":[{"issue_id":"bd-36m","depends_on_id":"bd-138","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-36m","depends_on_id":"bd-gei","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":107,"issue_id":"bd-36m","author":"Bob","text":"Opus scored 49/65 (75%). Found Bug 1 (race) and Bug 2 (TOCTOU) perfectly (24/24). Missed Bug 3 (pagination underflow, 0/6). No cross-file reasoning for TOCTOU (0/5) — found via internal delete.rs analysis, not download.rs comparison. FP resistance perfect under v2 rules (5/5). Report written to eval-results/2026-02-01-review-r8-run2-opus.md.","created_at":"2026-02-01T19:18:45Z"}]}
{"id":"bd-37k","title":"Add cass search tip to workflow docs","description":"Add a tip to relevant workflow docs (worker-loop.md, triage.md) about using 'cass search' to find how similar problems were solved in past sessions. Brief mention, not a core workflow step.","status":"closed","priority":3,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-05T16:25:19.561436673Z","created_by":"botbox-dev","updated_at":"2026-02-05T16:25:50.850460055Z","closed_at":"2026-02-05T16:25:50.850430269Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-397","title":"Add files field to package.json","description":"No files field in package.json. Add files: [src/, docs/] to ensure workflow docs ship in the npm tarball.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-29T17:33:16.239707729Z","created_by":"bob","updated_at":"2026-01-29T17:37:25.449464609Z","closed_at":"2026-01-29T17:37:25.449436336Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"labels":["review-finding","should-fix"]}
{"id":"bd-3c7","title":"Add botbox run-agent command for pretty LLM output","description":"Add 'botbox run-agent claude' command that wraps claude CLI with pretty stream-json output and markdown formatting. This centralizes the parsing/styling logic instead of duplicating it in agent-loop.mjs, dev-loop.mjs, reviewer-loop.mjs.\n\nFeatures:\n- Parse --output-format stream-json events\n- Pretty print tool calls (▶ bold tool name, dim args)\n- Pretty print tool results (green ✓, dim output)\n- Format agent text responses as markdown (syntax highlighting, lists, etc.)\n- Support --model, --prompt, --timeout flags\n- Exit cleanly after completion\n\nFuture: Support other agent types beyond Claude.","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-03T14:37:21.760412405Z","created_by":"botbox-dev","updated_at":"2026-02-03T14:45:06.332292312Z","closed_at":"2026-02-03T14:45:06.332269039Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","enhancement"],"comments":[{"id":108,"issue_id":"bd-3c7","author":"botbox-dev","text":"Implemented botbox run-agent command:\n- Created packages/cli/src/commands/run-agent.mjs\n- Registered in packages/cli/src/index.mjs\n- Supports --prompt, --model, --timeout flags\n- Pretty prints tool calls (▶ bold name, dim args)\n- Pretty prints tool results (green ✓, dim output)\n- Formats markdown in responses (bold, code, headers)\n- Tested with simple and complex prompts\n\nNext: Update agent-loop.mjs, dev-loop.mjs, reviewer-loop.mjs to call 'botbox run-agent claude' instead of spawning claude directly","created_at":"2026-02-03T14:43:20Z"},{"id":109,"issue_id":"bd-3c7","author":"botbox-dev","text":"Updated all three loop scripts:\n- agent-loop.mjs: removed 128 lines of duplicated code\n- dev-loop.mjs: removed 128 lines of duplicated code\n- reviewer-loop.mjs: removed 80 lines of duplicated code\n\nAll now call 'botbox run-agent claude' with:\n- Simplified runClaude() function (35 lines vs 91 lines)\n- Pass-through stdout/stderr for pretty output\n- Model and timeout flags forwarded\n\nNet reduction: ~350 lines of duplicated code removed!","created_at":"2026-02-03T14:45:02Z"}]}
{"id":"bd-3e7","title":"Add agent naming convention to workflow docs","description":"Convention: agents should adopt <project>-dev as their name (e.g., botbox-dev, maw-dev) unless spawned by agent-loop.sh (which generates random names like storm-raven). Update worker-loop.md identity section and preflight.md. The agent-loop.sh already handles this with botbus generate-name.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-30T16:23:36.583541354Z","created_by":"bob","updated_at":"2026-01-30T16:25:46.079834977Z","closed_at":"2026-01-30T16:25:46.079808477Z","close_reason":"Added naming convention to worker-loop.md identity section and preflight.md step 1","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-3emc","title":"agent hooks should be put in repo root","description":".claude/... and similar stuff need to go in repo root because that's where agents are launched","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-09T15:49:32.915066840Z","created_by":"bob","updated_at":"2026-02-09T16:10:07.970471451Z","closed_at":"2026-02-09T16:10:07.970446263Z","close_reason":"Added copyFileSync of .claude/settings.json from ws/default/ to repo root in both init.mjs and sync.mjs maw v2 delegation paths","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":170,"issue_id":"bd-3emc","author":"botbox-dev","text":"Grooming: The problem is that in maw v2, init/sync delegate to `maw exec default -- botbox init/sync` which creates .claude/settings.json inside ws/default/. But Claude Code launches at repo root, so it never finds the hooks. Fix: after delegation, copy .claude/settings.json (or the whole .claude/ dir) from ws/default/ to repo root. The hooks use absolute paths so this just works. Already handles AGENTS.md/CLAUDE.md stubs the same way.","created_at":"2026-02-09T16:08:39Z"}]}
{"id":"bd-3eqc","title":"make sure the automatic jj commits only touch botbox files. very important! .age","description":"make sure the automatic jj commits only touch botbox files. very important! .agents/botbox/ and other botbox-managed dotfiles only","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-07T21:05:47.785885331Z","created_by":"botbox-dev","updated_at":"2026-02-07T21:11:17.177960179Z","closed_at":"2026-02-07T21:11:17.177932467Z","close_reason":"Completed: jj commit with paths, sync and init pass managed paths only","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":110,"issue_id":"bd-3eqc","author":"botbox-dev","text":"Progress: Implemented scoped jj commits for botbox sync and init. The commit() function in jj.mjs now accepts an optional paths array. When paths are provided, it uses 'jj commit -m <msg> <paths>' which only commits the specified files, leaving other working copy changes untouched. sync.mjs passes [.agents/botbox, AGENTS.md, .botbox.json, .critignore] as needed. init.mjs passes the full set of botbox-managed paths. Added two new tests verifying single-path and multi-path scoped commits. All 181 tests pass.","created_at":"2026-02-07T21:10:22Z"}]}
{"id":"bd-3fi","title":"Add botbox-triage skill to handle incoming work requests","description":"The triage skill (draft/triage.md) needs to handle cross-project work requests via botbus. Define the convention: how an agent in project X sends a task-request to project Y's channel, and how the triage loop picks it up and creates a bead.","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-29T17:22:47.223273035Z","created_by":"bob","updated_at":"2026-01-29T19:37:00.333127272Z","closed_at":"2026-01-29T19:37:00.333099089Z","close_reason":"Obsolete. Pivoted away from skills to workflow docs. Triage is now documented in triage.md and report-issue.md handles cross-project feedback.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-3fm","title":"Prevent init from silently overwriting AGENTS.md","description":"botbox init unconditionally overwrites AGENTS.md if it exists. Should detect existing file and either warn+skip or require --force flag. Same pattern as the CLAUDE.md symlink check.","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-29T17:33:14.491893090Z","created_by":"bob","updated_at":"2026-01-29T17:35:09.073900602Z","closed_at":"2026-01-29T17:35:09.073876136Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"labels":["must-fix","review-finding"]}
{"id":"bd-3gl","title":"Add cross-project feedback workflow and #projects registry","description":"Enable agents to discover projects, file bugs in other repos, and notify project leads.\n\nComponents:\n1. New doc: report-issue.md (or cross-project-feedback.md)\n   - Query #projects registry to find tool owner\n   - Navigate to project repo\n   - Create beads with br create\n   - Post to project channel with -L feedback tagging @<lead-agent>\n\n2. Update triage.md\n   - Add step for handling -L feedback messages from other agents\n   - Review mentioned beads, respond on botbus\n\n3. Populate #projects registry\n   - Format: 'project:<name> repo:<path> lead:<agent> tools:<tool1>,<tool2>'\n   - Labels: -L project-registry\n   - Initial projects: botty, botbus, beads_rust, botcrit, maw, botbox\n\n4. Update AGENTS.md managed section template\n   - Mention #projects registry pattern\n   - Link to report-issue.md\n\nThis enables the full loop:\n- Agent uses tool, encounters issue\n- Agent files beads in tool's repo\n- Agent notifies tool's lead agent\n- Lead agent triages and responds","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-29T19:20:08.085772239Z","created_by":"bob","updated_at":"2026-01-29T19:22:14.970190555Z","closed_at":"2026-01-29T19:22:14.970166410Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-3ha","title":"Create iteration-start summary script","description":"Script like triage.mjs that outputs: inbox messages, open beads/triage results, open reviews assigned to agent. Speeds up iteration start.","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-05T01:47:43.426465569Z","created_by":"botbox-dev","updated_at":"2026-02-05T02:04:58.642627029Z","closed_at":"2026-02-05T02:04:58.642599046Z","close_reason":"Merged to main (cr-3spv approved)","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":111,"issue_id":"bd-3ha","author":"botbox-dev","text":"Implemented in workspace red-falcon. New script iteration-start.mjs shows combined status of inbox, beads, reviews, and claims.","created_at":"2026-02-05T01:56:40Z"}]}
{"id":"bd-3jd","title":"Add maw/jj quick reference section to CLAUDE.md template","description":"## Context\n\nAgents are hitting divergent commit issues with jj workspaces because they don't understand the ownership model. We have a quick reference section for beads in the botbox CLAUDE.md template - we need the same for maw/jj since it's equally important.\n\n## What to add\n\nAdd a \"Workspace Commands\" or \"maw/jj Quick Reference\" section similar to the Beads section. Should include:\n\n### Pitfalls / Avoiding Divergent Commits\n\nEach workspace owns ONE commit. Divergent commits happen when you modify a commit you don't own.\n\n✅ Safe:\n- `jj describe` (modifies YOUR working copy)\n- `maw ws jj <your-ws> describe -m \"...\"`\n\n❌ Causes divergence:\n- `jj describe main -m \"...\"` (modifies shared commit)  \n- `jj describe <other-workspace-change-id>`\n- Running commands in wrong workspace directory\n\nRecovery if you see `(divergent)` in jj log:\n```bash\njj abandon <change-id>/0   # keep one, abandon others\n```\n\n### Quick reference table\n\nSimilar format to beads table - common operations, exact commands.\n\n## Notes from bob\n\n- Need this to be as prominent as the beads quick reference\n- maw/jj is just as key as beads for multi-agent workflows\n- Consider adding explicit runtime warnings when agents stray outside their commit (separate bead for maw)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T23:07:58.379567508Z","created_by":"bob","updated_at":"2026-02-04T23:28:13.162623610Z","closed_at":"2026-02-04T23:28:13.162596218Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-3jh","title":"Proposal: Explicit tool discovery in AGENTS.md","description":"See notes/proposals/tool-discovery.md\n\nCreate the proposal doc with:\n- Status: PROPOSAL header\n- Proposed design for making tool discovery explicit\n- Answered questions from existing investigation\n- Remaining open questions\n\nAcceptance criteria: proposal doc exists with proper structure.","status":"closed","priority":4,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-05T16:41:13.908630095Z","created_by":"botbox-dev","updated_at":"2026-02-05T20:54:16.009206799Z","closed_at":"2026-02-05T20:54:16.009172454Z","close_reason":"Proposal doc created at notes/proposals/tool-discovery.md","source_repo":".","compaction_level":0,"original_size":0,"labels":["proposal"]}
{"id":"bd-3jw","title":"crit reviews create: add --workspace flag","description":"Add --workspace <path> flag to crit reviews create that stores the workspace absolute path in review metadata (the existing workspace: null field). Reviewers need this to know where to read source files — the diff shows relative paths but the actual files live in .workspaces/$WS/, not the project root. This was the #1 friction point in multi-agent run 1: the reviewer read from project root 4+ times before finding the workspace path buried in bead comments.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-02-02T00:44:31.434581943Z","created_by":"bob","updated_at":"2026-02-02T00:45:20.346959412Z","closed_at":"2026-02-02T00:45:20.346926961Z","close_reason":"Filed in botcrit as bd-1ck","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-3k9","title":"E2E: doctor healthy vs broken","description":"Test 6 from testing.md — init then break things, verify doctor catches each issue","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T18:39:18.876885248Z","created_by":"bob","updated_at":"2026-01-29T18:42:48.499296840Z","closed_at":"2026-01-29T18:42:48.499283646Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3k9","depends_on_id":"bd-1ws","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-3ks","title":"Guard updateManagedSection against corrupt markers","description":"updateManagedSection in templates.mjs can corrupt files when markers are out of order (endIdx < startIdx) or only one marker exists. Add guards: if endIdx < startIdx, treat as missing. If only one marker present, treat as missing. Add tests for these edge cases.","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-29T17:33:13.837922358Z","created_by":"bob","updated_at":"2026-01-29T17:34:08.864216426Z","closed_at":"2026-01-29T17:34:08.864187783Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"labels":["must-fix","review-finding"]}
{"id":"bd-3lp","title":"Add migration system to botbox sync","description":"Support versioned migrations during sync - 'if version < X, run migration Y'.\n\nSimilar to Rails migrations, database schema migrations, etc. Allows gradual upgrades:\n- Track .botbox.json version\n- Define migrations: cleanupBashScripts, addIterationContext, etc.\n- Run pending migrations during sync\n- Update version after success\n\nExample use cases:\n- Version < 1.1.0: Remove old .sh scripts, add .mjs scripts\n- Version < 1.2.0: Add .agents/botbox/ directory structure\n- Version < 1.3.0: Update hook format\n\nBenefits:\n- Graceful upgrades without manual intervention\n- Projects stay current automatically\n- Clear upgrade path documentation","status":"closed","priority":3,"issue_type":"feature","owner":"botbox-dev","created_at":"2026-02-03T15:33:05.184380291Z","created_by":"botbox-dev","updated_at":"2026-02-03T16:08:51.831398903Z","closed_at":"2026-02-03T16:08:51.831372754Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli","migrations","sync"],"dependencies":[{"issue_id":"bd-3lp","depends_on_id":"bd-1e3","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-3lp","depends_on_id":"bd-2e7","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-3lp","depends_on_id":"bd-3nz","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-3lp","depends_on_id":"bd-xmx","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":112,"issue_id":"bd-3lp","author":"1","text":"Added migration system plan doc at notes/migration-system.md. It covers registry format, version tracking via .botbox.json, sync execution flow, safety, and tests. Research complete.","created_at":"2026-02-03T15:46:33Z"},{"id":113,"issue_id":"bd-3lp","author":"1","text":"Implemented migration registry and sync wiring with initial scripts-move migration; init now uses latest migration version. Updated sync test to assert config version after migration. Plan doc remains in notes/migration-system.md.","created_at":"2026-02-03T16:08:47Z"}]}
{"id":"bd-3lq","title":"Auto-resolve workspace conflicts for excluded paths (.beads/, .crit/)","description":"## Problem\n\nAgents using maw workspaces frequently hit merge conflicts in `.beads/` and `.crit/` directories. These directories contain:\n- `.beads/issues.jsonl` - issue tracker state (changes on main when any agent closes a bead)\n- `.crit/events.jsonl` - code review events (changes when reviews are created/voted on)\n\n**What happens:**\n1. Agent creates workspace, starts working on a task\n2. While working, another agent (or the same agent in a previous iteration) closes a bead or votes on a review\n3. Main now has different .beads/ or .crit/ content than the workspace base\n4. `maw ws merge` creates a merge commit with conflicts\n5. Agent must manually resolve with `jj restore --from main .beads/`, `jj squash`, cleanup orphaned commits, etc.\n\n**Observed in botcrit-dev sessions:**\n- `jj squash` timing out during conflict resolution\n- Divergent commits (xozysqup/0, xozysqup/1) accumulating\n- Agents abandoning 8+ orphaned commits to clean up\n- Agents giving up on proper merge and reapplying changes manually on main\n\n**Root cause:** These paths are \"workspace-independent\" - they track project-wide state, not the code changes the agent is making. They should never conflict because the workspace shouldn't be modifying them.\n\n## Proposed Solution\n\nAdd configurable \"excluded paths\" that `maw ws merge` auto-resolves from main (or excludes entirely from workspaces via jj sparse when that feature lands).\n\n### Configuration Options (pick one or combine):\n\n**Option A: .mawignore file** (like .gitignore)\n```\n# .mawignore - paths to exclude from workspace conflicts\n.beads/\n.crit/\n```\nSimple, familiar pattern. Auto-resolve these from main on merge.\n\n**Option B: .maw.toml config**\n```toml\n[workspace]\n# Paths to auto-resolve from main on merge conflicts\nauto_resolve_from_main = [\".beads/\", \".crit/\"]\n\n# Future: when jj sparse v2 lands, exclude entirely\n# exclude_from_workspaces = [\".beads/\", \".crit/\"]\n```\nMore structured, room for other workspace config.\n\n**Option C: Hardcoded defaults + config override**\nmaw knows about beads/crit integration. Default to auto-resolving .beads/ and .crit/, allow override in config.\n\n### Implementation\n\nIn `maw ws merge`:\n1. Detect if merge creates conflicts\n2. Check if conflicted paths are in the exclude list\n3. For excluded paths: `jj restore --from main <path>`\n4. Continue with merge\n\nFuture enhancement: When jj sparse v2 adds --exclude, use that on `ws create` to never include these paths in workspaces.\n\n## Testing\n\n1. Create workspace, make code changes\n2. Close a bead on main (simulating concurrent agent work)\n3. `maw ws merge` should auto-resolve .beads/ conflict\n4. Merge succeeds without manual intervention","status":"closed","priority":1,"issue_type":"task","owner":"maw-dev","created_at":"2026-02-03T23:53:31.510669394Z","created_by":"botbox-dev","updated_at":"2026-02-04T00:25:26.227643355Z","closed_at":"2026-02-04T00:25:26.165398278Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":114,"issue_id":"bd-3lq","author":"botbox-dev","text":"Addressed in maw 0.19.0","created_at":"2026-02-04T00:25:26Z"}]}
{"id":"bd-3ls","title":"Add project-type-conditional design docs to botbox init","description":"When botbox init asks for project type (cli, tui, api, library), copy relevant design guideline docs to .agents/botbox/design/. Source from packages/cli/docs/design/. Examples: CLI design conventions for cli/tui projects, API design conventions for api projects. Uses same bundled doc mechanism as workflow docs, managed by botbox sync. Source material in ~/src/ai-docs.","status":"closed","priority":4,"issue_type":"task","created_at":"2026-01-30T18:11:15.002573428Z","created_by":"bob","updated_at":"2026-02-04T18:45:36.007297406Z","closed_at":"2026-02-04T18:45:36.007266518Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":115,"issue_id":"bd-3ls","author":"botbox-dev","text":"Near-term need identified: CLI conventions doc for bob's current project.\n\nRevised scope - start small:\n1. Create packages/cli/docs/design/cli-conventions.md with CLI design guidelines\n2. Modify init to copy design docs based on project type\n3. Add to sync for updates\n\nSource material: ~/src/ai-docs (exists, has tools/ and design/ dirs)\n\nProject type mapping:\n- cli, tui → cli-conventions.md\n- api → api-conventions.md (future)\n- library → library-conventions.md (future)\n\nStart with CLI conventions only since that's the immediate need. Expand design docs as content is created.","created_at":"2026-02-04T18:07:44Z"}]}
{"id":"bd-3m6","title":"crit reviews list: add --status filter","description":"Add --status <open|merged|abandoned> filter to crit reviews list. Currently reviewers must parse JSON client-side to find open reviews. Server-side filtering simplifies the reviewer loop and avoids processing merged/abandoned reviews.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-02-02T00:44:33.289657752Z","created_by":"bob","updated_at":"2026-02-02T00:45:20.394667588Z","closed_at":"2026-02-02T00:45:20.394643343Z","close_reason":"Filed in botcrit as bd-26k","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-3me","title":"Track jj baseline in dev-loop for release decisions","description":"At start of dev-loop iteration, capture jj state (commits on main since origin). At end of iteration, show what landed since baseline. This helps agents:\n1. Know what actually shipped (not just what they think they did)\n2. Make informed release decisions (user-visible changes warrant release)\n3. Write accurate release notes\n\nImplementation in dev-loop.mjs:\n- Start: capture `jj log -r 'main@origin..main'` as baseline\n- End: show commits since baseline, prompt agent about release if any are user-visible","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-04T15:02:00.938337115Z","created_by":"botbox-dev","updated_at":"2026-02-04T15:36:51.514819976Z","closed_at":"2026-02-04T15:36:51.514780422Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-3n4l","title":"E10v2: Add friction scoring and fix verify script","description":"## Summary\n\nExtend the E10 Full Lifecycle eval with automated friction scoring as a first-class metric alongside workflow compliance, and fix verify script false positives. E10v2 keeps the same controlled sequential `claude -p` architecture — it measures \"can agents use the tools correctly and efficiently?\"\n\n## Motivation\n\nE10-1 scored 158/160 (99%) and E10-2 scored 159/160 (99%), but E10-2's tool friction analysis revealed **~61 wasted tool calls** across phases 4-8 — mostly from crit's `--path` requirement and a stale workspace cascade. The high workflow compliance score masks significant agent confusion that we want to detect, quantify, and track across runs.\n\n## What Changes from E10\n\n### 1. Friction scoring (new, ~40 pts)\n\nAutomated extraction from phase stdout logs. Deductions for:\n\n- `Exit code 1` / `Exit code 2` on tool commands (agent sent wrong flags/args)\n- `Sibling tool call errored` lines (parallel calls cancelled by a sibling failure)\n- `--help` lookups mid-phase (agent didn't know the CLI)\n- Retries of the same command with different flags (e.g., adding `--path`)\n- `FALLBACK:` lines in orchestrator output (discovery workarounds)\n\nScoring approach options:\n- (a) Start at 40 pts, deduct per wasted call (e.g., -1 per failure, -0.5 per sibling cancellation)\n- (b) Tiered: 40 = 0 friction, 30 = 1-5 failures, 20 = 6-15, 10 = 16-30, 0 = 31+\n- (c) Per-phase friction budget (e.g., 5 pts per phase, deduct for failures in that phase)\n\nThe proposal should evaluate these options and pick one.\n\n### 2. Verify script fixes (3 false positives from E10-2)\n\n- **api_secret check**: Current grep is too loose — matches struct field definitions, not just handler responses. Should check that no `async fn` handler returns a JSON response containing `api_secret`, not just that `api_secret` appears within 5 lines of `async fn`.\n- **Review exists check**: Should use the same FALLBACK grep pattern as the phase scripts (search stdout logs for `cr-XXXX`) when `crit reviews list --all-workspaces` fails.\n- **Review marked as merged check**: Same — grep phase8 stdout for \"status: merged\" when crit query fails.\n\n### 3. Friction extraction script (new)\n\nA new script (e.g., `e10-friction.sh`) that parses all phase stdout logs and outputs a structured friction report: per-phase failure counts, sibling cancellations, --help lookups, total wasted calls, friction score.\n\n### 4. Updated rubric (200 pts total)\n\nCurrent E10 rubric: 160 pts across 10 categories.\nE10v2: 200 pts = 160 workflow compliance + 40 friction efficiency.\n\nPass threshold: >= 140/200 (70%). Excellent: >= 180/200 (90%).\n\n## What Stays the Same\n\n- Same 2-project (Alpha + Beta), 3-agent, 8-phase architecture\n- Same planted defects (beta validate_email, alpha /debug)\n- Same sequential `claude -p` invocations with hand-crafted prompts\n- Same setup script (e10-setup.sh)\n- Same phase scripts (may need minor updates for new crit version)\n- Same workflow compliance rubric (160 pts)\n\n## Reference Files\n\n### Existing E10 infrastructure\n- `evals/scripts/e10-setup.sh` — Setup script (creates eval environment)\n- `evals/scripts/e10-run.sh` — Orchestrator (runs all phases)\n- `evals/scripts/e10-phase{1-8}.sh` — Individual phase scripts\n- `evals/scripts/e10-phase4_5.sh` — Automated hook verification\n- `evals/scripts/e10-verify.sh` — Post-run verification (has the 3 false positives)\n\n### Rubric and framework\n- `evals/rubrics.md` — E10 rubric section (lines ~1182-1325), plus all other eval rubrics\n- `notes/eval-framework.md` — Running instructions, phase descriptions, scoring guide, report template\n\n### Previous run reports (scoring reference)\n- `evals/results/2026-02-06-e10-run1-opus.md` — E10-1: 158/160, first clean run\n- `evals/results/2026-02-07-e10-run2-opus.md` — E10-2: 159/160, includes tool friction analysis section with per-phase breakdown, ~61 wasted calls\n- `evals/results/README.md` — All runs table and key learnings\n\n### Tool friction evidence (from E10-2 report)\n- crit `--path` missing: 5 occurrences, ~34 wasted calls (phases 4, 5, 6, 7, 8)\n- Stale workspace cascade: ~18 wasted calls (phase 5) + divergent commit (phase 6)\n- `jj tag create` vs `set`: ~3 wasted calls (phase 8)\n- `crit reviews create --title`: ~2 wasted calls (phase 4)\n\n### Related beads\n- bd-358v: crit auto-search workspace .crit/ dirs (botbox bead)\n- bd-1bs: Same feature filed in botcrit repo\n- bd-1jz7: Docs fix for jj tag set and crit --title\n\n## Deliverables\n\n1. Proposal doc: `notes/proposals/e10v2-friction-scoring.md`\n2. New script: `evals/scripts/e10-friction.sh` (automated friction extraction)\n3. Updated: `evals/scripts/e10-verify.sh` (fix 3 false positives)\n4. Updated: `evals/rubrics.md` (add friction scoring section to E10)\n5. Updated: `notes/eval-framework.md` (document friction metric)\n6. First E10v2 run with friction score","status":"in_progress","priority":4,"issue_type":"feature","owner":"botbox-dev","created_at":"2026-02-07T03:34:21.896712562Z","created_by":"botbox-dev","updated_at":"2026-02-09T18:28:37.474655236Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["eval","proposal"],"dependencies":[{"issue_id":"bd-3n4l","depends_on_id":"bd-2dyi","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":116,"issue_id":"bd-3n4l","author":"botbox-dev","text":"Deferred: waiting for maw v2 migration (workspace paths, maw exec, eval commands all changing). Will undefer after maw v2 migration bead is complete.","created_at":"2026-02-07T23:22:50Z"},{"id":162,"issue_id":"bd-3n4l","author":"botbox-dev","text":"Blocker bd-2dyi (maw v2 migration) is now closed. Eval scripts will need updating for v2 patterns: maw exec default -- br/bv, maw exec $WS -- crit, ws/ paths instead of .workspaces/. Ready to undefer when picked up.","created_at":"2026-02-08T20:43:39Z"},{"id":172,"issue_id":"bd-3n4l","author":"botbox-dev","text":"## Deep eval audit (2026-02-09) — Post maw v2 migration\n\nComprehensive review of E10 infrastructure against current tool state. Major findings:\n\n### 1. CRITICAL: All E10 scripts use stale maw v1 paths\n\nEvery phase script computes `WS_PATH=\"$ALPHA_DIR/.workspaces/$WS\"` — this is the deprecated v1 layout. Current maw v2 uses `ws/<name>/`. Affected files:\n- e10-setup.sh (creates `.workspaces/` symlink)\n- e10-phase1.sh, e10-phase4.sh, e10-phase5.sh, e10-phase6.sh, e10-phase7.sh (all WS_PATH construction)\n\n**Fix**: All `.workspaces/$WS` → `ws/$WS`. Setup script needs `maw init` with v2 layout (no `.workspaces/` symlink). Phase scripts should consistently use `maw exec <ws> -- <cmd>` pattern.\n\n### 2. crit `--path` friction — mitigation changed\n\nThe crit auto-search feature (bd-358v/bd-1bs) has NOT shipped. But the primary mitigation is now `maw exec <ws> -- crit ...` which sets cwd correctly so `--path` is unnecessary. Phase prompts should instruct agents to use `maw exec <ws> -- crit` pattern throughout, not bare `crit` commands.\n\nThe E10v2 friction scoring should specifically track:\n- Bare `crit` calls without `maw exec` context (v2 compliance)  \n- Bare `br`/`bv` calls without `maw exec default --` (v2 compliance)\n\n### 3. Doc fixes already done (bd-1jz7 CLOSED)\n\n`jj tag set` (not `create`) and `crit reviews create --title` are already documented. Remove from \"What Changes\" section — these are no longer open issues.\n\n### 4. Verify script false positives — still relevant but paths need updating\n\nThe 3 false positives (api_secret check, review exists check, mark-merged check) are still valid issues. However:\n- All verify script workspace path references need `.workspaces/` → `ws/` update\n- The mark-merged event loss (workspace destroyed before event syncs) is still a real bug in crit\n\n### 5. Bead description updates needed\n\nThe bead description is largely accurate but needs:\n- Remove bd-1jz7 reference from deliverables (already done)\n- Add \"update all scripts for maw v2 paths\" to deliverables\n- Note that `maw exec` is the primary crit `--path` mitigation now\n- Update \"What Stays the Same\" — phase scripts WILL need updates for v2 paths (not \"minor updates\")\n- Add v2 compliance as a friction category (agents using bare tool calls vs `maw exec`)\n\n### 6. Dependency bd-2dyi is closed — no blockers remain\n\nThe maw v2 migration blocker is resolved. This bead is clear to work.\n\n### Summary of scope for E10v2\n\nOriginal scope (still valid):\n1. Friction scoring script + rubric extension (40 pts)\n2. Verify script false positive fixes (3 items)\n\nNew scope (from v2 migration):\n3. Update ALL e10-*.sh scripts for maw v2 paths (`ws/` not `.workspaces/`)\n4. Update phase prompts to use `maw exec` pattern consistently\n5. Update setup script for v2 layout\n6. Add v2 compliance as a friction deduction category","created_at":"2026-02-09T18:02:22Z"},{"id":173,"issue_id":"bd-3n4l","author":"botbox-dev","text":"Implementation complete. 14 files changed (503+/205-):\n\n1. **e10-setup.sh**: Restructured for v2 — create files before botbox init (which calls maw init → bare repo). Fixed symlink: ws/beta → beta/ws/default. Removed redundant crit init/maw init. br create uses maw exec default.\n\n2. **All 8 phase prompts**: Updated to use maw exec patterns throughout: maw exec default -- br, maw exec $WS -- crit/jj/cargo. Fixed beta source path to ws/default/src/lib.rs. All .workspaces/ → ws/. Deprecated maw ws jj → maw exec $WS -- jj.\n\n3. **Phase orchestration code**: Fixed maw ws list JSON parsing for v2 envelope format (.workspaces[]). WS_PATH now computed as ws/$WS. All crit fallbacks use maw exec.\n\n4. **Phase 8 mark-merged fix**: Reordered to merge workspace FIRST, then mark-merged from default workspace — fixes the event-loss bug where mark-merged was written to workspace .crit/ then destroyed.\n\n5. **e10-verify.sh fixes**: (a) api_secret check now looks for json! macro usage, not just field existence; (b) review exists check falls back to phase4 stdout grep; (c) mark-merged check falls back to phase8 stdout grep. All paths → ws/default/. All tool commands → maw exec.\n\n6. **NEW: e10-friction.sh**: Automated friction scoring — parses phase stdout logs for exit failures, sibling cancellations, --help lookups, retries. Tiered scoring (40/30/20/10/0). Produces per-phase breakdown and structured .env report.\n\n7. **Rubrics**: Added Friction Efficiency section (40 pts). Total: 160→200. Pass: 140/200 (70%). Excellent: 180/200 (90%). Fixed jj tag create→set, crit --path→maw exec.\n\n8. **Eval framework**: Updated scoring (200 pts), added friction section, fixed post-mortem commands for v2.","created_at":"2026-02-09T18:28:37Z"}]}
{"id":"bd-3ni","title":"Add bead title to other announcement docs","description":"Update start.md, finish.md, and update.md announcement templates to include bead titles where they mention Working/Completed messages.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T22:34:39.421858727Z","created_by":"bob","updated_at":"2026-02-01T22:45:20.417399074Z","closed_at":"2026-02-01T22:45:20.417380859Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":117,"issue_id":"bd-3ni","author":"Bob","text":"Updated start.md and finish.md announcement templates to include bead titles; update.md uses status format so no matching Working/Completed template.","created_at":"2026-02-01T22:45:15Z"}]}
{"id":"bd-3nz","title":"Research migration patterns","description":"Collect migration system patterns from similar tools (e.g., Rails, Django, Flyway) and summarize practices relevant to botbox sync migrations.","status":"closed","priority":3,"issue_type":"task","owner":"1","created_at":"2026-02-03T15:43:07.107865079Z","created_by":"1","updated_at":"2026-02-03T15:45:14.140365725Z","closed_at":"2026-02-03T15:45:14.140339696Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":118,"issue_id":"bd-3nz","author":"1","text":"Started in workspace botbox (/home/bob/src/botbox). Will gather migration system patterns from similar tools and summarize key practices for botbox sync.","created_at":"2026-02-03T15:43:25Z"},{"id":119,"issue_id":"bd-3nz","author":"1","text":"Collected migration patterns: migrations stored in VCS with explicit ordering (timestamp/graph), apply/rollback commands, reversible vs up/down for non-reversible ops, dependency graphs for ordering, and atomic execution when possible. Will use these concepts in botbox sync migration plan.","created_at":"2026-02-03T15:45:10Z"}]}
{"id":"bd-3og","title":"Design cross-project @mention notification system","description":"what i'm thinking:\n- maw-dev posts in #botcrit about a bug\n- a hook fires, launching dev-loop for crit-dev\n- crit-dev releases fix and tags @maw-dev in #botcrit\n- this should somehow notify @maw-dev, maybe fire a light version of the dev loop in case they need to implement something...\n- we should _not_ double-fire hooks if someone mentions @maw-dev in #maw","status":"closed","priority":3,"issue_type":"story","created_at":"2026-02-04T14:02:15.940413737Z","created_by":"bob","updated_at":"2026-02-04T21:31:21.884592403Z","closed_at":"2026-02-04T21:31:21.884550434Z","close_reason":"Design complete - implementation covered by bd-1w7 (respond.mjs)","source_repo":".","compaction_level":0,"original_size":0,"labels":["question"],"comments":[{"id":120,"issue_id":"bd-3og","author":"botbox-dev","text":"Design decision: Keep hooks simple, let spawned agent decide response intensity.\n\nImplementation approach:\n- dev-loop.mjs checks if triggered via foreign channel mention\n- Foreign channel = channel != project channel (e.g., maw-dev triggered from #botcrit)\n- Light response for foreign mentions: ack message + optionally create tracking bead\n- Full triage loop only for home channel triggers\n\nDetection: hook passes channel info to script, script compares against BOTBOX_PROJECT channel.\n\nNo hook system changes needed - just script-level logic.","created_at":"2026-02-04T18:07:37Z"},{"id":121,"issue_id":"bd-3og","author":"botbox-dev","text":"Connection to bd-1w7 design:\n\nCross-project @mentions should also be conversational. When crit-dev mentions @maw-dev in #botcrit:\n- maw-dev spawns in conversational mode\n- Responds to the mention\n- Calls 'bus wait' for potential follow-up\n- Times out and exits if no continuation\n\nThis is lighter than dev-loop (no bead, no workspace) but still interactive.\n\nSame pattern as q: questions - mentions expect dialogue, bare posts expect work.","created_at":"2026-02-04T18:19:32Z"},{"id":122,"issue_id":"bd-3og","author":"botbox-dev","text":"Design assessment: This is already implemented!\n\nThe cross-project @mention system works as designed via respond.mjs (landed with bd-1w7):\n\n1. maw-dev posts in #botcrit about a bug\n2. crit-dev (spawned separately) fixes it  \n3. crit-dev @mentions @maw-dev in #botcrit\n4. mention_received hook fires, spawning respond.mjs for maw-dev\n5. maw-dev's respond.mjs reads BOTBUS_CHANNEL=#botcrit, responds there\n6. Conversation continues via bus wait\n\nThe double-fire concern is moot:\n- claim_available hooks fire when agent identity becomes claimable (work dispatch)\n- mention_received hooks fire when @mentioned (conversational)\n\nThese are separate concerns - one for 'check for work' and one for 'someone wants to talk'.\n\nClosing as design-complete. No additional implementation needed.","created_at":"2026-02-04T21:31:18Z"}]}
{"id":"bd-3om","title":"Bundle Claude Code hooks and write project-level .claude/settings.json during botbox init","description":"Currently the botbus-workflow hooks (init-agent.sh, check-bus-inbox.sh) live in ~/.claude/hooks/ and are hand-managed globally. They should be bundled in packages/cli/hooks/, copied during botbox init, and wired into a project-level .claude/settings.json so they only activate in botbox projects.\n\nHooks to bundle:\n- init-agent.sh (SessionStart) — calls bus whoami to get agent identity\n- check-bus-inbox.sh (PostToolUse) — polls bus inbox and injects reminder for unread messages\n\nAcceptance criteria:\n- packages/cli/hooks/ contains bundled hook scripts\n- botbox init writes .claude/settings.json with hooks config pointing to copied scripts\n- botbox sync updates hook scripts (same version marker pattern as docs/scripts)\n- botbox doctor checks hook script staleness\n- Hooks only run in botbox-initialized projects (not globally)","status":"closed","priority":3,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-02T20:02:30.371414263Z","created_by":"botbox-dev","updated_at":"2026-02-04T17:07:46.971723922Z","closed_at":"2026-02-04T17:07:46.971690560Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli"],"comments":[{"id":123,"issue_id":"bd-3om","author":"botbox-dev","text":"Started in workspace bd-3om (/home/bob/src/botbox/.workspaces/bd-3om). Will:\n1. Create packages/cli/hooks/ with init-agent.sh and check-bus-inbox.sh\n2. Create lib/hooks.mjs for hook management\n3. Update init.mjs to write .claude/settings.json\n4. Update sync.mjs to sync hooks\n5. Update doctor.mjs to check hook staleness","created_at":"2026-02-04T17:04:55Z"}]}
{"id":"bd-3ov","title":"Read version from package.json instead of hardcoding","description":"Version 0.0.1 is duplicated in package.json and index.mjs. Read version from package.json dynamically so they cannot drift.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-29T17:33:14.911378604Z","created_by":"bob","updated_at":"2026-01-29T17:36:31.813475289Z","closed_at":"2026-01-29T17:36:31.813460010Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"labels":["review-finding","should-fix"]}
{"id":"bd-3rmj","title":"E10: Write run-all orchestrator script","description":"# Context\n\nA top-level orchestrator script that runs all E10 phases in sequence, providing a single entry point for the full eval.\n\n# Goals\n\n- Create `evals/scripts/e10-run.sh`\n- Runs setup → phases 1-8 → verify in sequence\n- Handles errors gracefully (continues on phase failure, reports which phases failed)\n- Prints summary at end\n\n# Background\n\nExisting multi-phase evals (R4, R7) have separate phase scripts but no single orchestrator. E10 should have one for convenience.\n\n# Implementation Approach\n\n## Orchestration Logic\n\nThe setup script prints EVAL_DIR to stdout. The orchestrator captures it:\n\n```bash\n#!/usr/bin/env bash\nset -euo pipefail\n\nSCRIPT_DIR=\"$(cd \"$(dirname \"$0\")\" && pwd)\"\n\necho \"=== E10 Full Lifecycle Eval ===\"\necho \"Starting at $(date)\"\n\n# Phase 0: Setup — capture EVAL_DIR from output\nSETUP_OUTPUT=$(\"$SCRIPT_DIR/e10-setup.sh\" 2>&1)\necho \"$SETUP_OUTPUT\"\nEVAL_DIR=$(echo \"$SETUP_OUTPUT\" | grep -oP 'EVAL_DIR=\\K.*' | head -1)\nif [[ -z \"$EVAL_DIR\" || ! -f \"$EVAL_DIR/.eval-env\" ]]; then\n  echo \"FATAL: Setup failed — could not find .eval-env\"\n  exit 1\nfi\n\nEVAL_ENV=\"$EVAL_DIR/.eval-env\"\n\nFAILED=()\nfor phase in phase1 phase2 phase3 phase4 phase4_5 phase5 phase6 phase7 phase8; do\n  echo \"\"\n  echo \"--- Running $phase ---\"\n  if \"$SCRIPT_DIR/e10-$phase.sh\" \"$EVAL_ENV\"; then\n    echo \"--- $phase: OK ---\"\n  else\n    echo \"--- $phase: FAILED (exit $?) ---\"\n    FAILED+=(\"$phase\")\n  fi\ndone\n\necho \"\"\necho \"--- Running verify ---\"\n\"$SCRIPT_DIR/e10-verify.sh\" \"$EVAL_ENV\"\n\necho \"\"\necho \"=== E10 Complete ===\"\necho \"Failures: ${FAILED[*]:-none}\"\necho \"Artifacts: $EVAL_DIR/artifacts/\"\necho \"EVAL_DIR=$EVAL_DIR\"\n```\n\n## Files to Create\n\n- `evals/scripts/e10-run.sh`\n\n## Acceptance Criteria\n\n- [ ] Captures EVAL_DIR from setup script output\n- [ ] Validates .eval-env exists before proceeding\n- [ ] Runs all phases in sequence\n- [ ] Reports failures without aborting remaining phases\n- [ ] Prints summary with failure list and artifact path\n- [ ] Single entry point for the full eval","status":"closed","priority":3,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-06T20:48:29.127876862Z","created_by":"botbox-dev","updated_at":"2026-02-06T21:07:58.302173446Z","closed_at":"2026-02-06T21:07:58.302149121Z","close_reason":"Orchestrator script written: evals/scripts/e10-run.sh","source_repo":".","compaction_level":0,"original_size":0,"labels":["e10"],"dependencies":[{"issue_id":"bd-3rmj","depends_on_id":"bd-w2n8","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":124,"issue_id":"bd-3rmj","author":"botbox-dev","text":"Review: Fixed broken EVAL_ENV discovery glob. Now captures EVAL_DIR from setup stdout output using grep, with validation.","created_at":"2026-02-06T20:54:43Z"}]}
{"id":"bd-3s6","title":"Publish placeholder packages to npm","description":"Publish @botbox/cli and botbox to npm as 0.0.1 placeholders to reserve the names. Use just publish.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T17:22:46.887132725Z","created_by":"bob","updated_at":"2026-01-29T19:39:20.177575437Z","closed_at":"2026-01-29T19:39:20.177548256Z","close_reason":"done by bob","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-3sh","title":"Test cass_memory_system (cm) hands-on","description":"Actually install and test cm with real use cases:\n1. Install cass and cm\n2. Index sessions\n3. Try cm context with real botbox tasks\n4. Try searching past sessions for solved problems\n5. Test the playbook/rules workflow\n6. Evaluate practical value\n\nReport findings with concrete examples.","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-05T14:31:05.673941485Z","created_by":"botbox-dev","updated_at":"2026-02-05T14:33:30.934724413Z","closed_at":"2026-02-05T14:33:30.934691682Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":125,"issue_id":"bd-3sh","author":"botbox-dev","text":"## Test Results\n\n### Setup\n- Installed cass 0.1.64 and cm 0.2.3\n- Indexed 1,620 conversations with 64,204 messages across 4 agents (Claude Code 1511, OpenCode 102, Gemini 4, Codex 3)\n\n### Session Search (cass) - WORKS WELL\nTested queries:\n- 'botbox sync migration' - found detailed migration design discussions\n- 'jj divergent commit' - found exact fix instructions and documentation\n- 'beads crash recovery' - found R9 eval design and CLAUDE.md updates\n\nThe expand command shows full context around search hits, enabling understanding of how problems were solved.\n\n### Playbook (cm) - WORKS AS ADVERTISED\n- Added manual rule, showed up in context with relevance scoring\n- Feedback system works - mark helpful increased score from 0 to 0.5\n- Gap analysis identified missing categories\n- Onboarding samples sessions for rule extraction\n\n### Practical Value Assessment\nHIGH VALUE:\n- Session search across 1,620 conversations is genuinely useful\n- 'How did I solve X last week?' is now answerable\n- Context expansion shows full reasoning, not just snippets\n\nMEDIUM VALUE:\n- Rule management and effectiveness tracking work\n- Gap analysis helps identify missing knowledge areas\n\nNEEDS MORE TESTING:\n- Auto-extraction via LLM reflection (requires API key)\n- Long-term decay and maturity progression","created_at":"2026-02-05T14:33:30Z"}]}
{"id":"bd-3sy","title":"R9: Recovery eval — mid-run failure simulation","description":"Simulate failures during agent execution and test recovery: (1) worker crashes mid-task (workspace exists but work is incomplete), (2) reviewer times out (review requested but never completed), (3) botbus message lost (claim exists but no announcement), (4) crit index corruption (vote recorded but not queryable). Tests whether the dev agent recovers gracefully on next iteration — detects stale state, retries or reassigns, doesn't duplicate work. Scoring: detection of stale state, correct recovery action, no data loss.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-31T23:42:36.800127904Z","created_by":"bob","updated_at":"2026-02-02T14:15:12.070383240Z","closed_at":"2026-02-02T14:15:12.070355027Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"labels":["eval"],"comments":[{"id":126,"issue_id":"bd-3sy","author":"Bob","text":"R8 informs R9 design: The CLAUDE.md bead tracking requirements (progress comments with 'what was done, what remains') are exactly what R9 needs to validate. Test scenario: agent completes 2 of 5 subtasks, session crashes, fresh session reads bead comments and resumes at subtask 3 without redoing work or losing context. Score: (1) reads bead comments before acting, (2) correctly identifies completed vs remaining work, (3) doesn't duplicate completed subtasks.","created_at":"2026-02-01T19:43:56Z"},{"id":127,"issue_id":"bd-3sy","author":"Bob","text":"R9-1 complete: Opus 69/70 (99%). Perfect crash recovery — detected claims, read bead comments, completed S3 in existing workspace without redoing S1/S2, finished S4+S5. All code compiles, all beads closed.","created_at":"2026-02-02T14:15:12Z"}]}
{"id":"bd-3u9","title":"Add --actor to all br commands in workflow docs and scripts","description":"## Problem\n\nAll mutating br commands (create, update, close, comments add, dep add) support --actor <name> for the audit trail, but our workflow docs and scripts don't use it. This means all bead mutations are attributed to the OS username (bob) instead of the agent identity. Same issue with --owner on br create.\n\n## What to change\n\n### Workflow docs (packages/cli/docs/*.md)\n\nEvery br command in the docs should include --actor \\$AGENT:\n- br create --actor \\$AGENT --owner \\$AGENT ...\n- br update --actor \\$AGENT <id> ...\n- br close --actor \\$AGENT <id> ...\n- br comments add --actor \\$AGENT <id> \"...\"\n- br dep add --actor \\$AGENT ...\n\n### Scripts (scripts/*.sh)\n\nThe inner prompts in agent-loop.sh, dev-loop.sh, and reviewer-loop.sh reference br commands. These should also include --actor \\$AGENT (where \\$AGENT is the agent's botbus identity).\n\n### CLAUDE.md\n\nThe Beads section references br commands — update those too.\n\n## Notes\n\n- --actor is available on all mutating br commands (create, update, close, comments add, dep add, dep remove)\n- --owner on br create sets the owner field (distinct from actor which is the audit trail)\n- For br create, use both: br create --actor \\$AGENT --owner \\$AGENT ...\n- br comments add also has --author which overrides the comment author (distinct from --actor)\n- For br comments add, use both: br comments add --actor \\$AGENT --author \\$AGENT <id> \"...\"\n- Read-only commands (br show, br ready, br sync) don't need --actor\n\n## Acceptance criteria\n\n- All br create commands in docs include --actor \\$AGENT --owner \\$AGENT\n- All br update/close commands include --actor \\$AGENT\n- All br comments add commands include --actor \\$AGENT --author \\$AGENT\n- All br dep add/remove commands include --actor \\$AGENT\n- Scripts' inner prompts updated\n- CLAUDE.md bead section updated","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-02T16:20:53.464733551Z","created_by":"bob","updated_at":"2026-02-02T16:28:10.050766200Z","closed_at":"2026-02-02T16:28:10.050738017Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":128,"issue_id":"bd-3u9","author":"Bob","text":"Starting: updating all workflow docs, scripts, and CLAUDE.md","created_at":"2026-02-02T16:20:57Z"},{"id":129,"issue_id":"bd-3u9","author":"botbox-dev","text":"Completed: Added --actor $AGENT to all mutating br commands across 11 files (7 workflow docs, 2 scripts, CLAUDE.md, start.md). Also added --owner $AGENT on br create, --author $AGENT on br comments add. Updated IMPORTANT instruction in agent-loop.sh and dev-loop.sh prompts. Fixed dev-loop.sh worker prompt template (was incorrectly saying --agent for br commands, now correctly says --actor). All 54 tests pass.","created_at":"2026-02-02T16:28:07Z"}]}
{"id":"bd-3uep","title":"Remove --all-workspaces from reviewer-loop, iterate workspaces via maw","description":"Decouple reviewer-loop from crit's --all-workspaces flag. Instead of relying on crit to enumerate jj workspaces (which couples crit to maw internals and breaks on stale working copies), have the reviewer-loop iterate workspaces itself via maw ws list + maw exec per workspace. Also remove all --all-workspaces mentions from botbox docs and guidance.","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-08T23:42:57.131822509Z","created_by":"botbox-dev","updated_at":"2026-02-08T23:45:36.904891112Z","closed_at":"2026-02-08T23:45:36.904865694Z","close_reason":"Removed --all-workspaces from reviewer-loop, iteration-start, prompts, docs, and AGENTS.md. reviewer-loop now iterates workspaces via maw ws list + maw exec per workspace. Errors are per-workspace so one stale ws doesn't tank the whole check.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-3uf","title":"Update hook registration for --claim-owner flag","description":"Update botbox to use botbus v0.11.0's --claim-owner flag. Changes needed:\n\n1. init.mjs registerSpawnHook(): add --claim-owner ${agent} to the bus hooks add command\n2. dev-loop.sh / agent-loop.sh / reviewer-loop.sh: remove the startup bus claims stake for agent:// claim (hook already handles it), replace with bus claims refresh\n3. check-expiring-claims.sh hook will prompt agents to refresh — verify this works end-to-end\n4. Update workflow docs if claim lifecycle instructions change\n\nRequires: botbus v0.11.0+","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-02T21:03:34.531642156Z","created_by":"botbox-dev","updated_at":"2026-02-02T21:28:59.344953449Z","closed_at":"2026-02-02T21:28:59.344926058Z","close_reason":"Completed: Updated hook registration with --claim-owner, fixed immediate exit by adding fallback to stake","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":130,"issue_id":"bd-3uf","author":"botbox-dev","text":"Progress: Updated code to use --claim-owner flag\n\nChanges made:\n1. init.mjs:318 - Added --claim-owner ${agent} to hook registration\n2. agent-loop.sh:78-82 - Changed from stake to refresh for agent:// claim\n3. dev-loop.sh:107-111 - Changed from stake to refresh for agent:// claim\n4. reviewer-loop.sh:78-82 - Changed from stake to refresh for agent:// claim\n\nVerified spawn-security-reviewer.sh doesn't need changes (manual spawn, not hook-based).\n\nWorkflow docs don't need updates - they don't document the agent:// claim lifecycle (only bead:// and workspace://).\n\nNext: Run tests, verify the changes work correctly.","created_at":"2026-02-02T21:11:26Z"},{"id":131,"issue_id":"bd-3uf","author":"botbox-dev","text":"Completed by botbox-dev\n\nAll changes implemented and tested:\n- init.mjs now passes --claim-owner to hook registration\n- Loop scripts (agent, dev, reviewer) now refresh instead of staking agent:// claim\n- All 100 tests pass\n- Bash syntax validated\n- Commit described: 0fb1fe44\n\nThe hook-based claim lifecycle now works end-to-end: hook creates claim with --claim-owner, agent refreshes at startup.","created_at":"2026-02-02T21:12:03Z"},{"id":132,"issue_id":"bd-3uf","author":"botbox-dev","text":"Also registered botbox hook with --claim-owner: hk-xpt","created_at":"2026-02-02T21:13:20Z"},{"id":133,"issue_id":"bd-3uf","author":"botbox-dev","text":"Fixed immediate exit issue: Changed from refresh-only to refresh-with-fallback\n\nThe problem: bus claims refresh requires an existing claim. When the hook spawns the script, the claim might not be visible yet to the spawned process.\n\nSolution: Try refresh first (for hook-spawned cases where claim exists), fall back to stake if refresh fails (for manual-spawned or timing issues).\n\nThis handles both hook-spawned and manual invocation gracefully.\n\nUpdated terseid hook (hk-vjc) and botbox hook (hk-xpt) with --claim-owner.","created_at":"2026-02-02T21:28:55Z"}]}
{"id":"bd-3v8l","title":"dev-loop hasWork() misses in-progress beads without assignee","description":"When the dev-loop agent claims a bead but doesn't set --owner, br list --status in_progress --assignee $AGENT returns empty. hasWork() then returns false and the loop exits prematurely — even while a review is pending. Fix: also check for bead:// claims held by this agent in hasWork(). Also reinforce the prompt to always set --owner when claiming.","status":"closed","priority":2,"issue_type":"bug","owner":"botbox-dev","created_at":"2026-02-07T03:25:51.227177961Z","created_by":"botbox-dev","updated_at":"2026-02-07T03:27:28.241238717Z","closed_at":"2026-02-07T03:27:28.241203371Z","close_reason":"Fixed hasWork() to check bead:// and workspace:// claims, added --owner=$AGENT to all br update --status=in_progress in scripts, docs, and templates","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-3vo","title":"Add role-aware reviewer prompts with template files","description":"reviewer-loop.mjs currently has a hardcoded generic prompt. Need to:\n\n1. Create prompt templates in packages/cli/prompts/ (reviewer-base.md, reviewer-security.md, etc.)\n2. Copy prompts to .agents/botbox/prompts/ during init (like workflow docs)\n3. Update reviewer-loop.mjs to load prompt based on agent role (derived from agent name or config)\n4. Use simple {{VARIABLE}} substitution (no mustache dependency)\n\nThis restores the lost security reviewer functionality from spawn-security-reviewer.sh and sets up a scalable pattern for future specialist reviewers.\n\nRelated: spawn-security-reviewer.sh was deleted in f1049ff but never translated to .mjs. The aggressive security prompt was lost.","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-03T19:01:24.779161606Z","created_by":"botbox-dev","updated_at":"2026-02-03T19:05:42.807799337Z","closed_at":"2026-02-03T19:05:42.807777176Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":134,"issue_id":"bd-3vo","author":"botbox-dev","text":"Implemented role-aware reviewer prompts:\n\n1. Created packages/cli/prompts/ with template files:\n   - reviewer.md (base/generic)\n   - reviewer-security.md (aggressive security checklist)\n\n2. Created src/lib/prompts.mjs with:\n   - copyPrompts, currentPromptsVersion, writePromptsVersionMarker (version tracking)\n   - loadPrompt with {{VARIABLE}} substitution\n   - deriveRoleFromAgentName (e.g., 'maw-security' -> 'security')\n   - getReviewerPromptName (role -> 'reviewer-security' or 'reviewer')\n\n3. Updated reviewer-loop.mjs to:\n   - Import prompts lib\n   - Load prompt based on agent role (falls back to base if specialized not found)\n   - Check project-local prompts first, then bundled\n\n4. Updated init.mjs to copy prompts during initialization\n\n5. Updated sync.mjs to:\n   - Track prompt versions like scripts\n   - Install prompts if missing, update if stale\n\n6. Fixed maw-security hook to use reviewer-loop.mjs (which now loads security prompt)","created_at":"2026-02-03T19:05:39Z"}]}
{"id":"bd-4j2","title":"Fix reviewer-loop to check inbox mentions instead of crit reviews","description":"Current problem: reviewer-loop.mjs hasWork() checks crit for open reviews. This causes the reviewer to keep looping on reviews it already voted on.\n\nFix: Change hasWork() to check inbox for unread mentions directed at this reviewer agent. This way:\n1. Reviewer spawns on mention\n2. Processes inbox mentions (review requests, re-review requests)\n3. Checks inbox again - any more unread mentions for me?\n4. If yes, loop. If no, exit and release claim.\n5. New mentions fire the hook since claim is now free.\n\nThe mention IS the signal for work, not open reviews in crit.\n\nFiles to change:\n- packages/cli/scripts/reviewer-loop.mjs - update hasWork() function\n\nTesting:\n- Create review, tag reviewer\n- Reviewer should process, vote, check inbox, exit if empty\n- Tag reviewer again for re-review\n- Hook should fire, reviewer processes, exits","status":"closed","priority":1,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-03T20:00:49.744450939Z","created_by":"botbox-dev","updated_at":"2026-02-04T00:40:08.934405439Z","closed_at":"2026-02-04T00:40:08.934379039Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":135,"issue_id":"bd-4j2","author":"botbox-dev","text":"Simpler fix: crit v0.11.0 added `crit inbox` which only shows reviews needing attention (hides voted reviews until re-requested). Updating reviewer-loop to use crit inbox instead of crit reviews list.","created_at":"2026-02-04T00:38:37Z"}]}
{"id":"bd-6gm","title":"Proposal: Surface past learnings during triage","description":"See notes/proposals/surface-past-learnings.md\n\nCreate the proposal doc with:\n- Status: PROPOSAL header\n- Proposed design for surfacing cass learnings during triage\n- Answered questions from existing investigation\n- Remaining open questions\n\nAcceptance criteria: proposal doc exists with proper structure.","status":"closed","priority":4,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-05T16:41:19.928239133Z","created_by":"botbox-dev","updated_at":"2026-02-05T20:54:17.166265688Z","closed_at":"2026-02-05T20:54:17.166231463Z","close_reason":"Proposal doc created at notes/proposals/surface-past-learnings.md","source_repo":".","compaction_level":0,"original_size":0,"labels":["proposal"]}
{"id":"bd-6qx","title":"dev loops should persist summary of previous session","description":"- every loop iteration should end with an output summary of what the agent did in the loop (pretty sure it does this now).\n- we should feed that into the context of the next iteration like \"here's what you did last time\" or something","status":"closed","priority":3,"issue_type":"feature","owner":"botbox-dev","created_at":"2026-02-03T15:19:27.601636952Z","created_by":"bob","updated_at":"2026-02-03T15:28:58.964276711Z","closed_at":"2026-02-03T15:28:58.964253618Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"labels":["dev-loop"],"comments":[{"id":136,"issue_id":"bd-6qx","author":"botbox-dev","text":"Implemented iteration context persistence:\n\nAdded to dev-loop.mjs:\n- readLastIteration() reads .agents/botbox/last-iteration.txt\n- Shows age (e.g., '15m ago', '2h ago') in prompt\n- Includes note that data may be stale\n- Agent outputs <iteration-summary>...</iteration-summary> at end\n- Summary saved for next iteration\n\nUpdated .gitignore to exclude last-iteration.txt\n\nBenefits:\n- Agent knows what it did last time (beads worked, workers dispatched, etc.)\n- Continuity between iterations without re-reading all beads/comments\n- Summary persists across agent restarts","created_at":"2026-02-03T15:28:55Z"}]}
{"id":"bd-7qq","title":"Add concise br usage guide to managed AGENTS.md section","description":"## Problem\n\nAgents frequently guess incorrectly at br commands:\n- Wrong project context (beads are project-local)\n- Missing --actor/--author flags\n- Incorrect subcommand syntax\n- Not knowing how to add labels, dependencies, block status, etc.\n\nThis is the most core part of the workflow - if agents can't manage beads correctly, everything breaks.\n\n## Solution\n\nAdd a concise \"Beads Quick Reference\" to the managed AGENTS.md section with:\n\n1. **Project context** - beads are local to each project, cd to project first\n2. **Required flags** - --actor $AGENT on mutations, --author $AGENT on comments\n3. **Common operations**:\n   - View: `br ready`, `br list`, `br show <id>`\n   - Create: `br create --actor $AGENT --owner $AGENT --title=\"...\" --type=task --priority=2`\n   - Update: `br update --actor $AGENT <id> --status=in_progress`\n   - Comments: `br comments add --actor $AGENT --author $AGENT <id> \"message\"`\n   - Close: `br close --actor $AGENT <id>`\n   - Labels: `br update --actor $AGENT <id> --labels=foo,bar`\n   - Dependencies: `br dep add --actor $AGENT <child> <parent>`\n   - Block: `br update --actor $AGENT <id> --status=blocked`\n4. **Sync**: `br sync --flush-only` at end of session\n\nKeep it concise - this goes in the managed section that every project gets.","status":"closed","priority":1,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-04T14:49:07.811620440Z","created_by":"botbox-dev","updated_at":"2026-02-04T15:31:54.715431433Z","closed_at":"2026-02-04T15:31:54.715396017Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-80l","title":"Update review-response.md: include workspace path in re-request announcement","description":"When the author re-requests review after fixing issues, the botbus announcement should include the workspace path so the reviewer knows where to find the fixed code.\n\nCurrent: botbus send ... 'Review feedback addressed: <review-id>' -L review-response\nProposed: botbus send ... 'Review feedback addressed: <review-id> — fixes in workspace <ws-name> (<ws-path>)' -L review-response\n\nThis is the prompt-level fix for the workspace visibility gap discovered in R4-1 Phase 4. The tool-level fixes are tracked in botcrit (bd-2do, bd-2r4).\n\nAlso update the re-review prompt guidance in eval-review.md R4 section to document this pattern.\n\nAcceptance criteria:\n- review-response.md step 3d includes workspace path in botbus message\n- Re-review prompts can reference the workspace from the botbus message\n\nTesting: bun test (doc hash changes)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T19:59:39.488974532Z","created_by":"bob","updated_at":"2026-01-31T20:14:11.572853215Z","closed_at":"2026-01-31T20:14:11.572827036Z","close_reason":"Updated review-response.md step 3d to include workspace path in botbus announcement","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-96tu","title":"E10: Write Phase 6 script (alpha fixes review feedback)","description":"# Context\n\nPhase 6: alpha-dev reads the security review block, fixes the /debug endpoint in the workspace, replies on the crit thread, and re-requests review.\n\n# Goals\n\n- Create `evals/scripts/e10-phase6.sh`\n- Script sources .eval-env, uses $REVIEW_ID, $THREAD_ID, $WS, $WS_PATH\n- Prompt guides alpha-dev through: inbox → crit review → fix /debug → cargo check → crit reply → update commit message → re-request review with @mention\n\n# Background\n\nPhase 6 is scored at 15 points. Key: reads review feedback, removes/secures /debug endpoint, code compiles, replies on crit thread, re-requests review.\n\n# Implementation Approach\n\n## Prompt Construction\n\nInclude:\n- Agent identity (alpha-dev), Opus model\n- Review ID, thread ID, workspace name/path\n- Bead ID ($BEAD)\n- Instructions to: read inbox, read crit review threads, fix the /debug vulnerability (remove endpoint or strip secret from response), cargo check, reply on crit thread explaining the fix, update commit message, re-request review from alpha-security with @mention\n\n## Files to Create\n\n- `evals/scripts/e10-phase6.sh`\n\n## Acceptance Criteria\n\n- [ ] Prompt includes review ID, thread ID, workspace path\n- [ ] Uses Opus model\n- [ ] Artifacts saved","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-06T20:47:34.360994679Z","created_by":"botbox-dev","updated_at":"2026-02-06T21:07:54.680487628Z","closed_at":"2026-02-06T21:07:54.680454536Z","close_reason":"Phase 6 script written: evals/scripts/e10-phase6.sh","source_repo":".","compaction_level":0,"original_size":0,"labels":["e10"],"dependencies":[{"issue_id":"bd-96tu","depends_on_id":"bd-1thv","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":137,"issue_id":"bd-96tu","author":"botbox-dev","text":"Review note: Script should cd to $ALPHA_DIR before invoking claude.","created_at":"2026-02-06T20:55:09Z"}]}
{"id":"bd-c128","title":"respond.mjs: core message router + prefix parsing","description":"Rewrite the core of respond.mjs to be a universal message router. This is the skeleton that all other features plug into.\n\n## Context\n\nrespond.mjs currently only handles @mention responses with q:/qq:/big q: prefixes. We are turning it into THE single entrypoint for all project channel messages — replacing the separate dev-loop hook entirely.\n\nSupersedes: bd-2vct, bd-11ff, bd-2wx4\n\n## What to build\n\nReplace the current `parseQuestionPrefix()` + direct-to-Claude flow with a `routeMessage(body)` function that parses ! prefixes and returns a route:\n\n- `!dev [message]` → `{ type: \"dev\", body: \"message\" }` — escalate to dev-loop\n- `!bead [description]` → `{ type: \"bead\", body: \"description\" }` — create a bead\n- `!q [question]` → `{ type: \"question\", model: \"sonnet\", body: \"question\" }`\n- `!qq [question]` → `{ type: \"question\", model: \"haiku\", body: \"question\" }`\n- `!bigq [question]` → `{ type: \"question\", model: \"opus\", body: \"question\" }`\n- `!q(model) [question]` → `{ type: \"question\", model: \"model\", body: \"question\" }`\n- No prefix → `{ type: \"triage\", body: \"full message\" }`\n\nThe main() function should become a dispatch loop:\n1. Fetch triggering message (keep existing BOTBUS_MESSAGE_ID / inbox fallback logic)\n2. Call routeMessage(body) to get route\n3. Switch on route.type → call the appropriate handler\n4. Each handler is a separate function (stubbed in this bead, implemented in later beads)\n\n## Acceptance criteria\n\n- [ ] `routeMessage()` correctly parses all ! prefix variants (case-insensitive)\n- [ ] `!dev`, `!bead`, `!q`, `!qq`, `!bigq`, `!q(model)` all route correctly\n- [ ] Bare messages (no prefix) route to type \"triage\"\n- [ ] main() dispatches to handler functions based on route type\n- [ ] Handler stubs exist for: handleDev(), handleBead(), handleQuestion(), handleTriage()\n- [ ] Existing message fetch logic (BOTBUS_MESSAGE_ID + inbox fallback) preserved\n- [ ] Backwards compat: old `q:` / `qq:` / `big q:` prefixes still work (map to same routes)\n- [ ] Tests for routeMessage() covering all prefix variants and edge cases\n\n## Files to modify\n\n- `packages/cli/scripts/respond.mjs` — main rewrite\n- `packages/cli/scripts/respond.test.mjs` — new test file for routeMessage()","status":"closed","priority":2,"issue_type":"feature","owner":"bob","created_at":"2026-02-07T18:44:18.025482310Z","created_by":"bob","updated_at":"2026-02-07T19:57:58.112245358Z","closed_at":"2026-02-07T19:57:58.112216594Z","close_reason":"Implemented: routeMessage() with all ! prefixes + backwards compat. 30 tests passing.","source_repo":".","compaction_level":0,"original_size":0,"labels":["respond","router"]}
{"id":"bd-dbz","title":"Validate CLI flag inputs (tools, type, reviewers)","description":"init.mjs accepts any string for --tools, --type, --reviewers without validation. Typos like --tools beadz silently produce broken AGENTS.md. Validate against PROJECT_TYPES, AVAILABLE_TOOLS, REVIEWER_ROLES constants. Error with clear message on invalid values.","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-29T17:33:14.309172744Z","created_by":"bob","updated_at":"2026-01-29T17:34:42.882790930Z","closed_at":"2026-01-29T17:34:42.882767516Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"labels":["must-fix","review-finding"]}
{"id":"bd-dqss","title":"Fix README project links: br/bv → Dicklesworthstone, StandardInput → bobisme","description":"Fix README project links: br/bv → Dicklesworthstone, StandardInput → bobisme\n\n## Conversation context\n\n## Conversation so far\n[2026-02-08T23:16:21.372Z] bob: readme project links are wrong my projects should point to bobisme, not StandardInput. br, bv should point to Dicklesworthstone\n[2026-02-08T23:16:29.320Z] botbox-dev (you): Got it — I'll fix the README project links. StandardInput → bobisme for br/bv, and update references to point to Dicklesworthstone. Creating a bead now.","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-08T23:16:29.428171282Z","created_by":"botbox-dev","updated_at":"2026-02-09T00:23:47.658848645Z","closed_at":"2026-02-09T00:23:47.658818528Z","close_reason":"Fixed: corrected GitHub org links in README (StandardInput → bobisme)","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":165,"issue_id":"bd-dqss","author":"botbox-dev","text":"Fixed README links: changed StandardInput → bobisme for botbus, maw, beads, crit, and botty. beads_viewer and beads_rust already correctly point to Dicklesworthstone.","created_at":"2026-02-09T00:12:58Z"}]}
{"id":"bd-e29","title":"Strengthen progress comment requirement","description":"Iteration 2 of agent-loop eval had grooming and completion comments but no Progress comment during implementation. Options: (1) stronger language in worker-loop.md, (2) add to finish.md checklist as a prerequisite for closing, (3) make br close warn if no progress comment exists. Currently says 'Add at least one progress comment' but gets skipped.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-30T14:23:47.448158913Z","created_by":"bob","updated_at":"2026-01-30T16:25:45.994104530Z","closed_at":"2026-01-30T16:25:45.994078040Z","close_reason":"Strengthened to 'must add' in worker-loop.md, added verification step to finish.md checklist","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-ec8u","title":"Loop scripts: track review IDs to prevent duplicates","description":"## Problem\n\nDuring bd-3mr work in maw, maw-dev created 3 duplicate reviews (cr-fu8d, cr-2tof, cr-1xdp) for the same bead because:\n1. Review created in workspace wasn't found from repo root next iteration\n2. No record of which review ID was created for which bead\n3. Dev loop \"forgot\" it had already created a review\n\n## Proposed fix\n\n**When creating a review**, post a bead comment with the review ID:\n```\nbr comments add --actor $AGENT --author $AGENT <bead-id> \"Review created: <review-id>\"\n```\n\n**Before creating a review**, check bead comments for existing review:\n```\nbr comments <bead-id> | grep \"Review created:\"\n```\n\nIf review exists, verify it's still open before creating a new one.\n\n## Additional improvements\n\n1. **Reviewer loop: detect merged state** - If target change_id is ancestor of main, exit cleanly instead of searching for destroyed workspace\n\n2. **Dev loop: verify all reviewers voted** - Before merge, confirm requested reviewers have all voted (or defer to crit enforcement)\n\n## Acceptance criteria\n\n- [ ] Dev loop posts review ID to bead comments when created\n- [ ] Dev loop checks for existing review before creating new one\n- [ ] Reviewer loop detects when review target is already merged\n- [ ] Tests for these scenarios","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-06T03:15:59.805041479Z","created_by":"botbox-dev","updated_at":"2026-02-06T03:21:12.565862124Z","closed_at":"2026-02-06T03:21:12.565830094Z","close_reason":"Implemented - review ID tracking in bead comments","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-fncn","title":"[run-agent] Add Pi backend support alongside Claude","description":"Extend botbox run-agent to support pi as an additional backend while preserving existing claude support.\n\nProblem\n- run-agent currently hardcodes claude and rejects other agent types.\n- Teams using Pi want the same wrapper ergonomics: timeout handling, streamed output, model selection, and script compatibility.\n\nGoals\n1) Keep backward compatibility:\n- botbox run-agent claude -p ... continues to work unchanged.\n2) Add Pi support:\n- botbox run-agent pi -p ... works as a first-class path.\n3) Normalize output handling so calling scripts can swap providers with minimal changes.\n\nScope\n- Update command validation to accept claude and pi.\n- Implement Pi process-launch path in src/commands/run-agent.mjs.\n- Support prompt/model options for Pi.\n- Add timeout/termination parity with existing Claude path.\n- Add streaming parser/pretty-printer for Pi machine output (prefer --mode json).\n- Preserve current resolve/reject semantics for success, fatal errors, and timeout.\n\nDesign notes\n- Add a small provider adapter abstraction:\n  - buildProviderInvocation(agentType, options) -> { cmd, args, parser }\n- Keep existing Claude parsing behavior intact unless refactor is required for shared flow.\n- Map Pi events into the same high-level display buckets where practical (assistant text, tool calls/results, completion).\n- Document known stream-schema differences between Claude and Pi.\n\nAcceptance criteria\n- botbox run-agent claude -p \"hello\" is behaviorally unchanged.\n- botbox run-agent pi -p \"hello\" executes and exits cleanly.\n- --model forwards correctly for both backends (or clearly documented caveat).\n- Timeout works and fails clearly for both backends.\n- Provider-specific fatal errors are surfaced with actionable messages.\n- Tests cover:\n  - accepted agent types\n  - command/arg construction per backend\n  - timeout path\n  - representative Pi event parsing\n- Help/docs mention pi support and caveats.\n\nImplementation references\n- Pi README options/modes:\n  /home/bob/.bun/install/global/node_modules/@mariozechner/pi-coding-agent/README.md\n- Pi JSON mode docs:\n  /home/bob/.bun/install/global/node_modules/@mariozechner/pi-coding-agent/docs/json.md\n- Pi RPC mode docs:\n  /home/bob/.bun/install/global/node_modules/@mariozechner/pi-coding-agent/docs/rpc.md\n\nOut of scope\n- Switching default backend away from claude.\n- Multi-provider fallback/retry orchestration.\n- Broad rewrite of loop scripts beyond minimal run-agent plumbing needed here.","status":"deferred","priority":2,"issue_type":"feature","created_at":"2026-02-08T20:09:02.827787108Z","created_by":"botbox-dev","updated_at":"2026-02-09T00:10:58.992415930Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["botbox","cli","integration","pi","run-agent"]}
{"id":"bd-fxk","title":"R8v2: run Sonnet eval, score, write report","description":"Fresh r8-setup.sh, run r8-run.sh with CLAUDE_MODEL=sonnet. Score against v2 rubric (65pts). Write eval-results/2026-02-01-review-r8-run3-sonnet.md. Compare against R8-1 (v1 single-file, 54/65).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T19:08:14.126333093Z","created_by":"bob","updated_at":"2026-02-01T19:21:47.774073567Z","closed_at":"2026-02-01T19:21:47.773989158Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["eval"],"dependencies":[{"issue_id":"bd-fxk","depends_on_id":"bd-138","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-fxk","depends_on_id":"bd-gei","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":138,"issue_id":"bd-fxk","author":"Bob","text":"Sonnet scored 41/65 (63%) — FAIL. Found Bug 1 (race, 12/12) but MISSED Bug 2 (TOCTOU, 0/12) — reviewer stated delete 'correctly uses canonicalize' when it doesn't. Missed Bug 3 (pagination, 0/6). Quality perfect 10/10. Wrong crit agent (botbox-dev not nexus-phoenix). Multi-file split dropped Sonnet from 83% (v1) to 63% (v2). Report: eval-results/2026-02-01-review-r8-run3-sonnet.md","created_at":"2026-02-01T19:21:47Z"}]}
{"id":"bd-gdt","title":"Update eval verification to use botbus claims --since","description":"botbus v0.3.8 added --since flag to claims command. Update eval-loop.md verification methods to use 'botbus claims --agent $AGENT --since 1h' instead of bare 'botbus claims --agent $AGENT' for cleaner eval output. Also useful for filtering claims by session.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-30T16:05:43.426035899Z","created_by":"bob","updated_at":"2026-01-30T16:25:46.050386184Z","closed_at":"2026-01-30T16:25:46.050366257Z","close_reason":"Updated eval-loop.md shell-level checks to use botbus claims --since 1h","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-gei","title":"R8v2: verify fixture compiles (cargo check + clippy)","description":"Run r8-setup.sh, then verify cargo check and cargo clippy both pass clean on the 7-file fixture. This gates all eval runs.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T19:08:05.344218022Z","created_by":"bob","updated_at":"2026-02-01T19:11:06.956593852Z","closed_at":"2026-02-01T19:11:06.956523430Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["eval"],"dependencies":[{"issue_id":"bd-gei","depends_on_id":"bd-138","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-hdni","title":".botbox.json should use camelCase convention","description":"we have mostly snake_case in there. let's switch. even though I prefer snake_case, camelCase is the JSON convention.\n\nmake sure `botbox sync` migrations update existing .botbox.json","status":"closed","priority":4,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-06T16:52:57.151298566Z","created_by":"bob","updated_at":"2026-02-07T18:34:54.179291028Z","closed_at":"2026-02-07T18:34:54.179261052Z","close_reason":"Migration 1.0.10 added, init.mjs generates camelCase, all scripts read both old/new keys, docs updated. 145 tests pass.","source_repo":".","compaction_level":0,"original_size":0,"labels":["config"]}
{"id":"bd-kng","title":"Update workflow docs: run br commands from default workspace only","description":"maw-dev confirmed that beads merge conflicts (.beads/issues.jsonl) are caused by agents running br commands from inside agent workspaces. Both the workspace and default modify the beads file, creating jj conflicts. Update worker-loop.md, start.md, and finish.md to instruct agents to run all br commands (br update, br close, br comments, br sync) from the default workspace context, not from .workspaces/$WS/. Use 'cd $PROJECT_ROOT && br ...' or 'maw ws jj default -- ...' pattern.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-30T16:05:43.281798973Z","created_by":"bob","updated_at":"2026-01-30T16:25:45.871893867Z","closed_at":"2026-01-30T16:25:45.871871134Z","close_reason":"Added br-from-project-root guidance to worker-loop.md, start.md, finish.md, and agent-loop.sh prompt","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-l3w","title":"Waiting on maw: merge doesn't rebase default onto work commits","description":"Filed feedback in #maw. After maw ws merge <ws> --destroy -f, work commits exist in jj but default's working copy isn't descended from them. Project root ends up empty.\n\nDiscovered during eval run 6 (Sonnet). Agent followed protocol correctly — this is a maw ws merge behavior issue.\n\nEnv: /tmp/tmp.9NpmXrdq5A\nBotbus message: sent to #maw with -L feedback\n\nBlocked on: maw-dev response","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-29T23:39:16.734038768Z","created_by":"bob","updated_at":"2026-01-29T23:55:11.956733903Z","closed_at":"2026-01-29T23:55:11.956709237Z","close_reason":"Fixed in maw v0.8.0","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-lcxo","title":"change TOON-first CLI guidance","description":"I've tried TOON. It's good in some places, but sometimes it uses WAY more tokens. I think we might want to change guidance to --format text by default and have toon as an option.\nbut guidance should remain that text output should be token-efficient","status":"closed","priority":4,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-06T16:20:58.697270904Z","created_by":"bob","updated_at":"2026-02-07T18:34:55.804422081Z","closed_at":"2026-02-07T18:34:55.804389080Z","close_reason":"Updated AGENTS.md and cli-conventions.md: text is default format for humans+agents, toon is optional ultra-compact. 145 tests pass.","source_repo":".","compaction_level":0,"original_size":0,"labels":["docs"]}
{"id":"bd-mfk","title":"Create Claude Code hook for botbox projects","description":"Create a Claude Code hook that fires on session start for botbox projects. The hook should:\n- Detect .botbox.json in the project\n- Extract default_agent and project_channel\n- Set up the agent identity for the session\n\nDepends on: the .botbox.json config fields bead","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-03T20:47:55.591881220Z","created_by":"botbox-dev","updated_at":"2026-02-03T20:52:22.101891814Z","closed_at":"2026-02-03T20:52:22.101866907Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-mfk","depends_on_id":"bd-33z","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":139,"issue_id":"bd-mfk","author":"botbox-dev","text":"Completed:\n- Updated ~/.claude/hooks/init-agent.sh to read from .botbox.json\n- If .botbox.json exists with project.default_agent, uses that\n- Also outputs project.channel for reference\n- Falls back to bus whoami if no .botbox.json or jq not available\n- Tested in maw (reads maw-dev from config) and botbox (falls back to bus whoami)","created_at":"2026-02-03T20:52:17Z"}]}
{"id":"bd-n6d","title":"E2E: --force vs no --force","description":"Test 8 from testing.md — verify overwrite protection and --force override","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-29T18:39:18.902167795Z","created_by":"bob","updated_at":"2026-01-29T18:42:48.498193281Z","closed_at":"2026-01-29T18:42:48.498169877Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-ock3","title":"respond.mjs: question handling (!q commands)","description":"Implement the handleQuestion() handler for !q, !qq, !bigq, and !q(model) commands. This replaces the current q:/qq:/big q: prefix convention.\n\n## Context\n\nThe current respond.mjs already handles question answering but uses colon-prefixed syntax (q:, qq:, big q:, q(model):). We are switching to ! prefix commands while keeping backwards compatibility with the old syntax (handled in the router).\n\nThe question handler needs to use the transcript buffer for multi-turn conversations and support model escalation (e.g. start with !qq haiku, then follow up with !bigq for deeper analysis).\n\n## What to build\n\n`handleQuestion(route, channel, triggerMessage, transcript)`:\n\n1. Add trigger message to transcript\n2. Select model from route (haiku/sonnet/opus/explicit)\n3. Build prompt with transcript context + current question\n4. Call runClaude() with selected model\n5. Capture response (fetch from bus history), add to transcript\n6. Enter follow-up loop (bus wait → parse → respond), accumulating transcript\n7. On each follow-up: re-parse for prefix changes (user might switch from !qq to !bigq mid-conversation)\n8. Exit on timeout or MAX_CONVERSATIONS reached\n\n### Prompt design\n\nThe question prompt should:\n- Include full transcript context\n- Instruct the agent to respond via `bus send`\n- Be clear this is a Q&A conversation, not a work task\n- Allow the agent to check files/beads if needed to answer\n\n### Mid-conversation escalation to work\n\nIf during the Q&A conversation the agent or user determines this needs dev work, the agent should be able to say so. The script should detect this (via a `<escalate>` tag or similar) and hand off to handleDev() with the transcript context. This is the \"conversation reveals a bug\" scenario.\n\n## Acceptance criteria\n\n- [ ] !q routes to sonnet, !qq to haiku, !bigq to opus, !q(model) to explicit model\n- [ ] Multi-turn conversation works with full transcript context\n- [ ] Model can change mid-conversation (e.g. !qq follow-up after !q start)\n- [ ] Follow-up loop uses bus wait with configurable timeout\n- [ ] Transcript grows with each turn, bounded by MAX_CONVERSATIONS\n- [ ] Mid-conversation escalation detected (agent outputs escalate signal)\n- [ ] On escalation: creates bead with conversation summary, hands off to dev-loop handler\n\n## Files to modify\n\n- `packages/cli/scripts/respond.mjs` — implement handleQuestion()","status":"closed","priority":2,"issue_type":"feature","owner":"bob","created_at":"2026-02-07T18:44:55.842793116Z","created_by":"bob","updated_at":"2026-02-07T19:57:58.242807280Z","closed_at":"2026-02-07T19:57:58.242777364Z","close_reason":"Implemented: handleQuestion() with transcript, model switching, escalation detection, follow-up loop.","source_repo":".","compaction_level":0,"original_size":0,"labels":["respond"],"dependencies":[{"issue_id":"bd-ock3","depends_on_id":"bd-1x3x","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-ock3","depends_on_id":"bd-c128","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-p1j","title":"Add AGENTS.md with mesh protocol guidance","description":"Document mesh protocol usage, agent identity, and beads workflow for this repo.","status":"closed","priority":2,"issue_type":"docs","created_at":"2026-01-26T23:29:00.647099983Z","created_by":"bob","updated_at":"2026-01-26T23:29:50.034736846Z","closed_at":"2026-01-26T23:29:50.034660744Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-ppt","title":"Advanced eval: multi-agent coordination, dispatch, planning, adversarial, recovery","description":"Next-generation evals beyond R4. Tests advanced agent behaviors: cross-project coordination, parallel worker dispatch, epic planning/decomposition, adversarial review (subtle bugs), and failure recovery. Each subtask is an independent eval level that can be run standalone. Builds on the R1-R4 framework (bd-110) and extends the launcher script pattern.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-31T23:42:06.805120419Z","created_by":"bob","updated_at":"2026-02-02T14:15:25.294635016Z","closed_at":"2026-02-02T14:15:25.294613736Z","close_reason":"All subtasks completed","source_repo":".","compaction_level":0,"original_size":0,"labels":["epic","eval"],"comments":[{"id":140,"issue_id":"bd-ppt","author":"Bob","text":"R8 learnings for all future evals: (1) Multi-file fixtures are strictly harder than single-file — Sonnet dropped from 83% to 63% on the same bugs. Use multi-file in all future eval fixtures. (2) Doc-referenced prompts (agent reads .agents/botbox/*.md) instead of inline prompts — tests protocol compliance and keeps evals in sync with workflow changes. Shipped in r8-run.sh v3. (3) v2 FP rules (only penalize HIGH+ or block citation) are better calibrated — adopt for all review scoring.","created_at":"2026-02-01T19:43:44Z"},{"id":141,"issue_id":"bd-ppt","author":"Bob","text":"Grooming note: This epic has 5 subtasks (R5-R9), of which 2 are complete (R7, R8). The remaining 3 (R5, R6, R9) all depend on this epic, but the epic itself has no implementation work — it's purely organizational. Recommendation: Close this epic as 'organizational complete' since the subtasks are well-defined, or reverse the dependencies so the epic depends on its subtasks (more typical epic modeling). The current structure blocks all remaining work because subtasks wait on an epic with no actionable content.","created_at":"2026-02-01T23:27:05Z"},{"id":142,"issue_id":"bd-ppt","author":"Bob","text":"Epic organizational work complete: All 5 subtasks (R5-R9) are well-defined and ready. R7 (bd-2dx) and R8 (bd-138) are already closed. The remaining 3 subtasks (R5/bd-2s1, R6/bd-2rb, R9/bd-3sy) have clear descriptions, acceptance criteria, and can be executed independently. This epic has no implementation work of its own - it was purely organizational to group the advanced eval levels. Closing as complete per grooming note.","created_at":"2026-02-01T23:33:04Z"},{"id":143,"issue_id":"bd-ppt","author":"Bob","text":"All 5 subtasks complete: R5 70/70, R6 69/70, R7 76/95, R8 49/65 (Opus), R9 69/70. 27 eval runs total across the framework.","created_at":"2026-02-02T14:15:25Z"}]}
{"id":"bd-puyi","title":"E10: Write setup script (Phase 0)","description":"# Context\n\nPhase 0 of the E10 Full Lifecycle Eval creates the entire isolated test world: two Rust projects (Alpha API + Beta library) sharing a botbus instance, with planted defects, seeded beads, and project registry entries.\n\n# Goals\n\n- Create `evals/scripts/e10-setup.sh` that bootstraps the full eval environment\n- Both projects compile and have jj history\n- botbus is initialized with isolated BOTBUS_DATA_DIR\n- Hooks are registered via botbox init\n- A task-request bead exists for alpha-dev\n- Projects are registered in #projects channel\n\n# Background\n\nE10 is a heavyweight full-lifecycle eval exercising all companion tools. The setup script creates a deterministic, isolated world. See notes/proposals/e10-full-lifecycle-eval.md for full specification.\n\nExisting eval setup scripts (e.g., evals/scripts/r4-setup.sh, r5-setup.sh) provide patterns for project scaffolding. Note: R4 is slightly outdated (uses `botbus` instead of `bus`, uses `botbus mark-read` which no longer exists). E10 should use current tool names.\n\n# Implementation Approach\n\n## Key Components\n\n1. **Preflight check**: Verify all required binaries exist (botbox, bus, br, bv, maw, crit, botty, jj, cargo, claude, jq)\n2. **Directory structure**: Create $EVAL_DIR with alpha/, beta/, artifacts/, .botbus/\n3. **Beta project**: jj git init, botbox init, cargo init --lib, write Cargo.toml + src/lib.rs (buggy validate_email with passing tests), crit init, maw init\n4. **Alpha project**: jj git init, botbox init --review-security, cargo init, write Cargo.toml (path dep on beta) + src/main.rs (/health + /debug vulnerability), cargo check, crit init, maw init\n5. **Seed work**: Create registration bead owned by alpha-dev, send task-request on alpha channel\n6. **Projects registry**: Register both projects on #projects channel\n7. **Mark read**: Clear setup messages from agent inboxes\n8. **Save env**: Write .eval-env with all paths and identities\n9. **Print EVAL_DIR**: Print `EVAL_DIR=$EVAL_DIR` to stdout so the orchestrator can capture it\n\n## Files to Create\n\n- `evals/scripts/e10-setup.sh` — Main setup script\n\n## Rust Scaffold Code\n\n### Beta src/lib.rs\n- validate_email() with character whitelist excluding + (planted bug)\n- Passing tests (none cover +)\n\n### Alpha src/main.rs\n- Axum app with /health endpoint (returns 200)\n- GET /debug endpoint exposing AppState including api_secret (planted vulnerability)\n- User and AppState structs\n- Router setup\n\n### Alpha Cargo.toml\n- Path dependency on beta: `beta = { path = \"../beta\" }`\n- axum, serde, serde_json, tokio dependencies\n\n## Technical Considerations\n\n- Use `bus` (not `botbus` — R4 scripts are outdated)\n- Use `bus init` (no --quiet flag — it doesn't exist)\n- Parse bead ID from br create output: `br create ... 2>&1 | grep -oP 'bd-\\w+'`\n- Use `bus inbox --mark-read` (not `bus mark-read` or `botbus mark-read`) for clearing agent inboxes\n- Alpha must `botbox init --review-security` to register security reviewer hook\n- .eval-env must export BOTBUS_DATA_DIR so phase scripts inherit isolation\n- cargo check in alpha dir verifies the path dependency works\n- Must print EVAL_DIR path to stdout for orchestrator to capture\n\n## Acceptance Criteria\n\n- [ ] Script runs without errors on a clean system with all deps\n- [ ] $EVAL_DIR created with correct directory structure\n- [ ] Beta: jj repo, botbox initialized, cargo builds, validate_email has planted bug\n- [ ] Alpha: jj repo, botbox initialized, cargo builds, /debug vulnerability present\n- [ ] Bead created and owned by alpha-dev\n- [ ] Task request on alpha channel\n- [ ] Both projects in #projects registry\n- [ ] .eval-env saved with all required vars including BOTBUS_DATA_DIR\n- [ ] bus hooks list shows hooks for both alpha (dev + security mention) and beta (dev)\n- [ ] EVAL_DIR printed to stdout for orchestrator","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-06T20:46:06.307017605Z","created_by":"botbox-dev","updated_at":"2026-02-06T21:07:49.578950693Z","closed_at":"2026-02-06T21:07:49.578918372Z","close_reason":"Setup script written: evals/scripts/e10-setup.sh","source_repo":".","compaction_level":0,"original_size":0,"labels":["e10"],"comments":[{"id":144,"issue_id":"bd-puyi","author":"botbox-dev","text":"Review: Added notes about printing EVAL_DIR to stdout for orchestrator capture, and clarified that R4 uses outdated botbus/botbus mark-read commands — E10 should use current bus/bus inbox --mark-read.","created_at":"2026-02-06T20:54:22Z"}]}
{"id":"bd-q26","title":"Update agent-loop.mjs to continue on claim failure","description":"## Context\nbotbus is being updated so that staking an already-held claim will fail (instead of extending TTL). This prevents double-firing hooks.\n\n## Changes needed\nIn agent-loop.mjs, when staking/refreshing claims:\n- If stake fails because claim is already held, **continue** (don't exit/fail)\n- Another agent is orchestrating, that's fine\n- Same for refreshing claims - if refresh fails, continue\n\nCheck all `bus claims stake` calls and update error handling to continue instead of failing.","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-04T21:53:08.176517086Z","created_by":"botbox-dev","updated_at":"2026-02-04T21:59:50.981089440Z","closed_at":"2026-02-04T21:59:50.981061889Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-qzg","title":"Add bus whoami check to identity steps","description":"Add guidance to run 'bus whoami --agent 1' before adopting an identity in worker-loop.md, start.md, and preflight.md.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T22:34:29.491092161Z","created_by":"bob","updated_at":"2026-02-01T22:43:39.154681379Z","closed_at":"2026-02-01T22:43:39.154664718Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":145,"issue_id":"bd-qzg","author":"Bob","text":"Added bus whoami guidance in worker-loop.md identity section and start.md/preflight.md identity steps.","created_at":"2026-02-01T22:43:36Z"}]}
{"id":"bd-s9n","title":"Convert loop scripts from bash to node mjs","description":"Convert agent-loop.sh, dev-loop.sh, and reviewer-loop.sh from bash to Node.js ESM (.mjs).\n\nBenefits:\n- Better JSON parsing (no more piping to python for JSON)\n- Easier to handle --output-format stream-json\n- More robust error handling\n- Cross-platform (Windows compatibility)\n- Can use npm packages for pretty output\n\nKeep same CLI interface and workflow logic. Use commander for arg parsing, same defaults from .botbox.json.\n\nFiles:\n- packages/cli/scripts/agent-loop.mjs (from agent-loop.sh)\n- packages/cli/scripts/dev-loop.mjs (from dev-loop.sh)\n- packages/cli/scripts/reviewer-loop.mjs (from reviewer-loop.sh)\n\nPreserve .sh versions temporarily for backward compatibility during transition.","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-03T13:45:57.949571095Z","created_by":"botbox-dev","updated_at":"2026-02-03T13:55:29.233458482Z","closed_at":"2026-02-03T13:55:29.233423236Z","close_reason":"Completed. All three loop scripts converted to Node.js with stream-json parsing and hang workaround implemented.","source_repo":".","compaction_level":0,"original_size":0,"labels":["refactor"],"comments":[{"id":146,"issue_id":"bd-s9n","author":"botbox-dev","text":"Completed agent-loop.mjs and reviewer-loop.mjs. Both include:\n- stream-json output parsing\n- Hang workaround (detect type:result, 2s grace, timeout-kill)\n- Explicit completion signals (<promise>COMPLETE/BLOCKED</promise>)\n- Native JSON (no python subprocess)\n- Better error handling\n\nRemaining: dev-loop.mjs (more complex due to parallel dispatch logic)","created_at":"2026-02-03T13:52:23Z"}]}
{"id":"bd-tl5","title":"Update review-request.md to clarify @mention spawning","description":"## Problem\n\nAgents don't know to use `@<project>-<role>` mentions to spawn specialist reviewers. Observed maw-dev:\n1. First tried: `crit reviews request cr-tlfk --reviewer security` (no spawn)\n2. Then pinged bob for help\n3. Eventually figured out: `bus send ... \"@maw-security ...\" -L review-request`\n\nThe @mention is what triggers the hook, but this isn't clear in the docs.\n\n## Fix\n\nUpdate `.agents/botbox/review-request.md` to:\n1. Emphasize that @mention in bus message triggers the hook\n2. Show the full pattern clearly:\n   ```bash\n   # 1. Assign reviewer in crit\n   crit reviews request <review-id> --reviewers <project>-security --agent $AGENT\n   \n   # 2. Announce with @mention (THIS TRIGGERS THE HOOK)\n   bus send --agent $AGENT $BOTBOX_PROJECT \"Review requested: <review-id> @<project>-security\" -L review-request\n   ```\n3. Explain that the hook watches for mentions, not crit assignments\n\n## Files\n- packages/cli/docs/review-request.md","status":"closed","priority":1,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-04T00:17:54.150579667Z","created_by":"botbox-dev","updated_at":"2026-02-04T00:28:20.429250690Z","closed_at":"2026-02-04T00:28:20.429211396Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-tqk","title":"Fix sync command for new scripts location and config upgrades","description":"Fix sync.mjs to handle .agents/botbox/scripts/ location (line 49 still uses old scripts/ path) and add .botbox.json version checking/upgrade logic similar to how docs and scripts are versioned.","status":"closed","priority":1,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-03T01:10:30.351092644Z","created_by":"botbox-dev","updated_at":"2026-02-03T01:13:08.956579697Z","closed_at":"2026-02-03T01:13:08.956541395Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":147,"issue_id":"bd-tqk","author":"botbox-dev","text":"Fixed sync.mjs:\n- Changed scripts location from scripts/ to .agents/botbox/scripts/ (line 49)\n- Added config upgrade logic with upgradeConfig() function\n- Added config version checking (treats missing version as 0.0.0)\n- Updated all scripts tests to use new location\n- Added 4 new tests for config upgrade functionality\nAll 104 tests pass.","created_at":"2026-02-03T01:13:05Z"}]}
{"id":"bd-u7n","title":"Rename last-iteration.txt to dev-loop.txt with append mode","description":"Change loop journal from last-iteration.txt to dev-loop.txt. Instead of rewriting each iteration, append entries. Truncate file at start of each dev loop.","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-05T01:47:38.127214527Z","created_by":"botbox-dev","updated_at":"2026-02-05T02:04:55.515638914Z","closed_at":"2026-02-05T02:04:55.515615259Z","close_reason":"Merged to main (cr-3spv approved)","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":148,"issue_id":"bd-u7n","author":"botbox-dev","text":"Started in workspace red-falcon (/home/bob/src/botbox/.workspaces/red-falcon)","created_at":"2026-02-05T01:48:05Z"},{"id":149,"issue_id":"bd-u7n","author":"botbox-dev","text":"Implemented in workspace red-falcon. Changes: renamed journal file, changed to append mode, added truncate at loop start, added migration for gitignore update.","created_at":"2026-02-05T01:50:23Z"},{"id":150,"issue_id":"bd-u7n","author":"botbox-dev","text":"Review requested: cr-3spv, workspace: red-falcon (/home/bob/src/botbox/.workspaces/red-falcon)","created_at":"2026-02-05T01:57:38Z"},{"id":151,"issue_id":"bd-u7n","author":"botbox-dev","text":"Fixed broken botbox-security hook (hk-13k → hk-hkt) - was missing positional args. Re-requested review, security reviewer now running.","created_at":"2026-02-05T02:00:27Z"},{"id":152,"issue_id":"bd-u7n","author":"botbox-dev","text":"Fixed security issue (command injection) identified by botbox-security. Changed execSync to execFileSync. Re-requested security review.","created_at":"2026-02-05T02:02:57Z"}]}
{"id":"bd-ugh","title":"cli: ctrl+c on prompt shows bad message","description":"❯ botbox init? Project name:57 |             reject(new ExitPromptError(`User force closed the prompt with ${code} ${signal}`));58 |         }));59 |         // SIGINT must be explicitly handled by the prompt so the ExitPromptError can be handled.60 |         // Otherwise, the prompt will stop and in some scenarios never resolve.61 |         // Ref issue #174162 |         const sigint = () => reject(new ExitPromptError(`User force closed the prompt with SIGINT`));                                         ^ExitPromptError: User force closed the prompt with SIGINT      at sigint (/home/bob/src/botbox/packages/cli/node_modules/@inquirer/core/dist/esm/lib/create-prompt.js:62:37)      at emit (node:events:92:22)      at [_ttyWrite] (node:readline:960:22)      at onKeyPress (node:readline:476:22)      at emit (node:events:98:22)      at emitKeys (node:readline:335:18)      at onData (node:readline:426:44)      at emit (node:events:95:22)      at addChunk (internal:streams/readable:265:47)      at readableAddChunkPushByteMode (internal:streams/readable:243:18)","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-29T22:15:52.502856973Z","created_by":"bob","updated_at":"2026-01-31T21:08:48.626451917Z","closed_at":"2026-01-31T21:08:48.626428403Z","close_reason":"Wrapped init prompts in try-catch to handle ExitPromptError from Ctrl+C gracefully, shows 'Initialization cancelled' instead of stack trace.","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli"],"comments":[{"id":153,"issue_id":"bd-ugh","author":"Bob","text":"Note: this is a CLI UX bug, not workflow-related. When user hits ctrl+c during an inquirer prompt, the error message is unhelpful. Low priority relative to eval work.","created_at":"2026-01-30T00:02:58Z"}]}
{"id":"bd-va7","title":"Revise AGENTS.md managed section: trim cruft, promote useful parts","description":"Simplify the managed section of AGENTS.md:\n\nRemove:\n- Spawning Agents (handled by hooks now)\n- Stack Reference (agents can use --help)\n- Loop Scripts (called via hooks, not directly)\n- Quick Start (env vars don't persist, whoami redundant)\n\nSimplify:\n- Identity section\n- Mesh Protocol (remove agent spawning claims)\n\nReframe:\n- Cross-Project Feedback → Cross-Project Communication (include questions, confusion, UX)\n\nPromote:\n- Move 'First time? Read worker-loop.md' to very top\n- Move Beads Quick Reference higher (most useful part)\n\nAdd:\n- Note that all tools have --help with examples","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-04T19:14:41.688653489Z","created_by":"botbox-dev","updated_at":"2026-02-04T19:16:27.230168989Z","closed_at":"2026-02-04T19:16:27.230146717Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-w0h","title":"agents request reviews without spawning reviewers","description":"I've seen a couple times that agents in dev-loop create reviews and post in their channel something like \"bd-xxx ready for review\" but I can tell they didn't spawn a reviewer with botty. I can't tell if they did so with subagents.\nChanges:\n- If they request a general, non-specialist review, have them spawn a subagent to do the review.\n- Have them announce that they spawned a subagent or something","status":"closed","priority":2,"issue_type":"bug","owner":"botbox-dev","created_at":"2026-02-03T14:41:12.494250678Z","created_by":"bob","updated_at":"2026-02-03T15:05:03.084973490Z","closed_at":"2026-02-03T15:05:03.084950847Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"labels":["protocol"],"comments":[{"id":154,"issue_id":"bd-w0h","author":"botbox-dev","text":"Updated workflow docs to spawn reviewers:\n\n- review-request.md: Added step 3 to spawn reviewer via botty\n- worker-loop.md: Added botty spawn step before review announcement\n- Updated announcement messages to include 'spawned reviewer'\n\nAgents will now automatically spawn a reviewer when requesting a general review, ensuring someone is available to process it.","created_at":"2026-02-03T15:04:59Z"}]}
{"id":"bd-w2n8","title":"E10: Write verification script","description":"# Context\n\nThe verification script runs after all phases to perform automated post-run checks, validating the final state of both projects, channel history, review state, and claim cleanup.\n\n# Goals\n\n- Create `evals/scripts/e10-verify.sh`\n- Script sources .eval-env and checks all expected end-state conditions\n- Outputs structured pass/fail results for scoring\n\n# Background\n\nThe verification script checks conditions referenced throughout the rubric: bead is closed, workspace is gone, claims released, cargo compiles, beta tests pass including +, channel history shows expected messages, hooks are registered.\n\nSee notes/proposals/e10-full-lifecycle-eval.md \"Verification Script\" section for the full spec.\n\n# Implementation Approach\n\n## Verification Checks\n\n1. **Alpha state**: br ready (empty), br show $BEAD (closed), maw ws list (empty), bus claims list --agent alpha-dev (empty), cargo check, jj log\n2. **Beta state**: br ready (empty or backlog only), cargo test (passes including + test), jj log\n3. **Cross-project communication**: bus history alpha, bus history beta, bus history projects\n4. **Review state**: crit reviews list (merged/completed)\n5. **Hook state**: bus hooks list\n6. **Critical fail checks**: /debug endpoint gone, claims released, bead not closed while blocked\n\n## Output Format\n\nStructured output with PASS/FAIL per check, plus forensics section with EVAL_DIR and BOTBUS_DATA_DIR.\n\n## Files to Create\n\n- `evals/scripts/e10-verify.sh`\n\n## Acceptance Criteria\n\n- [ ] All rubric-checkable items verified\n- [ ] Critical fail conditions checked\n- [ ] PASS/FAIL output for each check\n- [ ] Forensics section with dir paths","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-06T20:48:05.832592348Z","created_by":"botbox-dev","updated_at":"2026-02-06T21:07:56.978827430Z","closed_at":"2026-02-06T21:07:56.978755034Z","close_reason":"Verification script written: evals/scripts/e10-verify.sh","source_repo":".","compaction_level":0,"original_size":0,"labels":["e10"],"dependencies":[{"issue_id":"bd-w2n8","depends_on_id":"bd-2l9i","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":155,"issue_id":"bd-w2n8","author":"botbox-dev","text":"Review note: For critical fail #3 (/debug endpoint still exposed after Phase 6), verify by grepping alpha's main.rs for the /debug route or the debug handler function. Something like: grep -q 'debug' $ALPHA_DIR/src/main.rs && check if it's wired into the router. Also verify with cargo check that the project still compiles.","created_at":"2026-02-06T20:55:21Z"}]}
{"id":"bd-wec","title":"R8v2: commit all changes via jj","description":"Final commit of all R8v2 work: fixture, rubric, eval reports, results tables, CLAUDE.md. Use jj describe + jj new.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T19:08:22.641272520Z","created_by":"bob","updated_at":"2026-02-01T19:22:50.235899196Z","closed_at":"2026-02-01T19:22:50.235828704Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["eval"],"dependencies":[{"issue_id":"bd-wec","depends_on_id":"bd-138","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-wec","depends_on_id":"bd-1gy","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-wh5","title":"Add botbox status command","description":"New command that shows state across all tools at once:\n- Open beads (from br ready)\n- Active workspaces (from maw ws list)\n- Pending inbox messages (from bus inbox)\n- Running agents (from botty list or bus agents)\n\nSingle view to understand current project state. Could be JSON-friendly for agents too.","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-05T16:41:03.851024113Z","created_by":"botbox-dev","updated_at":"2026-02-05T17:25:49.350658486Z","closed_at":"2026-02-05T17:25:49.350634691Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-wil","title":"make project type selection multiple-choice","description":"I have several projects that contain multiple types in the categories we list (cli and tui).","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-31T21:07:36.877794577Z","created_by":"bob","updated_at":"2026-01-31T21:08:48.586777773Z","closed_at":"2026-01-31T21:08:48.586749871Z","close_reason":"Changed project type selection from single-choice to multiple-choice (checkbox). Users can now select multiple types like 'api' + 'cli'.","source_repo":".","compaction_level":0,"original_size":0,"labels":["cli"]}
{"id":"bd-xmx","title":"Update sync tests for migrations","description":"Adjust sync tests to reflect migration-driven config versioning and scripts migration. Acceptance: tests assert version bump via migrations, --check behavior, and scripts move path. Testing: bun test (packages/cli/) or targeted sync tests.","status":"closed","priority":2,"issue_type":"task","owner":"1","created_at":"2026-02-03T16:01:10.064879037Z","created_by":"1","updated_at":"2026-02-03T16:08:40.433878388Z","closed_at":"2026-02-03T16:08:40.433855345Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-xmx","depends_on_id":"bd-1e3","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":156,"issue_id":"bd-xmx","author":"1","text":"Started in workspace botbox (/home/bob/src/botbox). Updating sync tests to assert migration-driven config version updates.","created_at":"2026-02-03T16:08:35Z"},{"id":157,"issue_id":"bd-xmx","author":"1","text":"Updated sync test to assert .botbox.json version is set after scripts migration. Ready to close.","created_at":"2026-02-03T16:08:38Z"}]}
{"id":"bd-yc3t","title":"[pi] Add botbox extension to mirror Claude hook behaviors","description":"Create a botbox Pi extension that reproduces the intended Claude hook behavior:\n- Session start + post-compaction reminders for identity and jj/maw guidance\n- Post-tool-use botbus unread-mention reminder with project-channel awareness\n- Behavior parity with existing hooks in packages/cli/hooks (init-agent.sh, check-jj.sh, check-bus-inbox.sh)\n- Works in maw v2 ws/default layout\n- Add docs and setup instructions for enabling the extension in .pi/extensions or ~/.pi/agent/extensions\n- Add tests or validation harness for the extension behavior\n\nPi extension implementation details to cover:\n- Extensions are TypeScript modules loaded from ~/.pi/agent/extensions (global) or .pi/extensions (project-local)\n- Use pi.on(...) events such as session_start, session_before_compact/session_compact, and tool_result (or turn_end) to mirror hook timing\n- Use ctx.ui.notify(...) and/or injected custom messages for reminders, and pi.exec(...) for bus/jj checks\n- Include minimal config guidance in .pi/settings.json if any extra extension paths are needed\n- Document caveats vs Claude hooks (runtime-scoped behavior and event naming differences)\n\nDocs references to include in the bead deliverable:\n- Pi extensions docs: /home/bob/.bun/install/global/node_modules/@mariozechner/pi-coding-agent/docs/extensions.md\n- Pi settings docs: /home/bob/.bun/install/global/node_modules/@mariozechner/pi-coding-agent/docs/settings.md\n- Pi compaction events docs: /home/bob/.bun/install/global/node_modules/@mariozechner/pi-coding-agent/docs/compaction.md\n- Example extensions: /home/bob/.bun/install/global/node_modules/@mariozechner/pi-coding-agent/examples/extensions","status":"deferred","priority":2,"issue_type":"feature","created_at":"2026-02-08T19:59:51.488017299Z","created_by":"botbox-dev","updated_at":"2026-02-09T00:10:49.211644852Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["botbox","extension","hooks","pi"]}
{"id":"bd-ydxa","title":"E11: Botty-native end-to-end eval","description":"## Summary\n\nNew eval that tests the full botbox spawn chain end-to-end: message arrives on channel → hook fires → botty spawns agent → loop script runs → agent does work → announces completion. No hand-crafted phase prompts. No sequential claude -p invocations. The eval sends a task-request and observes what happens.\n\n## Motivation\n\nE10 (and E10v2) test \"can agents use the tools correctly?\" with controlled, sequential claude -p invocations and hand-crafted per-phase prompts. But the real system uses:\n\n1. botbus hooks that fire on channel messages\n2. botty spawn that creates PTY sessions\n3. Loop scripts (dev-loop.mjs, agent-loop.mjs, reviewer-loop.mjs) that drive agent behavior\n4. Hook-based reviewer spawning via @mentions\n\nNone of this is tested by E10. The loop scripts, hook registration, botty process management, and the coordination between them could all have bugs that E10 would never catch.\n\nE11 tests the real system. It measures \"does the whole thing actually work?\"\n\n## Architecture\n\n### What the eval does\n\n1. **Setup**: Create an isolated project with beads, maw, crit, botbus, botty. Register hooks (dev-loop, reviewer). Plant a defect. Seed a task-request on the channel.\n2. **Observe**: The hook fires, botty spawns the dev agent running dev-loop.mjs. The dev agent triages, creates a workspace, implements, requests a review (which triggers the reviewer hook via @mention), handles feedback, merges.\n3. **Score**: Check outcomes — bead closed? workspace merged? review approved? code compiles? claims released? Channel history shows correct message flow?\n\n### Key differences from E10\n\n| Aspect | E10 | E11 |\n|--------|-----|-----|\n| Agent invocation | Sequential `claude -p` with phase prompts | Hooks → botty spawn → loop scripts |\n| Phase boundaries | Explicit (orchestrator controls) | Implicit (agents decide when to stop/continue) |\n| Agent prompts | Hand-crafted per phase | Loop script prompts (worker-loop.md, review-loop.md) |\n| Reviewer spawn | Explicit `claude -p` invocation | Hook-triggered via @mention in bus message |\n| Scoring | Per-phase rubric | Outcome-based |\n| Determinism | High (controlled phases) | Lower (agents make autonomous decisions) |\n| What it tests | Agent tool usage | Full system: hooks + botty + scripts + tools |\n| Runtime | ~10 min (sequential phases) | Unknown (agents run autonomously) |\n\n### Complexity tiers\n\nStart simple and build up:\n\n**E11-L1: Single project, single agent, no review** (simplest)\n- 1 Rust project, 1 bead, dev-loop.mjs only\n- Tests: hook fires → botty spawns → agent triages → creates workspace → implements → merges → closes bead\n- No reviewer, no cross-project\n- Scoring: bead closed, workspace merged, code compiles, claims released\n\n**E11-L2: Single project, dev + reviewer** (adds review cycle)\n- 1 Rust project, 1 bead with planted defect, dev-loop.mjs + reviewer-loop.mjs\n- Tests: dev implements → @mentions reviewer → reviewer spawns via hook → blocks → dev fixes → reviewer LGTMs → dev merges\n- Scoring: full review cycle completes, defect found and fixed, bead closed\n\n**E11-L3: Two projects, full lifecycle** (E10-equivalent complexity)\n- 2 Rust projects, cross-project communication, 3 agents\n- Tests everything E10 tests but through the real system\n- This is the \"does it all work?\" eval\n\n### Observation approach\n\nSince we can't control phase boundaries, observation uses:\n\n- `botty tail <name> --last N` — real-time agent output (primary)\n- `bus history <channel> -n N` — message timeline\n- `br show <id>` — bead state\n- `crit reviews list --all-workspaces` — review state\n- `maw ws list` — workspace state\n- `bus claims list` — claim state\n- `botty list` — running agents\n\nThe eval script would poll these periodically (or use `bus wait` for specific events) and collect state snapshots.\n\n### Timeout and failure handling\n\nUnlike E10 where each phase has a ~5 min timeout, E11 agents run autonomously. Need:\n- Overall timeout (e.g., 30 min for L1, 60 min for L2/L3)\n- Stuck detection: if no bus messages or bead updates for N minutes, agent is stuck\n- botty kill as cleanup\n\n## Scoring approach\n\nOutcome-based, not step-by-step. Example for E11-L2:\n\n| Criterion | Pts | Verification |\n|-----------|-----|-------------|\n| Hook fired and agent spawned | 5 | botty list shows agent |\n| Bead triaged and claimed | 10 | br show: in_progress |\n| Workspace created | 5 | maw ws list |\n| Code implemented | 10 | cargo check in workspace |\n| Review created and reviewer @mentioned | 10 | crit reviews list, bus history |\n| Reviewer spawned via hook | 5 | botty list shows reviewer |\n| Reviewer found defect and blocked | 10 | crit review shows block |\n| Dev fixed defect | 10 | code inspection |\n| Reviewer LGTMd | 10 | crit review shows lgtm |\n| Workspace merged | 5 | maw ws list (no non-default workspaces) |\n| Bead closed | 5 | br show: closed |\n| Claims released | 5 | bus claims list |\n| Code compiles on main | 5 | cargo check |\n| Correct bus labels used | 5 | bus history |\n| Total | 100 | |\n\nPlus a friction dimension (from E10v2) measuring wasted calls in botty tail output.\n\n## Risks and open questions\n\n1. **Non-determinism**: Agents make autonomous decisions. The same setup might produce different outcomes across runs. Need multiple runs to establish baselines.\n2. **Timeout tuning**: How long to wait? Too short = agent hasn't finished. Too long = wasting time on a stuck agent.\n3. **botty availability**: botty must be running and healthy. If botty has bugs, E11 fails for reasons unrelated to agent behavior.\n4. **Loop script bugs**: dev-loop.mjs and reviewer-loop.mjs have their own logic (iteration counting, stuck detection, pause between iterations). Bugs in these scripts would cause E11 failures that E10 wouldn't catch. That's a feature (we want to find them) but makes scoring harder.\n5. **Cost**: If agents loop multiple iterations, API costs could be higher than E10's ~$15-25.\n6. **Observability**: Scoring requires parsing botty tail output, which is agent stdout with ANSI codes. Need reliable parsing.\n\n## Reference Files\n\n### E10 infrastructure (to build on)\n- `evals/scripts/e10-setup.sh` — Setup script pattern to adapt\n- `evals/scripts/e10-run.sh` — Orchestrator pattern to adapt\n- `evals/scripts/e10-verify.sh` — Verification pattern to adapt\n- `evals/rubrics.md` — E10 rubric (lines ~1182-1325), scoring patterns\n\n### Loop scripts (what E11 actually tests)\n- `packages/cli/scripts/dev-loop.mjs` — Lead dev agent loop\n- `packages/cli/scripts/agent-loop.mjs` — Worker agent loop\n- `packages/cli/scripts/reviewer-loop.mjs` — Reviewer agent loop\n- `packages/cli/scripts/respond.mjs` — Conversational responder\n- `packages/cli/scripts/triage.mjs` — Token-efficient triage\n- `packages/cli/scripts/iteration-start.mjs` — Combined status at iteration start\n\n### Hook infrastructure (spawn chain)\n- `packages/cli/hooks/init-agent.sh` — Session start hook\n- `packages/cli/hooks/check-jj.sh` — jj reminder hook\n- `packages/cli/hooks/check-bus-inbox.sh` — Inbox check hook\n- `packages/cli/src/lib/hooks.mjs` — Hook registry\n- `packages/cli/src/lib/scripts.mjs` — Script registry with eligibility rules\n\n### Agent prompts and workflow docs\n- `packages/cli/docs/worker-loop.md` — Full triage-work-finish lifecycle\n- `packages/cli/docs/start.md` — Claim bead, create workspace\n- `packages/cli/docs/finish.md` — Close bead, merge, release\n- `packages/cli/docs/review-request.md` — Request a review\n- `packages/cli/docs/review-response.md` — Handle reviewer feedback\n- `packages/cli/docs/review-loop.md` — Reviewer agent loop\n\n### Botty (agent runtime)\n- botty spawn, tail, list, kill, send — see CLAUDE.md botty section\n\n### Previous E10 runs (baseline comparison)\n- `evals/results/2026-02-06-e10-run1-opus.md` — E10-1: 158/160\n- `evals/results/2026-02-07-e10-run2-opus.md` — E10-2: 159/160, includes friction analysis\n- `evals/results/README.md` — All runs and key learnings\n- `notes/eval-framework.md` — Eval framework docs\n\n### Related eval scripts (other eval patterns)\n- `evals/scripts/r4-*.sh` — R4 integration eval (closest to E11-L2 in scope)\n- `evals/scripts/r6-*.sh` — R6 parallel dispatch eval (uses background processes)\n- `evals/scripts/r9-*.sh` — R9 crash recovery eval (tests resume)\n\n### Config\n- `.botbox.json` — Agent config (model, timeout, max_loops, pause per agent type)\n\n## Deliverables\n\n1. Proposal doc: `notes/proposals/e11-botty-native-eval.md`\n2. E11-L1 scripts: setup, run, verify\n3. E11-L1 rubric in `evals/rubrics.md`\n4. First E11-L1 run\n5. If L1 works: E11-L2 scripts and rubric","status":"deferred","priority":4,"issue_type":"feature","created_at":"2026-02-07T03:35:19.217746134Z","created_by":"botbox-dev","updated_at":"2026-02-08T20:43:39.223184330Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["eval","proposal"],"dependencies":[{"issue_id":"bd-ydxa","depends_on_id":"bd-2dyi","type":"blocks","created_at":"2026-02-08T19:59:41Z","created_by":"import","metadata":"{}","thread_id":""}],"comments":[{"id":158,"issue_id":"bd-ydxa","author":"botbox-dev","text":"Deferred: waiting for maw v2 migration (workspace paths, maw exec, eval commands all changing). Will undefer after maw v2 migration bead is complete.","created_at":"2026-02-07T23:22:51Z"},{"id":163,"issue_id":"bd-ydxa","author":"botbox-dev","text":"Blocker bd-2dyi (maw v2 migration) is now closed. Eval scripts will need updating for v2 patterns: maw exec default -- br/bv, maw exec $WS -- crit, ws/ paths instead of .workspaces/. Ready to undefer when picked up.","created_at":"2026-02-08T20:43:39Z"}]}
{"id":"bd-yio","title":"Add version field to .botbox.json config","description":"Add a version field to .botbox.json for future config format migrations.\n\nCurrent issue: If config format changes in future releases, we have no way to detect which version a config file is using and migrate it.\n\nSolution: Add 'version' field at top level:\n{\n  \"version\": \"1.0.0\",\n  \"project\": { ... },\n  ...\n}\n\nChanges needed:\n1. init.mjs: Add version field when generating config\n2. Define version in a constant (e.g., BOTBOX_CONFIG_VERSION = '1.0.0')\n3. Loop scripts: Could validate version if needed (optional for now)\n4. doctor command: Check version compatibility (future work)\n\nUse semver format so we can handle breaking changes:\n- Major version: breaking config format changes\n- Minor version: backward-compatible additions\n- Patch version: bug fixes, clarifications\n\nStart at 1.0.0 since this is the first config format.","status":"closed","priority":3,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-02T23:53:05.386712105Z","created_by":"botbox-dev","updated_at":"2026-02-02T23:53:54.112547745Z","closed_at":"2026-02-02T23:53:54.112508061Z","close_reason":"Completed: Added version 1.0.0 field to config","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":159,"issue_id":"bd-yio","author":"botbox-dev","text":"Added version field to config\n\nChanges:\n- init.mjs: Added BOTBOX_CONFIG_VERSION constant = '1.0.0'\n- init.mjs: Added version field to generated config (first field)\n\nConfig now starts with:\n{\n  \"version\": \"1.0.0\",\n  \"project\": { ... },\n  ...\n}\n\nTested: Version field generated correctly. All tests pass.","created_at":"2026-02-02T23:53:50Z"}]}
{"id":"bd-zig","title":"Reduce or remove loop pause in dev/agent scripts","description":"Reduce LOOP_PAUSE now that hook-based spawning eliminates need for polling.\n\nCurrent issue: dev-loop.sh pauses 60s between iterations to allow messages to arrive, but hooks now spawn agents on demand when messages arrive. The long pause just delays completion unnecessarily.\n\nCurrent values:\n- dev-loop.sh: LOOP_PAUSE=60 (60 seconds)\n- agent-loop.sh: LOOP_PAUSE=5 (5 seconds)  \n- reviewer-loop.sh: LOOP_PAUSE=10 (10 seconds)\n\nProposed values:\n- dev-loop.sh: LOOP_PAUSE=2 (brief cooldown, not polling)\n- agent-loop.sh: LOOP_PAUSE=2 (consistent)\n- reviewer-loop.sh: LOOP_PAUSE=2 (consistent)\n\nOr eliminate entirely (LOOP_PAUSE=0)?\n\nChanges needed:\n1. Update defaults in loop scripts\n2. Update defaults in .botbox.json config generation\n3. Test: Agent completes faster without waiting unnecessarily\n\nRationale: The pause was for polling, but we don't poll anymore. Hook fires → agent spawns → does work → exits quickly. Brief pause (1-2s) is just for rate limiting and letting stdout flush.\n\nTesting: Run agent, verify it exits quickly when no work instead of waiting 60s.","status":"closed","priority":2,"issue_type":"task","owner":"botbox-dev","created_at":"2026-02-03T00:32:23.808880315Z","created_by":"botbox-dev","updated_at":"2026-02-03T00:33:25.007750541Z","closed_at":"2026-02-03T00:33:25.007723040Z","close_reason":"Completed: Reduced loop pause from 60s to 2s","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":160,"issue_id":"bd-zig","author":"botbox-dev","text":"Reduced loop pause to 2 seconds\n\nChanges:\n- dev-loop.sh: LOOP_PAUSE 60s → 2s\n- agent-loop.sh: LOOP_PAUSE 5s → 2s  \n- reviewer-loop.sh: LOOP_PAUSE 10s → 2s\n- init.mjs: Config defaults updated (dev.pause: 60 → 2, reviewer.pause: 10 → 2)\n- Updated jq fallback values in all three scripts\n\nRationale: Hook-based spawning eliminates need for polling. The pause is now just a brief cooldown (2s) to let stdout flush and rate limit iterations, not a polling interval.\n\nWith hooks: message arrives → hook spawns agent → agent does work → exits quickly\n\nOld behavior: Agent sits idle for 60s between iterations waiting for messages\nNew behavior: Agent pauses 2s between iterations, exits quickly when done\n\nTesting: All 100 tests pass. Syntax validated.","created_at":"2026-02-03T00:33:21Z"}]}
{"id":"bd-ztw","title":"Update root and eval docs to use bus CLI","description":"Update CLAUDE.md, AGENTS.md, eval-review.md, and other non-workflow docs to use bus for CLI commands where appropriate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T22:34:25.436321956Z","created_by":"bob","updated_at":"2026-02-01T22:43:22.387753460Z","closed_at":"2026-02-01T22:43:22.387731229Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":161,"issue_id":"bd-ztw","author":"Bob","text":"Updated root and eval docs (README.md, eval-review.md, eval-loop.md, docs/dev-agent-architecture.md, AGENTS.md) to use bus for CLI commands and tool lists.","created_at":"2026-02-01T22:43:19Z"}]}
