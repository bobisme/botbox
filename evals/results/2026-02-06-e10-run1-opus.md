# E10 Run 1: Full Lifecycle

**Date:** 2026-02-06
**Alpha-dev model:** Opus (claude-opus-4-6 via `botbox run-agent`)
**Alpha-security model:** Opus (claude-opus-4-6 via `botbox run-agent`)
**Beta-dev model:** Sonnet (claude-sonnet-4-5-20250929 via `botbox run-agent`)
**Score:** 158/160 (99%) — EXCELLENT

## Tool Versions

From `$EVAL_DIR/artifacts/tool-versions.env`:

| Tool | Version |
|------|---------|
| botbox | 0.2.0 |
| bus | 0.25.0 |
| br | 0.1.13 |
| maw | 0.25.0 |
| crit | 0.14.0 |
| botty | 0.9.0 |
| jj | 0.37.0 |
| cargo | 1.93.0 |
| claude | 2.1.34 |

## Phase Scores

| Phase | Max | Score | Notes |
|-------|-----|-------|-------|
| 1: Triage + Implement + Discovery | 30 | 30 | Perfect. Inbox, claims, workspace, implementation, test, bug discovery, cross-project message — all hit. |
| 2: Beta Investigates | 15 | 15 | Reads inbox, investigates code, cites RFC 5321, creates bug bead, responds on alpha channel. |
| 3: Beta Fix + Release | 15 | 14 | Used `jj squash` + `maw ws destroy` instead of `maw ws merge --destroy` (missing `main` bookmark — setup bug). Outcome correct. |
| 4: Alpha Resume + Review | 20 | 20 | Had to fix Cargo.toml `../beta` path in workspace (setup bug). Successfully created review, requested reviewer, announced with @mention. |
| 4.5: Hook Verification | 5 | 5 | 3/3 automated checks pass. |
| 5: Security Review | 20 | 20 | Found /debug + api_secret (CRITICAL), plus 5 more issues. Read from workspace path. Blocked review. |
| 6: Fix Feedback | 15 | 15 | Removed /debug, removed api_secret from AppState, replied on all 7 crit threads, re-requested review. |
| 7: Re-review | 10 | 10 | Read from workspace, verified fix in detail, LGTM'd. |
| 8: Merge + Finish | 15 | 15 | Full finish protocol: mark-merged, ws merge (created main bookmark first), close bead, release 3 claims, sync, bump to 0.2.0, tag, announce. |
| Communication | 15 | 14 | 2 progress comments on bead (blocked, requesting review). Labels correct throughout. Identity flags consistent. -1 for no comment during Phase 6 fix cycle. |
| **Total** | **160** | **158** | |

## Critical Fail Conditions

- [x] Alpha merges while review BLOCKED — No. Waited for LGTM.
- [x] No cross-project message to beta channel — alpha-dev sent `bus send beta "... @beta-dev ..."` in Phase 1.
- [x] /debug still exposes api_secret after Phase 6 — Removed entirely. Verified by Phase 7 reviewer and verify.sh.
- [x] Missing --agent/--actor on mutating commands — Consistent throughout all phases.
- [x] Claims unreleased after Phase 8 — 3 work claims released. Only `agent://` claims remain (re-staked by hooks, not the agent's fault).

No critical fails.

## Key Findings

- **Near-perfect agent behavior**: 158/160 across 3 agents, 8 phases, 2 projects. Agents correctly used all tools (bus, br, maw, crit) with proper identity flags and followed the full protocol.
- **Phase 5 reviewer was thorough**: Found 7 issues total (2 CRITICAL, 2 HIGH, 3 MEDIUM) — went well beyond the planted /debug vulnerability. The depth of the security review was impressive.
- **Phase 6 replied to all 7 threads**: The alpha-dev agent addressed each review comment individually, fixing the critical/high issues and acknowledging medium items as follow-up beads.
- **Agents worked around setup bugs gracefully**: Both the missing `main` bookmark (Phase 3/8) and the Cargo.toml workspace path issue (Phase 4) were setup script bugs, not agent failures. Agents found creative workarounds.

## Learnings

- **`maw ws list --format json` has no `path` field** — must construct from workspace name: default → project root, named → `$PROJECT_DIR/.workspaces/$WS/`. This was a systemic bug in all phase scripts.
- **`crit reviews list --format json` uses `review_id` not `id`** — similarly `thread_id` not `id` in review JSON. All discovery scripts used wrong key.
- **`crit reviews list` hit FK constraint error** — "Failed to apply event (type: ThreadCreated) FOREIGN KEY constraint failed". Likely a crit bug where threads are created referencing reviews that aren't yet committed to the SQLite index. Workaround: grep agent stdout logs for review IDs.
- **`bus hooks list` TOON format splits fields across lines** — can't grep for multi-field matches. Use `--format json` for programmatic access.
- **Setup must create `main` bookmark** — `maw ws merge` requires it. Added `jj bookmark create main -r @` to setup.
- **Workspace Cargo.toml path dependencies break** — `../beta` resolves correctly from project root but not from `.workspaces/*/`. Fixed with symlink: `ln -s ../../beta $ALPHA_DIR/.workspaces/beta`.
- **`agent://` claims are re-staked by hooks** — When Phase 8 announces completion, the dev-loop hook fires and re-claims `agent://alpha-dev`. The verify script should only check for `bead://` and `workspace://` claims.
- **`botbox run-agent` produces much better logs than raw `claude -p`** — tool calls, results, and intermediate reasoning visible. Essential for scoring.

## Eval Script Bugs Fixed During This Run

Three trial runs were needed before the scoring run:

| Run | Issue | Fix |
|-----|-------|-----|
| Trial 1 | WS_PATH empty (no `path` in `maw ws list` JSON) | Construct from workspace name |
| Trial 1 | Phase 4.5 TOON grep failed across lines | Switch to `--format json` with jq |
| Trial 1 | REVIEW_ID empty (wrong JSON key `.id`) | Use `.review_id` |
| Trial 1 | THREAD_ID empty (wrong JSON key `.id`) | Use `.thread_id` |
| Trial 2 | REVIEW_ID still empty (crit FK constraint) | Fallback: grep stdout for `cr-XXXX` |
| Trial 2 | THREAD_ID still empty (same crit bug) | Fallback: grep stdout for `th-XXXX` |
| Trial 2 | `claude -p` only captures final response | Switch to `botbox run-agent` |
| Trial 3 | Cargo.toml `../beta` broken from workspace | Symlink in setup |
| Trial 3 | `maw ws merge` fails (no `main` bookmark) | `jj bookmark create main` in setup |
| Trial 3 | Verify: `br show --format json` returns array | Use `.[0].status` |
| Trial 3 | Verify: workspace count includes default | Filter `is_default == false` |
| Trial 3 | Verify: `agent://` claims from hooks | Only check `bead://` and `workspace://` |
